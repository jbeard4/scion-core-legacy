{"version":3,"sources":["scion.js"],"names":["f","exports","module","define","amd","g","window","global","self","scion","e","t","n","r","s","o","u","a","require","i","Error","code","l","call","length","ArraySet","Set","prototype","add","x","remove","delete","union","v","difference","contains","has","iter","Array","from","isEmpty","size","equals","s2","toString","join","STATE_TYPES","BASIC","COMPOSITE","PARALLEL","HISTORY","INITIAL","FINAL","SCXML_IOPROCESSOR_TYPE","HTTP_IOPROCESSOR_TYPE","RX_TRAILING_WILDCARD","constants","printTrace","extend","transitionWithTargets","transitionComparator","initializeModel","isEventPrefixMatch","isTransitionMatch","scxmlPrefixTransitionSelector","eventlessTransitionSelector","getTransitionWithHigherSourceChildPriority","sortInEntryOrder","getStateWithHigherSourceChildPriority","initializeModelGeneratorFn","deserializeSerializedConfiguration","deserializeHistory","to","Object","keys","forEach","k","targets","t1","t2","documentOrder","rootState","opts","transitions","idToStateMap","Map","idCount","generateId","type","undefined","count","id","wrapInFakeRootState","state","$deserializeDatamodel","$serializeDatamodel","$idToStateMap","docUrl","name","states","$type","target","statesWithInitialAttributes","transitionToString","sourceState","events","cond","stateToString","populateStateIdMap","set","j","len","traverse","ancestors","push","apply","depth","parent","transition","source","bind","ancs","concat","typeEnum","isAtomic","descendants","map","reduce","b","initialChildren","isArray","initial","filter","child","initialRef","checkInitialRef","historyChildren","historyRef","prop","every","handler","invokes","invoke","finalize","connectIntialAttributes","initialStates","initialState","get","RX_WHITESPACE","connectTransitionGraph","onTransition","event","trim","split","lcca","getLCCA","scope","getScope","transitionIsReallyInternal","indexOf","s1","commonAncestors","anc","legacySemantics","fakeRootState","prefix","fullName","replace","charAt","eventName","some","tEvent","evaluator","selectEventlessTransitions","_args","modelFn","interpreter","_x","_sessionid","_ioprocessors","isIn","serializedConfiguration","serializedHistory","sid","query","isDescendant","getAncestors","root","index","slice","isOrthogonalTo","isAncestrallyRelatedTo","getLCA","getAncestorsOrSelf","getDescendantsOrSelf","process","EventEmitter","util","helpers","env","DEBUG","BaseInterpreter","modelOrModelFactory","InterpreterScriptingContext","_isStepping","_scriptingContext","interpreterScriptingContext","generateSessionid","sessionid","sessionRegistry","location","scxml","model","JSON","parse","stringify","_model","console","log","priorityComparisonFn","transitionSelector","String","arguments","_externalEventQueue","_internalEventQueue","params","snapshot","_configuration","_historyValue","_isInFinalState","EVENTS","on","_log","emit","parentSession","invokeid","_exitInterpreter","_cancelAllDelayedSends","statesToExit","_getFullConfiguration","sort","stateExited","onExit","exitIdx","exitLen","block","blockIdx","blockLen","actionRef","_handleError","cancelInvoke","send","data","donedata","_initStart","_performBigStep","getConfiguration","cb","genAsync","nop","stateName","getFullConfiguration","currentEvent","keepGoing","allStatesExited","allStatesEntered","_startBigStep","_selectTransitionsAndPerformSmallStep","_finishBigStep","selectedTransitions","_selectTransitions","ev","shift","statesExited","statesEntered","_performSmallStep","autoforward","_evaluateAction","action","statesToInvoke","_timeouts","timeoutOptions","sendOptions","delay","clearTimeout","timeoutHandle","_timeoutMap","key","nextStep","setImmediate","selectedTransitionsWithTargets","_exitStates","_executeTransitions","_enterStates","basicStatesExited","_getStatesExited","isDeep","s0","transitionList","txIdx","txLen","desc","configList","cfgIdx","cfgLen","ancIdx","ancLen","sortedStatesExited","sortedTransitions","stxIdx","targetIds","statesForDefaultEntry","defaultHistoryContent","_computeEntrySet","enterIdx","enterLen","stateEntered","onEntry","entryIdx","entryLen","grandparent","isInFinalState","_getEffectiveTargetStates","statesToEnter","_addDescendantStatesToEnter","ancestor","_addAncestorStatesToEnter","targetState","__proto__","match","tagname","line","column","reason","message","args","arg","inspect","listener","off","getEvents","stateIdx","stateLen","_serializeHistory","evtObjOrName","optionalData","c","_performBigStepAsync","err","config","sessionIdCounter","_interpreter","_invokeMap","validateUriRegex","invokeSendTargetRegex","scxmlSendTargetRegex","_installDefaultPropsOnEvent","xmlString","xmlParser","invokeObj","Promise","resolve","reject","invokers","session","sessionPromise","then","cancel","isInternal","origin","origintype","options","sendType","validateSend","sendAction","targetIsValidUri","test","sendid","defaultSendAction","setTimeout","raise","doSend","targetSessionId","invokeId","sendAsync","publish","sendFn","customSend","customCancel","_listeners","_on","once","_once","__once","_off","splice","_emit","__emit","_createClass","defineProperties","props","descriptor","enumerable","configurable","writable","defineProperty","Constructor","protoProps","staticProps","_classCallCheck","instance","TypeError","_possibleConstructorReturn","ReferenceError","_inherits","subClass","superClass","create","constructor","value","setPrototypeOf","base","Statechart","_base$BaseInterpreter","getPrototypeOf","onlySelectFromBasicStates","statesAndParents","idx","basicState","enabledTransitions","priorityEnabledTransitions","_selectPriorityEnabledTransitions","tuple","_getInconsistentTransitions","consistentTransitions","inconsistentTransitionsPairs","allInconsistentTransitions","_conflicts","_isArenaOrthogonal","isOrthogonal","cachedSetTimeout","cachedClearTimeout","defaultSetTimout","defaultClearTimeout","runTimeout","fun","runClearTimeout","marker","queue","draining","currentQueue","queueIndex","cleanUpNextTick","drainQueue","timeout","run","nextTick","Item","array","title","browser","argv","version","versions","noop","addListener","removeListener","removeAllListeners","prependListener","prependOnceListener","listeners","binding","cwd","chdir","dir","umask","inherits","ctor","superCtor","super_","TempCtor","isBuffer","copy","fill","readUInt8","formatRegExp","format","isString","objects","str","Number","_","isNull","isObject","deprecate","fn","msg","isUndefined","noDeprecation","warned","deprecated","throwDeprecation","traceDeprecation","trace","error","debugs","debugEnviron","debuglog","NODE_DEBUG","toUpperCase","RegExp","pid","obj","ctx","seen","stylize","stylizeNoColor","colors","isBoolean","showHidden","_extend","customInspect","stylizeWithColor","formatValue","styles","styleType","style","arrayToHash","hash","val","recurseTimes","isFunction","ret","primitive","formatPrimitive","visibleKeys","getOwnPropertyNames","isError","formatError","isRegExp","isDate","Date","braces","toUTCString","output","formatArray","formatProperty","pop","reduceToSingleString","simple","isNumber","hasOwnProperty","getOwnPropertyDescriptor","substr","numLinesEst","prev","cur","ar","isNullOrUndefined","isSymbol","re","objectToString","d","isPrimitive","pad","months","timestamp","time","getHours","getMinutes","getSeconds","getDate","getMonth"],"mappings":"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","file":"scion.js","sourcesContent":["(function(f){if(typeof exports===\"object\"&&typeof module!==\"undefined\"){module.exports=f()}else if(typeof define===\"function\"&&define.amd){define([],f)}else{var g;if(typeof window!==\"undefined\"){g=window}else if(typeof global!==\"undefined\"){g=global}else if(typeof self!==\"undefined\"){g=self}else{g=this}g.scion = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\n/* begin ArraySet */\n\n/** @constructor */\nfunction ArraySet(l) {\n    l = l || [];\n    this.o = new Set(l);        \n}\n\nArraySet.prototype = {\n\n    add : function(x) {\n        this.o.add(x);\n    },\n\n    remove : function(x) {\n        return this.o.delete(x);\n    },\n\n    union : function(l) {\n        for (var v of l.o) {\n            this.o.add(v);\n        }\n        return this;\n    },\n\n    difference : function(l) {\n        for (var v of l.o) {\n            this.o.delete(v);\n        }\n        return this;\n    },\n\n    contains : function(x) {\n        return this.o.has(x);\n    },\n\n    iter : function() {\n        return Array.from(this.o);\n    },\n\n    isEmpty : function() {\n        return !this.o.size;\n    },\n\n    size: function() {\n        return this.o.size;\n    },\n\n    equals : function(s2) {\n        if (this.o.size !== s2.size()) {\n            return false;\n        }\n\n        for (var v of this.o) {\n            if (!s2.contains(v)) {\n                return false;\n            }\n        }\n\n        return true;\n    },\n\n    toString : function() {\n        return this.o.size === 0 ? '<empty>' : Array.from(this.o).join(',\\n');\n    }\n};\n\nmodule.exports = ArraySet;\n\n},{}],2:[function(require,module,exports){\nvar STATE_TYPES = {\n    BASIC: 0,\n    COMPOSITE: 1,\n    PARALLEL: 2,\n    HISTORY: 3,\n    INITIAL: 4,\n    FINAL: 5\n};\n\nconst SCXML_IOPROCESSOR_TYPE = 'http://www.w3.org/TR/scxml/#SCXMLEventProcessor'\nconst HTTP_IOPROCESSOR_TYPE = 'http://www.w3.org/TR/scxml/#BasicHTTPEventProcessor'\nconst RX_TRAILING_WILDCARD = /\\.\\*$/;\n\nmodule.exports = {\n  STATE_TYPES : STATE_TYPES,\n  SCXML_IOPROCESSOR_TYPE  : SCXML_IOPROCESSOR_TYPE,\n  HTTP_IOPROCESSOR_TYPE  : HTTP_IOPROCESSOR_TYPE, \n  RX_TRAILING_WILDCARD  : RX_TRAILING_WILDCARD \n};\n\n},{}],3:[function(require,module,exports){\nconst constants = require('./constants'),\n      STATE_TYPES = constants.STATE_TYPES,\n      RX_TRAILING_WILDCARD = constants.RX_TRAILING_WILDCARD;\n\nconst printTrace = false;\n\nmodule.exports = {\n  extend : extend,\n  transitionWithTargets : transitionWithTargets,\n  transitionComparator : transitionComparator,\n  initializeModel : initializeModel,\n  isEventPrefixMatch : isEventPrefixMatch,\n  isTransitionMatch : isTransitionMatch,\n  scxmlPrefixTransitionSelector : scxmlPrefixTransitionSelector,\n  eventlessTransitionSelector : eventlessTransitionSelector,\n  getTransitionWithHigherSourceChildPriority : getTransitionWithHigherSourceChildPriority,\n  sortInEntryOrder : sortInEntryOrder,\n  getStateWithHigherSourceChildPriority : getStateWithHigherSourceChildPriority,\n  initializeModelGeneratorFn : initializeModelGeneratorFn,\n  deserializeSerializedConfiguration : deserializeSerializedConfiguration,\n  deserializeHistory : deserializeHistory\n};\n\nfunction extend (to, from){\n  Object.keys(from).forEach(function(k){\n    to[k] = from[k]; \n  });\n  return to;\n};\n\nfunction transitionWithTargets(t){\n    return t.targets;\n}\n\nfunction transitionComparator(t1, t2) {\n    return t1.documentOrder - t2.documentOrder;\n}\n\nfunction initializeModel(rootState, opts){\n    var transitions = [], idToStateMap = new Map(), documentOrder = 0;\n\n\n    //TODO: need to add fake ids to anyone that doesn't have them\n    //FIXME: make this safer - break into multiple passes\n    var idCount = {};\n\n    function generateId(type){\n        if(idCount[type] === undefined) idCount[type] = 0;\n\n        do {\n          var count = idCount[type]++;\n          var id = '$generated-' + type + '-' + count; \n        } while (idToStateMap.has(id))\n        \n        return id;\n    }\n\n    function wrapInFakeRootState(state){\n        return {\n            $deserializeDatamodel : state.$deserializeDatamodel || function(){},\n            $serializeDatamodel : state.$serializeDatamodel || function(){ return null;},\n            $idToStateMap : idToStateMap,   //keep this for handy deserialization of serialized configuration\n            docUrl : state.docUrl,\n            name : state.name,\n            states : [\n                {\n                    $type : 'initial',\n                    transitions : [{\n                        target : state\n                    }]\n                },\n                state\n            ]\n        };\n    }\n\n    var statesWithInitialAttributes = [];\n\n    /**\n      @this {SCTransition}\n    */\n    function transitionToString(sourceState){\n      return `${sourceState} -- ${this.events ? '(' + this.events.join(',') + ')' : null}${this.cond ? '[' + this.cond.name + ']' : ''} --> ${this.targets ? this.targets.join(',') : null}`;\n    }\n\n    /**\n      @this {SCState}\n    */\n    function stateToString(){\n      return this.id;\n    }\n\n    function populateStateIdMap(state){\n      //populate state id map\n      if(state.id){\n          idToStateMap.set(state.id, state);\n      }\n\n      if(state.states) {\n          for (var j = 0, len = state.states.length; j < len; j++) {\n              populateStateIdMap(state.states[j]);\n          }\n      }\n    }\n\n    function traverse(ancestors,state){\n\n        if(printTrace) state.toString = stateToString;\n\n        //add to global transition and state id caches\n        if(state.transitions) transitions.push.apply(transitions,state.transitions);\n\n        //create a default type, just to normalize things\n        //this way we can check for unsupported types below\n        state.$type = state.$type || 'state';\n\n        //add ancestors and depth properties\n        state.ancestors = ancestors;\n        state.depth = ancestors.length;\n        state.parent = ancestors[0];\n        state.documentOrder = documentOrder++; \n\n        //add some information to transitions\n        state.transitions = state.transitions || [];\n        for (var j = 0, len = state.transitions.length; j < len; j++) {\n            var transition = state.transitions[j];\n            transition.documentOrder = documentOrder++; \n            transition.source = state;\n            if(printTrace) transition.toString = transitionToString.bind(transition, state);\n        };\n\n        //recursive step\n        if(state.states) {\n            var ancs = [state].concat(ancestors);\n            for (var j = 0, len = state.states.length; j < len; j++) {\n                traverse(ancs, state.states[j]);\n            }\n        }\n\n        //setup fast state type\n        switch(state.$type){\n            case 'parallel':\n                state.typeEnum = STATE_TYPES.PARALLEL;\n                state.isAtomic = false;\n                break;\n            case 'initial' : \n                state.typeEnum = STATE_TYPES.INITIAL;\n                state.isAtomic = true;\n                break;\n            case 'history' :\n                state.typeEnum = STATE_TYPES.HISTORY;\n                state.isAtomic = true;\n                break;\n            case 'final' : \n                state.typeEnum = STATE_TYPES.FINAL;\n                state.isAtomic = true;\n                break;\n            case 'state' : \n            case 'scxml' :\n                if(state.states && state.states.length){\n                    state.typeEnum = STATE_TYPES.COMPOSITE;\n                    state.isAtomic = false;\n                }else{\n                    state.typeEnum = STATE_TYPES.BASIC;\n                    state.isAtomic = true;\n                }\n                break;\n            default :\n                throw new Error('Unknown state type: ' + state.$type);\n        }\n\n        //descendants property on states will now be populated. add descendants to this state\n        if(state.states){\n            state.descendants = state.states.concat(state.states.map(function(s){return s.descendants;}).reduce(function(a,b){return a.concat(b);},[]));\n        }else{\n            state.descendants = [];\n        }\n\n        var initialChildren;\n        if(state.typeEnum === STATE_TYPES.COMPOSITE){\n            //set up initial state\n            \n            if(Array.isArray(state.initial) || typeof state.initial === 'string'){\n                statesWithInitialAttributes.push(state);\n            }else{\n                //take the first child that has initial type, or first child\n                initialChildren = state.states.filter(function(child){\n                    return child.$type === 'initial';\n                });\n\n                state.initialRef = [initialChildren.length ? initialChildren[0] : state.states[0]];\n                checkInitialRef(state);\n            }\n\n        }\n\n        //hook up history\n        if(state.typeEnum === STATE_TYPES.COMPOSITE ||\n                state.typeEnum === STATE_TYPES.PARALLEL){\n\n            var historyChildren = state.states.filter(function(s){\n                return s.$type === 'history';\n            }); \n\n           state.historyRef = historyChildren;\n        }\n\n        //now it's safe to fill in fake state ids\n        if(!state.id){\n            state.id = generateId(state.$type);\n            idToStateMap.set(state.id, state);\n        }\n\n        //normalize onEntry/onExit, which can be single fn or array, or array of arrays (blocks)\n        ['onEntry','onExit'].forEach(function(prop){\n          if (state[prop]) {\n            if(!Array.isArray(state[prop])){\n              state[prop] = [state[prop]];\n            }\n            if(!state[prop].every(function(handler){ return Array.isArray(handler); })){\n              state[prop] = [state[prop]];\n            }\n          }\n        });\n\n        if (state.invokes && !Array.isArray(state.invokes)) {\n            state.invokes = [state.invokes];\n            state.invokes.forEach( invoke => {\n              if (invoke.finalize && !Array.isArray(invoke.finalize)) {\n                invoke.finalize = [invoke.finalize];\n              }\n            })\n        }\n    }\n\n    //TODO: convert events to regular expressions in advance\n\n    function checkInitialRef(state){\n      if(!state.initialRef) throw new Error('Unable to locate initial state for composite state: ' + state.id);\n    }\n    function connectIntialAttributes(){\n      for (var j = 0, len = statesWithInitialAttributes.length; j < len; j++) {\n        var s = statesWithInitialAttributes[j];\n\n        var initialStates = Array.isArray(s.initial) ? s.initial : [s.initial];\n        s.initialRef = initialStates.map(function(initialState){ return idToStateMap.get(initialState); });\n        checkInitialRef(s);\n      }\n    }\n\n    var RX_WHITESPACE = /\\s+/;\n\n    function connectTransitionGraph(){\n        //normalize as with onEntry/onExit\n        for (var i = 0, len = transitions.length; i < len; i++) {\n            var t = transitions[i];\n            if (t.onTransition && !Array.isArray(t.onTransition)) {\n                t.onTransition = [t.onTransition];\n            }\n\n            //normalize \"event\" attribute into \"events\" attribute\n            if (typeof t.event === 'string') {\n                t.events = t.event.trim().split(RX_WHITESPACE);\n            }\n            delete t.event;\n\n            if(t.targets || (typeof t.target === 'undefined')) {\n                //targets have already been set up\n                continue;\n            }   \n\n            if(typeof t.target === 'string'){\n                var target = idToStateMap.get(t.target);\n                if(!target) throw new Error('Unable to find target state with id ' + t.target);\n                t.target = target;\n                t.targets = [t.target];\n            }else if(Array.isArray(t.target)){\n                t.targets = t.target.map(function(target){\n                    if(typeof target === 'string'){\n                        target = idToStateMap.get(target);\n                        if(!target) throw new Error('Unable to find target state with id ' + t.target);\n                        return target;\n                    }else{\n                        return target;\n                    } \n                }); \n            }else if(typeof t.target === 'object'){\n                t.targets = [t.target];\n            }else{\n                throw new Error('Transition target has unknown type: ' + t.target);\n            }\n        }\n\n        //hook up LCA - optimization\n        for (var i = 0, len = transitions.length; i < len; i++) {\n            var t = transitions[i];\n            if(t.targets) t.lcca = getLCCA(t.source,t.targets[0]);    //FIXME: we technically do not need to hang onto the lcca. only the scope is used by the algorithm\n\n            t.scope = getScope(t);\n        }\n    }\n\n    function getScope(transition){\n        //Transition scope is normally the least common compound ancestor (lcca).\n        //Internal transitions have a scope equal to the source state.\n        var transitionIsReallyInternal = \n                transition.type === 'internal' &&\n                  transition.source.typeEnum === STATE_TYPES.COMPOSITE &&   //is transition source a composite state\n                  transition.source.parent &&    //root state won't have parent\n                  transition.targets && //does it target its descendants\n                  transition.targets.every(\n                      function(target){ return transition.source.descendants.indexOf(target) > -1;});\n\n        if(!transition.targets){\n            return null;\n        }else if(transitionIsReallyInternal){\n            return transition.source; \n        }else{\n            return transition.lcca;\n        }\n    }\n\n    function getLCCA(s1, s2) {\n        var commonAncestors = [];\n        for (var j = 0, len = s1.ancestors.length; j < len; j++) {\n            var anc = s1.ancestors[j];\n            if(\n                (\n                  opts && opts.legacySemantics ? \n                    anc.typeEnum === STATE_TYPES.COMPOSITE :\n                    (anc.typeEnum === STATE_TYPES.COMPOSITE || anc.typeEnum === STATE_TYPES.PARALLEL) \n                ) &&\n                anc.descendants.indexOf(s2) > -1){\n\n                commonAncestors.push(anc);\n            }\n        };\n        if(!commonAncestors.length) throw new Error(\"Could not find LCA for states.\");\n        return commonAncestors[0];\n    }\n\n    //main execution starts here\n    //FIXME: only wrap in root state if it's not a compound state\n    populateStateIdMap(rootState);\n    var fakeRootState = wrapInFakeRootState(rootState);  //I wish we had pointer semantics and could make this a C-style \"out argument\". Instead we return him\n    traverse([],fakeRootState);\n    connectTransitionGraph();\n    connectIntialAttributes();\n\n    return fakeRootState;\n}\n\n\nfunction isEventPrefixMatch(prefix, fullName) {\n    prefix = prefix.replace(RX_TRAILING_WILDCARD, '');\n\n    if (prefix === fullName) {\n        return true;\n    }\n\n    if (prefix.length > fullName.length) {\n        return false;\n    }\n\n    if (fullName.charAt(prefix.length) !== '.') {\n        return false;\n    }\n\n    return (fullName.indexOf(prefix) === 0);\n}\n\nfunction isTransitionMatch(t, eventName) {\n    return t.events.some((tEvent) => {\n        return tEvent === '*' || isEventPrefixMatch(tEvent, eventName);\n    });\n}\n\nfunction scxmlPrefixTransitionSelector(t, event, evaluator, selectEventlessTransitions) {\n    return ( \n      selectEventlessTransitions ? \n        !t.events :\n        (t.events && event && event.name && isTransitionMatch(t, event.name))\n      )\n      && (!t.cond || evaluator(t.cond));\n}\n\nfunction eventlessTransitionSelector(state){\n  return state.transitions.filter(function(transition){ return !transition.events || ( transition.events && transition.events.length === 0 ); });\n}\n\n//priority comparison functions\nfunction getTransitionWithHigherSourceChildPriority(_args) {\n    let t1 = _args[0], t2 = _args[1];\n    var r = getStateWithHigherSourceChildPriority(t1.source, t2.source);\n    //compare transitions based first on depth, then based on document order\n    if (t1.source.depth < t2.source.depth) {\n        return t2;\n    } else if (t2.source.depth < t1.source.depth) {\n        return t1;\n    } else {\n       if (t1.documentOrder < t2.documentOrder) {\n            return t1;\n        } else {\n            return t2;\n        }\n    }\n}\n\nfunction sortInEntryOrder(s1, s2){\n  return getStateWithHigherSourceChildPriority(s1, s2) * -1\n}\n\nfunction getStateWithHigherSourceChildPriority(s1, s2) {\n    //compare states based first on depth, then based on document order\n    if (s1.depth > s2.depth) {\n        return -1;\n    } else if (s1.depth < s2.depth) {\n        return 1;\n    } else {\n        //Equality\n        if (s1.documentOrder < s2.documentOrder) {\n            return 1;\n        } else if (s1.documentOrder > s2.documentOrder) {\n            return -1;\n        } else{\n            return 0;\n        }\n    }\n}\n\nfunction initializeModelGeneratorFn(modelFn, opts, interpreter){\n    return modelFn.call(interpreter,\n        opts._x,\n        opts._x._sessionid,\n        opts._x._ioprocessors,\n        interpreter.isIn.bind(interpreter));\n}\n\nfunction deserializeSerializedConfiguration(serializedConfiguration,idToStateMap){\n  return serializedConfiguration.map(function(id){\n    var state = idToStateMap.get(id);\n    if(!state) throw new Error('Error loading serialized configuration. Unable to locate state with id ' + id);\n    return state;\n  });\n}\n\nfunction deserializeHistory(serializedHistory,idToStateMap){\n  var o = {};\n  Object.keys(serializedHistory).forEach(function(sid){\n    o[sid] = serializedHistory[sid].map(function(id){\n      var state = idToStateMap.get(id);\n      if(!state) throw new Error('Error loading serialized history. Unable to locate state with id ' + id);\n      return state;\n    });\n  });\n  return o;\n}\n\n\n},{\"./constants\":2}],4:[function(require,module,exports){\nconst constants = require('./constants');\n\n//model accessor functions\nconst query = {\n    isDescendant : function(s1, s2){\n      //Returns 'true' if state1 is a descendant of state2 (a child, or a child of a child, or a child of a child of a child, etc.) Otherwise returns 'false'.\n      return s2.descendants.indexOf(s1) > -1;\n    },\n    getAncestors: function(s, root) {\n        var ancestors, index, state;\n        index = s.ancestors.indexOf(root);\n        if (index > -1) {\n            return s.ancestors.slice(0, index);\n        } else {\n            return s.ancestors;\n        }\n    },\n    isOrthogonalTo: function(s1, s2) {\n        //Two control states are orthogonal if they are not ancestrally\n        //related, and their smallest, mutual parent is a Concurrent-state.\n        return !this.isAncestrallyRelatedTo(s1, s2) && this.getLCA(s1, s2).typeEnum === constants.STATE_TYPES.PARALLEL;\n    },\n    isAncestrallyRelatedTo: function(s1, s2) {\n        //Two control states are ancestrally related if one is child/grandchild of another.\n        return this.getAncestorsOrSelf(s2).indexOf(s1) > -1 || this.getAncestorsOrSelf(s1).indexOf(s2) > -1;\n    },\n    getAncestorsOrSelf: function(s, root) {\n        return [s].concat(query.getAncestors(s, root));\n    },\n    getDescendantsOrSelf: function(s) {\n        return [s].concat(s.descendants);\n    },\n    getLCA: function(s1, s2) {\n        var commonAncestors = this.getAncestors(s1).filter(function(a){\n            return a.descendants.indexOf(s2) > -1;\n        },this);\n        return commonAncestors[0];\n    }\n};\n\nmodule.exports = query;\n\n},{\"./constants\":2}],5:[function(require,module,exports){\n(function (process){\n//   Copyright 2012-2012 Jacob Beard, INFICON, and other SCION contributors\n//\n//   Licensed under the Apache License, Version 2.0 (the \"License\");\n//   you may not use this file except in compliance with the License.\n//   You may obtain a copy of the License at\n//\n//       http://www.apache.org/licenses/LICENSE-2.0\n//\n//   Unless required by applicable law or agreed to in writing, software\n//   distributed under the License is distributed on an \"AS IS\" BASIS,\n//   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n//   See the License for the specific language governing permissions and\n//   limitations under the License.\n\n/**\n * SCION-CORE global object\n * @namespace scion\n */\n\n/**\n * An Array of strings representing the ids all of the basic states the\n * interpreter is in after a big-step completes.\n * @typedef {Array<string>} Configuration\n */\n\n/**\n * A set of basic and composite state ids.\n * @typedef {Array<string>} FullConfiguration\n */\n\n/**\n * A set of basic and composite state ids.\n * @typedef {Array<string>} FullConfiguration\n */\n\n\"use strict\";\n\nconst EventEmitter = require('tiny-events').EventEmitter,\n  util = require('util'),\n  ArraySet = require('./ArraySet'),\n  constants = require('./constants'),\n  helpers = require('./helpers'),\n  query = require('./query'),\n  extend = helpers.extend,\n  transitionWithTargets = helpers.transitionWithTargets,\n  transitionComparator = helpers.transitionComparator,\n  initializeModel = helpers.initializeModel,\n  isEventPrefixMatch = helpers.isEventPrefixMatch,\n  isTransitionMatch = helpers.isTransitionMatch,\n  scxmlPrefixTransitionSelector = helpers.scxmlPrefixTransitionSelector,\n  eventlessTransitionSelector = helpers.eventlessTransitionSelector,\n  getTransitionWithHigherSourceChildPriority = helpers.getTransitionWithHigherSourceChildPriority,\n  sortInEntryOrder = helpers.sortInEntryOrder,\n  getStateWithHigherSourceChildPriority = helpers.getStateWithHigherSourceChildPriority,\n  initializeModelGeneratorFn = helpers.initializeModelGeneratorFn,\n  deserializeSerializedConfiguration = helpers.deserializeSerializedConfiguration,\n  deserializeHistory = helpers.deserializeHistory,\n  BASIC = constants.STATE_TYPES.BASIC,\n  COMPOSITE = constants.STATE_TYPES.COMPOSITE,\n  PARALLEL = constants.STATE_TYPES.PARALLEL,\n  HISTORY = constants.STATE_TYPES.HISTORY,\n  INITIAL = constants.STATE_TYPES.INITIAL,\n  FINAL = constants.STATE_TYPES.FINAL,\n  SCXML_IOPROCESSOR_TYPE  = constants.SCXML_IOPROCESSOR_TYPE;\n\nconst printTrace = typeof process !== 'undefined' && !!process.env.DEBUG;\n\n\n/**\n * @interface EventEmitter\n */\n\n/**\n* @event scion.BaseInterpreter#onError\n* @property {string} tagname The name of the element that produced the error. \n* @property {number} line The line in the source file in which the error occurred.\n* @property {number} column The column in the source file in which the error occurred.\n* @property {string} reason An informative error message. The text is platform-specific and subject to change.\n*/\n\n\n/**\n * @function\n * @name EventEmitter.prototype#on\n * @param {string} type\n * @param {callback} listener\n */\n\n/**\n * @function\n * @name EventEmitter.prototype#once\n * @param {string} type\n * @param {callback} listener\n */\n\n/**\n * @function\n * @name EventEmitter.prototype#off\n * @param {string} type\n * @param {callback} listener\n */\n\n/**\n * @function\n * @name EventEmitter.prototype#emit\n * @param {string} type\n * @param {any} args\n */\n/** \n * @description The SCXML constructor creates an interpreter instance from a model object.\n * @abstract\n * @class BaseInterpreter\n * @memberof scion\n * @extends EventEmitter\n * @param {SCJSON | scxml.ModelFactory} modelOrModelFactory Either an SCJSON root state; or an scxml.ModelFactory, which is a function which returns an SCJSON object. \n * @param opts\n * @param {string} [opts.sessionid] Used to populate SCXML _sessionid.\n * @param {function} [opts.generateSessionid] Factory used to generate sessionid if sessionid keyword is not specified\n * @param {Map<string, BaseInterpreter>} [opts.sessionRegistry] Map used to map sessionid strings to Statechart instances.\n * @param [opts.Set] Class to use as an ArraySet. Defaults to ES6 Set.\n * @param {object} [opts.params]  Used to pass params from invoke. Sets the datamodel when interpreter is instantiated.\n * @param {Snapshot} [opts.snapshot] State machine snapshot. Used to restore a serialized state machine.\n * @param {Statechart} [opts.parentSession]  Used to pass parent session during invoke.\n * @param {string }[opts.invokeid]  Support for id of invoke element at runtime.\n * @param {boolean} [opts.legacySemantics]\n * @param [opts.console]\n * @param [opts.transitionSelector]\n * @param [opts.customCancel]\n * @param [opts.customSend]\n * @param [opts.sendAsync]\n * @param [opts.doSend]\n * @param [opts.invokers]\n * @param [opts.xmlParser]\n * @param [opts.interpreterScriptingContext]\n */\nclass BaseInterpreter extends EventEmitter {\n\n  constructor(modelOrModelFactory, opts){\n\n    super();\n\n    this.opts = opts;\n\n    this.opts.InterpreterScriptingContext = this.opts.InterpreterScriptingContext || InterpreterScriptingContext;\n\n    this._isStepping = false;\n\n    this._scriptingContext = this.opts.interpreterScriptingContext || (this.opts.InterpreterScriptingContext ? new this.opts.InterpreterScriptingContext(this) : {}); \n\n    this.opts.generateSessionid = this.opts.generateSessionid || BaseInterpreter.generateSessionid;\n    this.opts.sessionid = this.opts.sessionid || this.opts.generateSessionid();\n    this.opts.sessionRegistry = this.opts.sessionRegistry || BaseInterpreter.sessionRegistry;  //TODO: define a better interface. For now, assume a Map<sessionid, session>\n\n\n    let _ioprocessors = {};\n    _ioprocessors[SCXML_IOPROCESSOR_TYPE] = {\n      location : `#_scxml_${this.opts.sessionid}`\n    }\n    _ioprocessors.scxml = _ioprocessors[SCXML_IOPROCESSOR_TYPE];    //alias\n\n    //SCXML system variables:\n    this.opts._x = {\n        _sessionid : this.opts.sessionid,\n        _ioprocessors : _ioprocessors\n    };\n\n\n    var model;\n    if(typeof modelOrModelFactory === 'function'){\n        model = initializeModelGeneratorFn(modelOrModelFactory, this.opts, this);\n    }else if(typeof modelOrModelFactory === 'object'){\n        model = JSON.parse(JSON.stringify(modelOrModelFactory)); //assume object\n    }else{\n        throw new Error('Unexpected model type. Expected model factory function, or scjson object.');\n    }\n\n    this._model = initializeModel(model, this.opts);\n\n    this.opts.console = this.opts.console || (typeof console === 'undefined' ? {log : function(){}} : console);   //rely on global console if this console is undefined\n    this.opts.Set = this.opts.Set || ArraySet;\n    this.opts.priorityComparisonFn = this.opts.priorityComparisonFn || getTransitionWithHigherSourceChildPriority;\n    this.opts.transitionSelector = this.opts.transitionSelector || scxmlPrefixTransitionSelector;\n\n    this.opts.sessionRegistry.set(String(this.opts.sessionid), this);\n\n    this._scriptingContext.log = this._scriptingContext.log || (function log(){ \n      if(this.opts.console.log.apply){\n        this.opts.console.log.apply(this.opts.console, arguments); \n      } else {\n        //console.log on older IE does not support Function.apply, so just pass him the first argument. Best we can do for now.\n        this.opts.console.log(Array.prototype.slice.apply(arguments).join(',')); \n      }\n    }.bind(this));   //set up default scripting context log function\n\n    this._externalEventQueue = [];\n    this._internalEventQueue = [];\n\n    if(this.opts.params){\n      this._model.$deserializeDatamodel(this.opts.params);   //load up the datamodel\n    }\n\n    //check if we're loading from a previous snapshot\n    if(this.opts.snapshot){\n      this._configuration = new this.opts.Set(deserializeSerializedConfiguration(this.opts.snapshot[0], this._model.$idToStateMap));\n      this._historyValue = deserializeHistory(this.opts.snapshot[1], this._model.$idToStateMap); \n      this._isInFinalState = this.opts.snapshot[2];\n      this._model.$deserializeDatamodel(this.opts.snapshot[3]);   //load up the datamodel\n      this._internalEventQueue = this.opts.snapshot[4];\n    }else{\n      this._configuration = new this.opts.Set();\n      this._historyValue = {};\n      this._isInFinalState = false;\n    }\n\n    //add debug logging\n    BaseInterpreter.EVENTS.forEach(function(event){\n      this.on(event, this._log.bind(this,event));\n    }, this);\n\n    module.exports.emit('new',this);\n  }\n\n  /** \n  * Cancels the session. This clears all timers; puts the interpreter in a\n  * final state; and runs all exit actions on current states.\n  * @memberof BaseInterpreter.prototype\n  */\n  cancel(){\n    delete this.opts.parentSession;\n    if(this._isInFinalState) return;\n    this._isInFinalState = true;\n    this._log(`session cancelled ${this.opts.invokeid}`);\n    this._exitInterpreter(null);\n  }\n\n  _exitInterpreter(event){\n    //TODO: cancel invoked sessions\n    //cancel all delayed sends when we enter into a final state.\n    this._cancelAllDelayedSends();\n\n    let statesToExit = this._getFullConfiguration().sort(getStateWithHigherSourceChildPriority);\n\n    for (var j = 0, len = statesToExit.length; j < len; j++) {\n        var stateExited = statesToExit[j];\n\n        if(stateExited.onExit !== undefined) {\n            for (var exitIdx = 0, exitLen = stateExited.onExit.length; exitIdx < exitLen; exitIdx++) {\n                let block = stateExited.onExit[exitIdx];\n                for (let blockIdx = 0, blockLen = block.length; blockIdx < blockLen; blockIdx++) {\n                    let actionRef = block[blockIdx];\n                    try {\n                      actionRef.call(this._scriptingContext, null);\n                    } catch (e){\n                      this._handleError(e, actionRef);\n                      break;\n                    }\n                }\n            }\n        }\n\n        //cancel invoked session\n        if(stateExited.invokes) stateExited.invokes.forEach( invoke => {\n          this._scriptingContext.cancelInvoke(invoke.id);\n        })\n\n        //if he is a top-level <final> state, then return the done event\n        if( stateExited.$type === 'final' &&\n            stateExited.parent.$type === 'scxml'){\n\n          if(this.opts.parentSession){\n            this._scriptingContext.send({\n              target: '#_parent', \n              name: 'done.invoke.' + this.opts.invokeid,\n              data : stateExited.donedata && stateExited.donedata.call(this._scriptingContext, event)\n            });\n          }\n\n          this.opts.sessionRegistry.delete(this.opts.sessionid);\n          this.emit('onExitInterpreter', event);\n        }\n    }\n\n  }\n\n  /** \n   * Starts the interpreter. Should only be called once, and should be called\n   * before BaseInterpreter.prototype#gen is called for the first time.  Returns a\n   * Configuration.\n   * @return {Configuration}\n   * @memberof BaseInterpreter.prototype\n   * @emits scion.BaseInterpreter#onEntry\n   * @emits scion.BaseInterpreter#onExit\n   * @emits scion.BaseInterpreter#onTransition\n   * @emits scion.BaseInterpreter#onDefaultEntry\n   * @emits scion.BaseInterpreter#onError\n   * @emits scion.BaseInterpreter#onBigStepBegin\n   * @emits scion.BaseInterpreter#onBigStepEnd\n   * @emits scion.BaseInterpreter#onBigStepSuspend\n   * @emits scion.BaseInterpreter#onBigStepResume\n   * @emits scion.BaseInterpreter#onSmallStepBegin\n   * @emits scion.BaseInterpreter#onSmallStepEnd\n   * @emits scion.BaseInterpreter#onBigStepEnd\n   * @emits scion.BaseInterpreter#onExitInterpreter\n   */\n  start() {\n      this._initStart();\n      this._performBigStep();\n      return this.getConfiguration();\n  }\n\n\n  /**\n   * This callback is displayed as a global member.\n   * @callback genCallback\n   * @param {Error} err\n   * @param {Configuration} configuration\n   */\n\n  /**\n   * Starts the interpreter asynchronously\n   * @param  {genCallback} cb Callback invoked with an error or the interpreter's stable configuration\n   * @memberof BaseInterpreter.prototype \n   * @emits scion.BaseInterpreter#onEntry\n   * @emits scion.BaseInterpreter#onExit\n   * @emits scion.BaseInterpreter#onTransition\n   * @emits scion.BaseInterpreter#onDefaultEntry\n   * @emits scion.BaseInterpreter#onError\n   * @emits scion.BaseInterpreter#onBigStepBegin\n   * @emits scion.BaseInterpreter#onBigStepEnd\n   * @emits scion.BaseInterpreter#onBigStepSuspend\n   * @emits scion.BaseInterpreter#onBigStepResume\n   * @emits scion.BaseInterpreter#onSmallStepBegin\n   * @emits scion.BaseInterpreter#onSmallStepEnd\n   * @emits scion.BaseInterpreter#onBigStepEnd\n   * @emits scion.BaseInterpreter#onExitInterpreter\n   */\n  startAsync(cb) {\n      cb = this._initStart(cb);\n      this.genAsync(null, cb);\n  }\n\n  _initStart(cb){\n      if (typeof cb !== 'function') {\n          cb = nop;\n      }\n\n      this._log(\"performing initial big step\");\n\n      //We effectively need to figure out states to enter here to populate initial config. assuming root is compound state makes this simple.\n      //but if we want it to be parallel, then this becomes more complex. so when initializing the model, we add a 'fake' root state, which\n      //makes the following operation safe.\n      this._model.initialRef.forEach( s => this._configuration.add(s) );\n\n      return cb;\n  }\n\n  /** \n  * Returns state machine {@link Configuration}.\n  * @return {Configuration}\n  * @memberof BaseInterpreter.prototype \n  */\n  getConfiguration() {\n      return this._configuration.iter().map(function(s){return s.id;});\n  }\n\n  _getFullConfiguration(){\n      return this._configuration.iter().\n              map(function(s){ return [s].concat(query.getAncestors(s));},this).\n              reduce(function(a,b){return a.concat(b);},[]).    //flatten\n              reduce(function(a,b){return a.indexOf(b) > -1 ? a : a.concat(b);},[]); //uniq\n  }\n\n\n  /** \n  * @return {FullConfiguration}\n  * @memberof BaseInterpreter.prototype \n  */\n  getFullConfiguration() {\n      return this._getFullConfiguration().map(function(s){return s.id;});\n  }\n\n\n  /** \n  * @return {boolean}\n  * @memberof BaseInterpreter.prototype \n  * @param {string} stateName\n  */\n  isIn(stateName) {\n      return this.getFullConfiguration().indexOf(stateName) > -1;\n  }\n\n  /** \n  * Is the state machine in a final state?\n  * @return {boolean}\n  * @memberof BaseInterpreter.prototype \n  */\n  isFinal() {\n      return this._isInFinalState;\n  }\n\n  /** @private */\n  _performBigStep(e) {\n      let currentEvent, keepGoing, allStatesExited, allStatesEntered;\n      [allStatesExited, allStatesEntered, keepGoing, currentEvent] = this._startBigStep(e);\n\n      while (keepGoing) {\n        [currentEvent, keepGoing] = this._selectTransitionsAndPerformSmallStep(currentEvent, allStatesEntered, allStatesExited);\n      }\n\n      this._finishBigStep(currentEvent, allStatesEntered, allStatesExited);\n  }\n\n  _selectTransitionsAndPerformSmallStep(currentEvent, allStatesEntered, allStatesExited){\n      //first select with null event\n      var selectedTransitions  = this._selectTransitions(currentEvent, true);\n      if(selectedTransitions.isEmpty()){\n        let ev = this._internalEventQueue.shift();\n        if(ev){ \n          currentEvent = ev;\n          selectedTransitions = this._selectTransitions(currentEvent, false);\n        }\n      }\n\n      if(!selectedTransitions.isEmpty()){\n        this.emit('onSmallStepBegin', currentEvent);\n        let statesExited, statesEntered;\n        [statesExited, statesEntered] = this._performSmallStep(currentEvent, selectedTransitions);\n        if(statesExited) statesExited.forEach( s => allStatesExited.add(s) );\n        if(statesEntered) statesEntered.forEach( s => allStatesEntered.add(s) );\n        this.emit('onSmallStepEnd', currentEvent);\n      }\n      let keepGoing = !selectedTransitions.isEmpty() || this._internalEventQueue.length;\n      return [currentEvent, keepGoing];\n  }\n\n  _startBigStep(e){\n      this.emit('onBigStepBegin', e);\n\n      //do applyFinalize and autoforward\n      this._configuration.iter().forEach(state => {\n        if(state.invokes) state.invokes.forEach( invoke =>  {\n          if(invoke.autoforward){\n            //autoforward\n            this._scriptingContext.send({\n              target: `#_${invoke.id}`, \n              name: e.name,\n              data : e.data\n            });\n          }\n          if(invoke.id === e.invokeid){\n            //applyFinalize\n            if(invoke.finalize) invoke.finalize.forEach( action =>  this._evaluateAction(e, action));\n          } \n        })\n      }); \n\n      if (e) this._internalEventQueue.push(e);\n\n      let allStatesExited = new Set(), allStatesEntered = new Set();\n      let keepGoing = true;\n      let currentEvent = e;\n      return [allStatesEntered, allStatesExited, keepGoing, currentEvent];\n  }\n\n  _finishBigStep(e, allStatesEntered, allStatesExited, cb){\n      let statesToInvoke = Array.from(new Set([...allStatesEntered].filter(s => s.invokes && !allStatesExited.has(s)))).sort(sortInEntryOrder);\n\n      // Here we invoke whatever needs to be invoked. The implementation of 'invoke' is platform-specific\n      statesToInvoke.forEach( s => {\n          s.invokes.forEach( f =>  this._evaluateAction(e,f) )\n      });\n\n      // cancel invoke for allStatesExited\n      allStatesExited.forEach( s => {\n        if(s.invokes) s.invokes.forEach( invoke => {\n          this._scriptingContext.cancelInvoke(invoke.id);\n        })\n      });\n\n      // TODO: Invoking may have raised internal error events and we iterate to handle them        \n      //if not internalQueue.isEmpty():\n      //    continue\n\n      this._isInFinalState = this._configuration.iter().every(function(s){ return s.typeEnum === FINAL; });\n      if(this._isInFinalState){\n        this._exitInterpreter(e);\n      }\n      this.emit('onBigStepEnd', e);\n      if(cb) cb(undefined, this.getConfiguration());\n  }\n\n  _cancelAllDelayedSends(){\n    for( let timeoutOptions of this._scriptingContext._timeouts){\n      if(!timeoutOptions.sendOptions.delay) continue;\n      this._log('cancelling delayed send', timeoutOptions);\n      clearTimeout(timeoutOptions.timeoutHandle);\n      this._scriptingContext._timeouts.delete(timeoutOptions);\n    }\n    Object.keys(this._scriptingContext._timeoutMap).forEach(function(key){\n      delete this._scriptingContext._timeoutMap[key];\n    }, this);\n  }\n\n  _performBigStepAsync(e, cb) {\n      let currentEvent, keepGoing, allStatesExited, allStatesEntered;\n      [allStatesExited, allStatesEntered, keepGoing, currentEvent] = this._startBigStep(e);\n\n      function nextStep(emit){\n        this.emit(emit);\n        [currentEvent, keepGoing] = this._selectTransitionsAndPerformSmallStep(currentEvent, allStatesEntered, allStatesExited);\n\n        if(keepGoing){\n          this.emit('onBigStepSuspend');\n          setImmediate(nextStep.bind(this,'onBigStepResume'));\n        }else{\n          this._finishBigStep(currentEvent, allStatesEntered, allStatesExited, cb);\n        }\n      }\n      nextStep.call(this,'onBigStepBegin');\n  }\n\n  /** @private */\n  _performSmallStep(currentEvent, selectedTransitions) {\n\n      this._log(\"selecting transitions with currentEvent\", currentEvent);\n\n      this._log(\"selected transitions\", selectedTransitions);\n\n      let statesExited,\n          statesEntered;\n\n      if (!selectedTransitions.isEmpty()) {\n\n          //we only want to enter and exit states from transitions with targets\n          //filter out targetless transitions here - we will only use these to execute transition actions\n          var selectedTransitionsWithTargets = new this.opts.Set(selectedTransitions.iter().filter(transitionWithTargets));\n\n          statesExited = this._exitStates(currentEvent, selectedTransitionsWithTargets)\n          this._executeTransitions(currentEvent, selectedTransitions);\n          statesEntered = this._enterStates(currentEvent, selectedTransitionsWithTargets)\n\n          this._log(\"new configuration \", this._configuration);\n      }\n\n      return [statesExited, statesEntered];\n  }\n\n  _exitStates(currentEvent, selectedTransitionsWithTargets){\n      let basicStatesExited, statesExited;\n      [basicStatesExited, statesExited] = this._getStatesExited(selectedTransitionsWithTargets); \n\n      this._log('exiting states')\n      for (var j = 0, len = statesExited.length; j < len; j++) {\n          var stateExited = statesExited[j];\n\n          if(stateExited.isAtomic) this._configuration.remove(stateExited);\n\n          this._log(\"exiting \", stateExited.id);\n\n          //invoke listeners\n          this.emit('onExit',stateExited.id)\n\n          if(stateExited.onExit !== undefined) {\n              for (var exitIdx = 0, exitLen = stateExited.onExit.length; exitIdx < exitLen; exitIdx++) {\n                  let block = stateExited.onExit[exitIdx];\n                  for (let blockIdx = 0, blockLen = block.length; blockIdx < blockLen; blockIdx++) {\n                      let actionRef = block[blockIdx];\n                      try {\n                        actionRef.call(this._scriptingContext, currentEvent);\n                      } catch (e){\n                        this._handleError(e, actionRef);\n                        break;\n                      }\n                  }\n              }\n          }\n\n          var f;\n          if (stateExited.historyRef) {\n              for(let historyRef of stateExited.historyRef){\n                  if (historyRef.isDeep) {\n                      f = function(s0) {\n                          return s0.typeEnum === BASIC && stateExited.descendants.indexOf(s0) > -1;\n                      };\n                  } else {\n                      f = function(s0) {\n                          return s0.parent === stateExited;\n                      };\n                  }\n                  //update history\n                  this._historyValue[historyRef.id] = statesExited.filter(f);\n              }\n          }\n      }\n\n      return statesExited;\n  }\n\n  /** @private */\n  _getStatesExited(transitions) {\n    var statesExited = new this.opts.Set();\n    var basicStatesExited = new this.opts.Set();\n\n    //States exited are defined to be active states that are\n    //descendants of the scope of each priority-enabled transition.\n    //Here, we iterate through the transitions, and collect states\n    //that match this condition. \n    var transitionList = transitions.iter();\n    for (var txIdx = 0, txLen = transitionList.length; txIdx < txLen; txIdx++) {\n      var transition = transitionList[txIdx];\n      var scope = transition.scope,\n          desc = scope.descendants;\n\n      //For each state in the configuration\n      //is that state a descendant of the transition scope?\n      //Store ancestors of that state up to but not including the scope.\n      var configList = this._configuration.iter();\n      for (var cfgIdx = 0, cfgLen = configList.length; cfgIdx < cfgLen; cfgIdx++) {\n        var state = configList[cfgIdx];\n        if(desc.indexOf(state) > -1){\n          basicStatesExited.add(state);\n          statesExited.add(state);\n          var ancestors = query.getAncestors(state,scope); \n          for (var ancIdx = 0, ancLen = ancestors.length; ancIdx < ancLen; ancIdx++) { \n            statesExited.add(ancestors[ancIdx]);\n          }\n        }\n      }\n    }\n\n    var sortedStatesExited = statesExited.iter().sort(getStateWithHigherSourceChildPriority);\n    return [basicStatesExited, sortedStatesExited];\n  }\n\n  _executeTransitions(currentEvent, selectedTransitions){\n      var sortedTransitions = selectedTransitions.iter().sort(transitionComparator);\n\n      this._log(\"executing transitition actions\");\n      for (var stxIdx = 0, len = sortedTransitions.length; stxIdx < len; stxIdx++) {\n          var transition = sortedTransitions[stxIdx];\n\n          var targetIds = transition.targets && transition.targets.map(function(target){return target.id;});\n\n          this.emit('onTransition',transition.source.id,targetIds, transition.source.transitions.indexOf(transition));\n\n          if(transition.onTransition !== undefined) {\n              for (var txIdx = 0, txLen = transition.onTransition.length; txIdx < txLen; txIdx++) {\n                  let actionRef = transition.onTransition[txIdx];\n                  try {\n                    actionRef.call(this._scriptingContext, currentEvent);\n                  } catch (e){\n                    this._handleError(e, actionRef);\n                    break;\n                  }\n              }\n          }\n      }\n  }\n\n  _enterStates(currentEvent, selectedTransitionsWithTargets){\n      this._log(\"entering states\");\n\n      let statesEntered = new Set();\n      let statesForDefaultEntry = new Set();\n      // initialize the temporary table for default content in history states\n      let defaultHistoryContent = {};\n      this._computeEntrySet(selectedTransitionsWithTargets, statesEntered, statesForDefaultEntry, defaultHistoryContent); \n      statesEntered = [...statesEntered].sort(sortInEntryOrder); \n\n      this._log(\"statesEntered \", statesEntered);\n\n      for (var enterIdx = 0, enterLen = statesEntered.length; enterIdx < enterLen; enterIdx++) {\n          var stateEntered = statesEntered[enterIdx];\n\n          if(stateEntered.isAtomic) this._configuration.add(stateEntered);\n\n          this._log(\"entering\", stateEntered.id);\n\n          this.emit('onEntry',stateEntered.id);\n\n          if(stateEntered.onEntry !== undefined) {\n              for (var entryIdx = 0, entryLen = stateEntered.onEntry.length; entryIdx < entryLen; entryIdx++) {\n                  let block = stateEntered.onEntry[entryIdx];\n                  for (let blockIdx = 0, blockLen = block.length; blockIdx < blockLen; blockIdx++) {\n                      let actionRef = block[blockIdx];\n                      try {\n                        actionRef.call(this._scriptingContext, currentEvent);\n                      } catch (e){\n                        this._handleError(e, actionRef);\n                        break;\n                      }\n                  }\n              }\n          }\n\n          if(statesForDefaultEntry.has(stateEntered)){\n              for(let initialState of stateEntered.initialRef){\n                  this.emit('onDefaultEntry', initialState.id);\n                  if(initialState.typeEnum === INITIAL){\n                      let transition = initialState.transitions[0]\n                      if(transition.onTransition !== undefined) {\n                          this._log('executing initial transition content for initial state of parent state',stateEntered.id);\n                          for (var txIdx = 0, txLen = transition.onTransition.length; txIdx < txLen; txIdx++) {\n                              let actionRef = transition.onTransition[txIdx];\n                              try {\n                                actionRef.call(this._scriptingContext, currentEvent);\n                              } catch (e){\n                                this._handleError(e, actionRef);\n                                break;\n                              }\n                          }\n                      }\n                  }\n              }\n          }\n\n\n          if(defaultHistoryContent[stateEntered.id]){\n              let transition = defaultHistoryContent[stateEntered.id]\n              if(transition.onTransition !== undefined) {\n                  this._log('executing history transition content for history state of parent state',stateEntered.id);\n                  for (var txIdx = 0, txLen = transition.onTransition.length; txIdx < txLen; txIdx++) {\n                      let actionRef = transition.onTransition[txIdx];\n                      try {\n                        actionRef.call(this._scriptingContext, currentEvent);\n                      } catch (e){\n                        this._handleError(e, actionRef);\n                        break;\n                      }\n                  }\n              }\n          }\n      }\n\n      for (var enterIdx = 0, enterLen = statesEntered.length; enterIdx < enterLen; enterIdx++) {\n          var stateEntered = statesEntered[enterIdx];\n          if(stateEntered.typeEnum === FINAL){\n            let parent = stateEntered.parent;\n            let grandparent = parent.parent;\n            this._internalEventQueue.push({name : \"done.state.\" + parent.id, data : stateEntered.donedata && stateEntered.donedata.call(this._scriptingContext, currentEvent)});\n            if(grandparent && grandparent.typeEnum === PARALLEL){\n                if(grandparent.states.every(s => this.isInFinalState(s) )){\n                    this._internalEventQueue.push({name : \"done.state.\" + grandparent.id});\n                }\n            }\n          }\n      }\n\n      return statesEntered;\n  }\n\n  _getEffectiveTargetStates(transition){\n    let targets = new Set();\n    for(let s of transition.targets){\n      if(s.typeEnum === HISTORY){\n        if(s.id in this._historyValue)\n          this._historyValue[s.id].forEach( state => targets.add(state))\n        else\n          [...this._getEffectiveTargetStates(s.transitions[0])].forEach( state => targets.add(state))\n      } else {\n        targets.add(s)\n      }\n    }\n    return targets\n  }\n\n  _computeEntrySet(transitions, statesToEnter, statesForDefaultEntry, defaultHistoryContent){\n    for(let t of transitions.iter()){\n      for(let s of t.targets){\n        this._addDescendantStatesToEnter(s,statesToEnter, statesForDefaultEntry, defaultHistoryContent) \n      }\n      let ancestor = t.scope;\n      for(let s of this._getEffectiveTargetStates(t)){\n        this._addAncestorStatesToEnter(s, ancestor, statesToEnter, statesForDefaultEntry, defaultHistoryContent)\n      }\n    }\n  }\n\n  _computeExitSet(transitions) {\n    let statesToExit = new Set();\n    for(let t of transitions){\n      if(t.targets){\n        let scope = t.scope;\n        for(let s of this._getFullConfiguration()){\n          if(query.isDescendant(s,scope)) statesToExit.add(s);\n        }\n      }\n    }\n    return statesToExit; \n  }\n\n  _addAncestorStatesToEnter(state, ancestor, statesToEnter, statesForDefaultEntry, defaultHistoryContent){\n    let traverse = (anc) => {\n      if(anc.typeEnum === PARALLEL){\n        for(let child of anc.states){\n          if(child.typeEnum !== HISTORY && ![...statesToEnter].some(s => query.isDescendant(s, child))){\n            this._addDescendantStatesToEnter(child,statesToEnter, statesForDefaultEntry, defaultHistoryContent) \n          }\n        }\n      }\n    };\n    for(let anc of query.getAncestors(state,ancestor)){\n      statesToEnter.add(anc)\n      traverse(anc)\n    }\n    traverse(ancestor)\n  }\n\n\n  _addDescendantStatesToEnter(state,statesToEnter, statesForDefaultEntry, defaultHistoryContent){\n    if(state.typeEnum === HISTORY){\n      if(this._historyValue[state.id]){\n        for(let s of this._historyValue[state.id])\n          this._addDescendantStatesToEnter(s,statesToEnter, statesForDefaultEntry, defaultHistoryContent)\n\n        for(let s of this._historyValue[state.id])\n          this._addAncestorStatesToEnter(s, state.parent, statesToEnter, statesForDefaultEntry, defaultHistoryContent)\n      } else {\n        defaultHistoryContent[state.parent.id] = state.transitions[0]\n        for(let s of state.transitions[0].targets)\n          this._addDescendantStatesToEnter(s,statesToEnter,statesForDefaultEntry, defaultHistoryContent)\n\n        for(let s of state.transitions[0].targets)\n          this._addAncestorStatesToEnter(s, state.parent, statesToEnter, statesForDefaultEntry, defaultHistoryContent)\n\n      }\n    } else {\n      statesToEnter.add(state)\n        if(state.typeEnum === COMPOSITE){\n          statesForDefaultEntry.add(state)\n          //for each state in initialRef, if it is an initial state, then add ancestors and descendants.\n          for(let s of state.initialRef){\n            let targets = s.typeEnum === INITIAL ? s.transitions[0].targets : [s]; \n            for(let targetState of targets){\n              this._addDescendantStatesToEnter(targetState,statesToEnter, statesForDefaultEntry, defaultHistoryContent)\n            }\n          }\n          for(let s of state.initialRef){\n            let targets = s.typeEnum === INITIAL ? s.transitions[0].targets : [s]; \n            for(let targetState of targets){\n              this._addAncestorStatesToEnter(targetState, state, statesToEnter, statesForDefaultEntry, defaultHistoryContent)\n            }\n          }\n        }else{\n          if(state.typeEnum === PARALLEL){\n            for(let child of state.states){\n              if(child.typeEnum !== HISTORY && ![...statesToEnter].some(s => query.isDescendant(s, child))){\n                this._addDescendantStatesToEnter(child,statesToEnter, statesForDefaultEntry, defaultHistoryContent) \n              }\n            }\n          }\n        }\n    }\n  }\n\n  isInFinalState(s){\n      if(s.typeEnum === COMPOSITE){\n          return s.states.some(s => s.typeEnum === FINAL && this._configuration.contains(s));\n      }else if(s.typeEnum === PARALLEL){\n          return s.states.every(this.isInFinalState.bind(this))\n      }else{\n          return false\n      }\n  }\n\n  /** @private */\n  _evaluateAction(currentEvent, actionRef) {\n      try {\n        return actionRef.call(this._scriptingContext, currentEvent);     //SCXML system variables\n      } catch (e){\n        this._handleError(e, actionRef);\n      }\n  }\n\n  _handleError(e, actionRef){\n    let event = \n      e instanceof Error || (typeof e.__proto__.name === 'string' && e.__proto__.name.match(/^.*Error$/)) ?  //we can't just do 'e instanceof Error', because the Error object in the sandbox is from a different context, and instanceof will return false\n        {\n          name:'error.execution',\n          data : {\n            tagname: actionRef.tagname, \n            line: actionRef.line, \n            column: actionRef.column,\n            reason: e.message\n          },\n          type : 'platform'\n        } : \n        (e.name ? \n          e : \n          {\n            name:'error.execution',\n            data:e,\n            type : 'platform'\n          }\n        );\n    this._internalEventQueue.push(event);\n    this.emit('onError', event);\n  }\n\n  _log(){\n    if(printTrace){\n      var args = Array.from(arguments);\n      this.opts.console.log( \n        `${args[0]}: ${\n          args.slice(1).map(function(arg){\n            return arg === null ? 'null' : \n              ( arg === undefined ? 'undefined' : \n                ( typeof arg === 'string' ? arg : \n                  ( arg.toString() === '[object Object]' ? util.inspect(arg) : arg.toString())));\n\n          }).join(', ')\n        }\\n`\n      );\n    }\n  }\n\n  /**\n  * @interface Listener\n  */\n\n  /**\n  * @function\n  * @name Listener#onEntry \n  * @param {string} stateId\n  */\n\n  /**\n  * @function\n  * @name Listener#onExit \n  * @param {string} stateId\n  */\n\n  /**\n  * @function\n  * @name Listener#onTransition \n  * @param {string} sourceStateId Id of the source state\n  * @param {Array<string>} targetStatesIds Ids of the target states\n  * @param {number} transitionIndex Index of the transition relative to other transitions originating from source state.\n  */\n\n  /**\n  * @function\n  * @name Listener#onError\n  * @param {Error} errorInfo\n  */\n\n  /**\n  * @function\n  * @name Listener#onBigStepBegin\n  */\n\n  /**\n  * @function\n  * @name Listener#onBigStepResume\n  */\n\n  /**\n  * @function\n  * @name Listener#onBigStepSuspend\n  */\n\n  /**\n  * @function\n  * @name Listener#onBigStepEnd\n  */\n\n  /**\n  * @function\n  * @name Listener#onSmallStepBegin\n  * @param {string} event\n  */\n\n  /**\n  * @function\n  * @name Listener#onSmallStepEnd\n  */\n\n\n  /** \n  * Provides a generic mechanism to subscribe to state change and runtime\n  * error notifications.  Can be used for logging and debugging. For example,\n  * can attach a logger that simply logs the state changes.  Or can attach a\n  * network debugging client that sends state change notifications to a\n  * debugging server.\n  * This is an alternative interface to {@link EventEmitter.prototype#on}.\n  * @memberof BaseInterpreter.prototype \n  * @param {Listener} listener\n  */\n  registerListener(listener){\n      BaseInterpreter.EVENTS.forEach(function(event){\n        if(listener[event]) this.on(event,listener[event]);\n      }, this);\n  }\n\n  /** \n  * Unregister a Listener\n  * @memberof BaseInterpreter.prototype \n  * @param {Listener} listener\n  */\n  unregisterListener(listener){\n      BaseInterpreter.EVENTS.forEach(function(event){\n        if(listener[event]) this.off(event,listener[event]);\n      }, this);\n  }\n\n  /** \n  * Query the model to get all transition events.\n  * @return {Array<string>} Transition events.\n  * @memberof BaseInterpreter.prototype \n  */\n  getAllTransitionEvents(){\n      var events = {};\n      function getEvents(state){\n\n          if(state.transitions){\n              for (var txIdx = 0, txLen = state.transitions.length; txIdx < txLen; txIdx++) {\n                  events[state.transitions[txIdx].event] = true;\n              }\n          }\n\n          if(state.states) {\n              for (var stateIdx = 0, stateLen = state.states.length; stateIdx < stateLen; stateIdx++) {\n                  getEvents(state.states[stateIdx]);\n              }\n          }\n      }\n\n      getEvents(this._model);\n\n      return Object.keys(events);\n  }\n\n  /**\n  * Three things capture the current snapshot of a running SCION interpreter:\n  *\n  *      <ul>\n  *      <li> basic configuration (the set of basic states the state machine is in)</li>\n  *      <li> history state values (the states the state machine was in last time it was in the parent of a history state)</li>\n  *      <li> the datamodel</li>\n  *      </ul>\n  *      \n  * The snapshot object can be serialized as JSON and saved to a database. It can\n  * later be passed to the SCXML constructor to restore the state machine\n  * using the snapshot argument.\n  *\n  * @return {Snapshot} \n  * @memberof BaseInterpreter.prototype \n  */\n  getSnapshot(){\n    return [\n      this.getConfiguration(),\n      this._serializeHistory(),\n      this._isInFinalState,\n      this._model.$serializeDatamodel(),\n      this._internalEventQueue.slice()\n    ];\n  }\n\n  _serializeHistory(){\n    var o = {};\n    Object.keys(this._historyValue).forEach(function(sid){\n      o[sid] = this._historyValue[sid].map(function(state){return state.id});\n    },this);\n    return o;\n  }\n\n\n  /**\n   * @interface Event\n   */\n\n  /** \n  * @member name\n  * @memberof Event.prototype \n  * @type string\n  * @description The name of the event\n  */\n\n  /** \n  * @member data\n  * @memberof Event.prototype \n  * @type any\n  * @description The event data\n  */\n\n  /** \n  * An SCXML interpreter takes SCXML events as input, where an SCXML event is an\n  * object with \"name\" and \"data\" properties. These can be passed to method `gen`\n  * as two positional arguments, or as a single object.\n  * @param {string|Event} evtObjOrName\n  * @param {any=} optionalData\n  * @emits scion.BaseInterpreter#onEntry\n  * @emits scion.BaseInterpreter#onExit\n  * @emits scion.BaseInterpreter#onTransition\n  * @emits scion.BaseInterpreter#onDefaultEntry\n  * @emits scion.BaseInterpreter#onError\n  * @emits scion.BaseInterpreter#onBigStepBegin\n  * @emits scion.BaseInterpreter#onBigStepEnd\n  * @emits scion.BaseInterpreter#onBigStepSuspend\n  * @emits scion.BaseInterpreter#onBigStepResume\n  * @emits scion.BaseInterpreter#onSmallStepBegin\n  * @emits scion.BaseInterpreter#onSmallStepEnd\n  * @emits scion.BaseInterpreter#onBigStepEnd\n  * @emits scion.BaseInterpreter#onExitInterpreter\n  */\n  gen(evtObjOrName,optionalData) {\n    var currentEvent;\n    switch(typeof evtObjOrName){\n      case 'string':\n        currentEvent = {name : evtObjOrName, data : optionalData};\n        break;\n      case 'object':\n        if(typeof evtObjOrName.name === 'string'){\n          currentEvent = evtObjOrName;\n        }else{\n          throw new Error('Event object must have \"name\" property of type string.');\n        }\n        break;\n      default:\n        throw new Error('First argument to gen must be a string or object.');\n    }\n\n    if(this._isStepping) throw new Error('Cannot call gen during a big-step');\n\n    //otherwise, kick him off\n    this._isStepping = true;\n\n    this._performBigStep(currentEvent);\n\n    this._isStepping = false;\n    return this.getConfiguration();\n  }\n\n  /**\n  * Injects an external event into the interpreter asynchronously\n  * @param {Event}  currentEvent The event to inject\n  * @param {genCallback} cb Callback invoked with an error or the interpreter's stable configuration\n  * @emits scion.BaseInterpreter#onEntry\n  * @emits scion.BaseInterpreter#onExit\n  * @emits scion.BaseInterpreter#onTransition\n  * @emits scion.BaseInterpreter#onDefaultEntry\n  * @emits scion.BaseInterpreter#onError\n  * @emits scion.BaseInterpreter#onBigStepBegin\n  * @emits scion.BaseInterpreter#onBigStepEnd\n  * @emits scion.BaseInterpreter#onBigStepSuspend\n  * @emits scion.BaseInterpreter#onBigStepResume\n  * @emits scion.BaseInterpreter#onSmallStepBegin\n  * @emits scion.BaseInterpreter#onSmallStepEnd\n  * @emits scion.BaseInterpreter#onBigStepEnd\n  * @emits scion.BaseInterpreter#onExitInterpreter\n  */\n  genAsync(currentEvent, cb) {\n    if (currentEvent !== null && (typeof currentEvent !== 'object' || !currentEvent || typeof currentEvent.name !== 'string')) {\n      throw new Error('Expected currentEvent to be null or an Object with a name');\n    }\n    \n    if (typeof cb !== 'function') {\n      cb = nop;\n    }\n\n    this._externalEventQueue.push([currentEvent, cb]);\n\n    //the semantics we want are to return to the cb the results of processing that particular event.\n    function nextStep(e, c){\n      this._performBigStepAsync(e, function(err, config) {\n        c(err, config);\n\n        if(this._externalEventQueue.length){\n          nextStep.apply(this,this._externalEventQueue.shift());\n        }else{\n          this._isStepping = false;\n        }\n      }.bind(this));\n    }\n    if(!this._isStepping){ \n      this._isStepping = true;\n      nextStep.apply(this,this._externalEventQueue.shift());\n    }\n  }\n}\n\nBaseInterpreter.EVENTS = [\n  'onEntry',\n  'onExit',\n  'onTransition',\n  'onDefaultEntry',\n  'onError',\n  'onBigStepBegin',\n  'onBigStepEnd',\n  'onBigStepSuspend',\n  'onBigStepResume',\n  'onSmallStepBegin',\n  'onSmallStepEnd',\n  'onBigStepEnd',\n  'onExitInterpreter'\n];\n\n//some global singletons to use to generate in-memory session ids, in case the user does not specify these data structures\nBaseInterpreter.sessionIdCounter = 1;\nBaseInterpreter.generateSessionid = function(){\n  return BaseInterpreter.sessionIdCounter++;\n}\nBaseInterpreter.sessionRegistry = new Map();\n\n// Do nothing\n\nfunction nop() {}\n\n\nclass InterpreterScriptingContext{\n  constructor(interpreter){ \n    this._interpreter = interpreter;\n    this._timeoutMap = {};\n    this._invokeMap = {};\n    this._timeouts = new Set()\n\n    //Regex from:\n    //  http://daringfireball.net/2010/07/improved_regex_for_matching_urls\n    //  http://stackoverflow.com/a/6927878\n    this.validateUriRegex = /(#_.*)|\\b((?:[a-z][\\w-]+:(?:\\/{1,3}|[a-z0-9%])|www\\d{0,3}[.]|[a-z0-9.\\-]+[.][a-z]{2,4}\\/)(?:[^\\s()<>]+|\\(([^\\s()<>]+|(\\([^\\s()<>]+\\)))*\\))+(?:\\(([^\\s()<>]+|(\\([^\\s()<>]+\\)))*\\)|[^\\s`!()\\[\\]{};:'\".,<>?]))/i;\n\n    this.invokeSendTargetRegex = /^#_(.*)$/;\n    this.scxmlSendTargetRegex = /^#_scxml_(.*)$/;\n  }\n\n\n  raise(event){\n    this._installDefaultPropsOnEvent(event, true);\n    this._interpreter._internalEventQueue.push(event); \n  }\n\n  parseXmlStringAsDOM(xmlString){\n    return (this._interpreter.opts.xmlParser || InterpreterScriptingContext.xmlParser).parse(xmlString);\n  }\n\n  invoke(invokeObj){\n    //look up invoker by type. assume invokers are passed in as an option to constructor\n    this._invokeMap[invokeObj.id] = new Promise((resolve, reject) => {\n      (this._interpreter.opts.invokers || InterpreterScriptingContext.invokers)[invokeObj.type](this._interpreter, invokeObj, (err, session) => {\n        if(err) return reject(err);\n\n        this._interpreter.emit('onInvokedSessionInitialized', session);\n        resolve(session);\n      });\n    });\n  }\n\n  cancelInvoke(invokeid){\n    //TODO: on cancel invoke clean up this._invokeMap\n    let sessionPromise = this._invokeMap[invokeid];\n    this._interpreter._log(`cancelling session with invokeid ${invokeid}`);\n    if(sessionPromise){\n      this._interpreter._log(`sessionPromise found`);\n      sessionPromise.then( \n        ((session) => {\n          this._interpreter._log(`resolved session ${invokeid}. cancelling... `);\n          session.cancel(); \n          //clean up\n          delete this._invokeMap[invokeid];\n        }), \n        ( (err) => {\n          //TODO: dispatch error back into the state machine as error.communication\n        }));\n    }\n  }\n\n  _installDefaultPropsOnEvent(event,isInternal){\n    if(!isInternal){ \n      event.origin = this._interpreter.opts._x._ioprocessors.scxml.location;     //TODO: preserve original origin when we autoforward? \n      event.origintype = event.type || SCXML_IOPROCESSOR_TYPE;\n    }\n    if(typeof event.type === 'undefined'){\n      event.type = isInternal ? 'internal' : 'external';\n    }\n    [\n      'name',\n      'sendid',\n      'invokeid',\n      'data',\n      'origin',\n      'origintype'\n    ].forEach(prop => {\n      if(typeof event[prop] === 'undefined'){\n        event[prop] = undefined;\n      }\n    });\n  }\n\n  send(event, options){\n    this._interpreter._log('send event', event, options);\n    options = options || {};\n    var sendType = options.type || SCXML_IOPROCESSOR_TYPE;\n    //TODO: move these out\n    function validateSend(event, options, sendAction){\n      if(event.target){\n        var targetIsValidUri = this.validateUriRegex.test(event.target)\n        if(!targetIsValidUri){\n          throw { name : \"error.execution\", data: 'Target is not valid URI', sendid: event.sendid, type : 'platform' };\n        }\n      }\n      if( sendType !== SCXML_IOPROCESSOR_TYPE) {  //TODO: extend this to support HTTP, and other IO processors\n        throw { name : \"error.execution\", data: 'Unsupported event processor type', sendid: event.sendid, type : 'platform' };\n      }\n\n      sendAction.call(this, event, options);\n    }\n\n    function defaultSendAction (event, options) {\n\n      if( typeof setTimeout === 'undefined' ) throw new Error('Default implementation of BaseInterpreter.prototype.send will not work unless setTimeout is defined globally.');\n\n      var match;\n      if(event.target === '#_internal'){\n        this.raise(event);\n      }else{ \n        this._installDefaultPropsOnEvent(event, false);\n        event.origintype = SCXML_IOPROCESSOR_TYPE;      //TODO: extend this to support HTTP, and other IO processors\n                                                        //TODO : paramterize this based on send/@type?\n        if(!event.target){\n          doSend.call(this, this._interpreter);\n        }else if(event.target === '#_parent'){\n          if(this._interpreter.opts.parentSession){\n            event.invokeid = this._interpreter.opts.invokeid;\n            doSend.call(this, this._interpreter.opts.parentSession);\n          }else{\n            throw { name : \"error.communication\", data: 'Parent session not specified', sendid: event.sendid, type : 'platform' };\n          }\n        } else if(match = event.target.match(this.scxmlSendTargetRegex)){\n          let targetSessionId = match[1];\n          let session = this._interpreter.opts.sessionRegistry.get(targetSessionId)\n          if(session){\n            doSend.call(this,session);\n          }else {\n            throw {name : 'error.communication', sendid: event.sendid, type : 'platform'};\n          }\n        }else if(match = event.target.match(this.invokeSendTargetRegex)){\n          //TODO: test this code path.\n          var invokeId = match[1]\n          this._invokeMap[invokeId].then( (session) => {\n            doSend.call(this,session);\n          })\n        } else {\n          throw new Error('Unrecognized send target.'); //TODO: dispatch error back into the state machine\n        }\n      }\n\n      function doSend(session){\n        //TODO: we probably now need to refactor data structures:\n        //    this._timeouts\n        //    this._timeoutMap\n        var timeoutHandle = setTimeout(function(){\n          if (event.sendid) delete this._timeoutMap[event.sendid];\n          this._timeouts.delete(timeoutOptions);\n          if(this._interpreter.opts.doSend){\n            this._interpreter.opts.doSend(session, event);\n          }else{\n            session[this._interpreter.opts.sendAsync ? 'genAsync' : 'gen'](event);\n          }\n        }.bind(this), options.delay || 0);\n\n        var timeoutOptions = {\n          sendOptions : options,\n          timeoutHandle : timeoutHandle\n        };\n        if (event.sendid) this._timeoutMap[event.sendid] = timeoutHandle;\n        this._timeouts.add(timeoutOptions); \n      }\n    }\n\n    function publish(){\n      this._interpreter.emit(event.name,event.data);\n    }\n\n    //choose send function\n    //TODO: rethink how this custom send works\n    var sendFn;         \n    if(event.type === 'https://github.com/jbeard4/SCION#publish'){\n      sendFn = publish;\n    }else if(this._interpreter.opts.customSend){\n      sendFn = this._interpreter.opts.customSend;\n    }else{\n      sendFn = defaultSendAction;\n    }\n\n    options=options || {};\n\n    this._interpreter._log(\"sending event\", event.name, \"with content\", event.data, \"after delay\", options.delay);\n\n    validateSend.call(this, event, options, sendFn);\n  }\n\n  cancel(sendid){\n    if(this._interpreter.opts.customCancel) {\n      return this._interpreter.opts.customCancel.apply(this, [sendid]);\n    }\n\n    if( typeof clearTimeout === 'undefined' ) throw new Error('Default implementation of BaseInterpreter.prototype.cancel will not work unless setTimeout is defined globally.');\n\n    if (sendid in this._timeoutMap) {\n      this._interpreter._log(\"cancelling \", sendid, \" with timeout id \", this._timeoutMap[sendid]);\n      clearTimeout(this._timeoutMap[sendid]);\n    }\n  }\n}\n\nmodule.exports = extend(new EventEmitter, {\n    BaseInterpreter: BaseInterpreter,\n    ArraySet : ArraySet,\n    STATE_TYPES : constants.STATE_TYPES,\n    initializeModel : initializeModel,\n    InterpreterScriptingContext : InterpreterScriptingContext,\n    helpers: helpers,\n    query: query\n});\n\n}).call(this,require('_process'))\n},{\"./ArraySet\":1,\"./constants\":2,\"./helpers\":3,\"./query\":4,\"_process\":8,\"tiny-events\":6,\"util\":11}],6:[function(require,module,exports){\nfunction EventEmitter() {\n    this._listeners = {};\n}\n\nEventEmitter.prototype.on = function _on(type, listener) {\n    if (!Array.isArray(this._listeners[type])) {\n        this._listeners[type] = [];\n    }\n\n    if (this._listeners[type].indexOf(listener) === -1) {\n        this._listeners[type].push(listener);\n    }\n\n    return this;\n};\n\nEventEmitter.prototype.once = function _once(type, listener) {\n    var self = this;\n\n    function __once() {\n        for (var args = [], i = 0; i < arguments.length; i += 1) {\n            args[i] = arguments[i];\n        }\n\n        self.off(type, __once);\n        listener.apply(self, args);\n    }\n\n    __once.listener = listener;\n\n    return this.on(type, __once);\n};\n\nEventEmitter.prototype.off = function _off(type, listener) {\n    if (!Array.isArray(this._listeners[type])) {\n        return this;\n    }\n\n    if (typeof listener === 'undefined') {\n        this._listeners[type] = [];\n        return this;\n    }\n\n    var index = this._listeners[type].indexOf(listener);\n\n    if (index === -1) {\n        for (var i = 0; i < this._listeners[type].length; i += 1) {\n            if (this._listeners[type][i].listener === listener) {\n                index = i;\n                break;\n            }\n        }\n    }\n\n    this._listeners[type].splice(index, 1);\n    return this;\n};\n\nEventEmitter.prototype.emit = function _emit(type) {\n    if (!Array.isArray(this._listeners[type])) {\n        return this;\n    }\n\n    for (var args = [], i = 1; i < arguments.length; i += 1) {\n        args[i - 1] = arguments[i];\n    }\n\n    this._listeners[type].forEach(function __emit(listener) {\n        listener.apply(this, args);\n    }, this);\n\n    return this;\n};\n\nmodule.exports.EventEmitter = EventEmitter;\n\n},{}],7:[function(require,module,exports){\n\"use strict\";\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar base = require('scion-core-base'),\n    helpers = base.helpers,\n    query = base.query,\n    transitionComparator = base.helpers.transitionComparator;\n\n/** \n * @description Implements SCION legacy semantics. See {@link scion.BaseInterpreter} for information on the constructor arguments.\n * @class Statechart\n * @extends BaseInterpreter\n */\n\nvar Statechart = function (_base$BaseInterpreter) {\n  _inherits(Statechart, _base$BaseInterpreter);\n\n  function Statechart(modelOrModelFactory, opts) {\n    _classCallCheck(this, Statechart);\n\n    opts = opts || {};\n    opts.legacySemantics = true;\n\n    return _possibleConstructorReturn(this, (Statechart.__proto__ || Object.getPrototypeOf(Statechart)).call(this, modelOrModelFactory, opts));\n  }\n\n  /** @private */\n\n\n  _createClass(Statechart, [{\n    key: \"_selectTransitions\",\n    value: function _selectTransitions(currentEvent, selectEventlessTransitions) {\n      if (this.opts.onlySelectFromBasicStates) {\n        var states = this._configuration.iter();\n      } else {\n        var statesAndParents = new this.opts.Set();\n\n        //get full configuration, unordered\n        //this means we may select transitions from parents before states\n        var configList = this._configuration.iter();\n        for (var idx = 0, len = configList.length; idx < len; idx++) {\n          var basicState = configList[idx];\n          statesAndParents.add(basicState);\n          var ancestors = query.getAncestors(basicState);\n          for (var ancIdx = 0, ancLen = ancestors.length; ancIdx < ancLen; ancIdx++) {\n            statesAndParents.add(ancestors[ancIdx]);\n          }\n        }\n\n        states = statesAndParents.iter();\n      }\n\n      var transitionSelector = this.opts.transitionSelector;\n      var enabledTransitions = new this.opts.Set();\n\n      var e = this._evaluateAction.bind(this, currentEvent);\n\n      for (var stateIdx = 0, stateLen = states.length; stateIdx < stateLen; stateIdx++) {\n        var transitions = states[stateIdx].transitions;\n        for (var txIdx = 0, len = transitions.length; txIdx < len; txIdx++) {\n          var t = transitions[txIdx];\n          if (transitionSelector(t, currentEvent, e, selectEventlessTransitions)) {\n            enabledTransitions.add(t);\n          }\n        }\n      }\n\n      var priorityEnabledTransitions = this._selectPriorityEnabledTransitions(enabledTransitions);\n\n      this._log(\"priorityEnabledTransitions\", priorityEnabledTransitions);\n\n      return priorityEnabledTransitions;\n    }\n\n    /** @private */\n\n  }, {\n    key: \"_selectPriorityEnabledTransitions\",\n    value: function _selectPriorityEnabledTransitions(enabledTransitions) {\n      var priorityEnabledTransitions = new this.opts.Set();\n\n      var tuple = this._getInconsistentTransitions(enabledTransitions),\n          consistentTransitions = tuple[0],\n          inconsistentTransitionsPairs = tuple[1];\n\n      priorityEnabledTransitions.union(consistentTransitions);\n\n      this._log(\"enabledTransitions\", enabledTransitions);\n      this._log(\"consistentTransitions\", consistentTransitions);\n      this._log(\"inconsistentTransitionsPairs\", inconsistentTransitionsPairs);\n      this._log(\"priorityEnabledTransitions\", priorityEnabledTransitions);\n\n      while (!inconsistentTransitionsPairs.isEmpty()) {\n        enabledTransitions = new this.opts.Set(inconsistentTransitionsPairs.iter().map(function (t) {\n          return this.opts.priorityComparisonFn(t);\n        }, this));\n\n        tuple = this._getInconsistentTransitions(enabledTransitions);\n        consistentTransitions = tuple[0];\n        inconsistentTransitionsPairs = tuple[1];\n\n        priorityEnabledTransitions.union(consistentTransitions);\n\n        this._log(\"enabledTransitions\", enabledTransitions);\n        this._log(\"consistentTransitions\", consistentTransitions);\n        this._log(\"inconsistentTransitionsPairs\", inconsistentTransitionsPairs);\n        this._log(\"priorityEnabledTransitions\", priorityEnabledTransitions);\n      }\n      return priorityEnabledTransitions;\n    }\n\n    /** @private */\n\n  }, {\n    key: \"_getInconsistentTransitions\",\n    value: function _getInconsistentTransitions(transitions) {\n      var allInconsistentTransitions = new this.opts.Set();\n      var inconsistentTransitionsPairs = new this.opts.Set();\n      var transitionList = transitions.iter();\n\n      this._log(\"transitions\", transitions);\n\n      for (var i = 0; i < transitionList.length; i++) {\n        for (var j = i + 1; j < transitionList.length; j++) {\n          var t1 = transitionList[i];\n          var t2 = transitionList[j];\n          if (this._conflicts(t1, t2)) {\n            allInconsistentTransitions.add(t1);\n            allInconsistentTransitions.add(t2);\n            inconsistentTransitionsPairs.add([t1, t2]);\n          }\n        }\n      }\n\n      var consistentTransitions = transitions.difference(allInconsistentTransitions);\n      return [consistentTransitions, inconsistentTransitionsPairs];\n    }\n  }, {\n    key: \"_conflicts\",\n    value: function _conflicts(t1, t2) {\n      return !this._isArenaOrthogonal(t1, t2);\n    }\n\n    /** @private */\n\n  }, {\n    key: \"_isArenaOrthogonal\",\n    value: function _isArenaOrthogonal(t1, t2) {\n\n      this._log(\"transition scopes\", t1.scope, t2.scope);\n\n      var isOrthogonal;\n      isOrthogonal = query.isOrthogonalTo(t1.scope || t1.source, t2.scope || t2.source);\n\n      this._log(\"transition scopes are orthogonal?\", isOrthogonal);\n\n      return isOrthogonal;\n    }\n  }]);\n\n  return Statechart;\n}(base.BaseInterpreter);\n\nbase.Statechart = Statechart;\nmodule.exports = base;\n\n},{\"scion-core-base\":5}],8:[function(require,module,exports){\n// shim for using process in browser\nvar process = module.exports = {};\n\n// cached from whatever global is present so that test runners that stub it\n// don't break things.  But we need to wrap it in a try catch in case it is\n// wrapped in strict mode code which doesn't define any globals.  It's inside a\n// function because try/catches deoptimize in certain engines.\n\nvar cachedSetTimeout;\nvar cachedClearTimeout;\n\nfunction defaultSetTimout() {\n    throw new Error('setTimeout has not been defined');\n}\nfunction defaultClearTimeout () {\n    throw new Error('clearTimeout has not been defined');\n}\n(function () {\n    try {\n        if (typeof setTimeout === 'function') {\n            cachedSetTimeout = setTimeout;\n        } else {\n            cachedSetTimeout = defaultSetTimout;\n        }\n    } catch (e) {\n        cachedSetTimeout = defaultSetTimout;\n    }\n    try {\n        if (typeof clearTimeout === 'function') {\n            cachedClearTimeout = clearTimeout;\n        } else {\n            cachedClearTimeout = defaultClearTimeout;\n        }\n    } catch (e) {\n        cachedClearTimeout = defaultClearTimeout;\n    }\n} ())\nfunction runTimeout(fun) {\n    if (cachedSetTimeout === setTimeout) {\n        //normal enviroments in sane situations\n        return setTimeout(fun, 0);\n    }\n    // if setTimeout wasn't available but was latter defined\n    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n        cachedSetTimeout = setTimeout;\n        return setTimeout(fun, 0);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedSetTimeout(fun, 0);\n    } catch(e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\n            return cachedSetTimeout.call(null, fun, 0);\n        } catch(e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\n            return cachedSetTimeout.call(this, fun, 0);\n        }\n    }\n\n\n}\nfunction runClearTimeout(marker) {\n    if (cachedClearTimeout === clearTimeout) {\n        //normal enviroments in sane situations\n        return clearTimeout(marker);\n    }\n    // if clearTimeout wasn't available but was latter defined\n    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n        cachedClearTimeout = clearTimeout;\n        return clearTimeout(marker);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedClearTimeout(marker);\n    } catch (e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\n            return cachedClearTimeout.call(null, marker);\n        } catch (e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\n            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\n            return cachedClearTimeout.call(this, marker);\n        }\n    }\n\n\n\n}\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    if (!draining || !currentQueue) {\n        return;\n    }\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = runTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    runClearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        runTimeout(drainQueue);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\nprocess.prependListener = noop;\nprocess.prependOnceListener = noop;\n\nprocess.listeners = function (name) { return [] }\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n\n},{}],9:[function(require,module,exports){\nif (typeof Object.create === 'function') {\n  // implementation from standard node.js 'util' module\n  module.exports = function inherits(ctor, superCtor) {\n    ctor.super_ = superCtor\n    ctor.prototype = Object.create(superCtor.prototype, {\n      constructor: {\n        value: ctor,\n        enumerable: false,\n        writable: true,\n        configurable: true\n      }\n    });\n  };\n} else {\n  // old school shim for old browsers\n  module.exports = function inherits(ctor, superCtor) {\n    ctor.super_ = superCtor\n    var TempCtor = function () {}\n    TempCtor.prototype = superCtor.prototype\n    ctor.prototype = new TempCtor()\n    ctor.prototype.constructor = ctor\n  }\n}\n\n},{}],10:[function(require,module,exports){\nmodule.exports = function isBuffer(arg) {\n  return arg && typeof arg === 'object'\n    && typeof arg.copy === 'function'\n    && typeof arg.fill === 'function'\n    && typeof arg.readUInt8 === 'function';\n}\n},{}],11:[function(require,module,exports){\n(function (process,global){\n// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nvar formatRegExp = /%[sdj%]/g;\nexports.format = function(f) {\n  if (!isString(f)) {\n    var objects = [];\n    for (var i = 0; i < arguments.length; i++) {\n      objects.push(inspect(arguments[i]));\n    }\n    return objects.join(' ');\n  }\n\n  var i = 1;\n  var args = arguments;\n  var len = args.length;\n  var str = String(f).replace(formatRegExp, function(x) {\n    if (x === '%%') return '%';\n    if (i >= len) return x;\n    switch (x) {\n      case '%s': return String(args[i++]);\n      case '%d': return Number(args[i++]);\n      case '%j':\n        try {\n          return JSON.stringify(args[i++]);\n        } catch (_) {\n          return '[Circular]';\n        }\n      default:\n        return x;\n    }\n  });\n  for (var x = args[i]; i < len; x = args[++i]) {\n    if (isNull(x) || !isObject(x)) {\n      str += ' ' + x;\n    } else {\n      str += ' ' + inspect(x);\n    }\n  }\n  return str;\n};\n\n\n// Mark that a method should not be used.\n// Returns a modified function which warns once by default.\n// If --no-deprecation is set, then it is a no-op.\nexports.deprecate = function(fn, msg) {\n  // Allow for deprecating things in the process of starting up.\n  if (isUndefined(global.process)) {\n    return function() {\n      return exports.deprecate(fn, msg).apply(this, arguments);\n    };\n  }\n\n  if (process.noDeprecation === true) {\n    return fn;\n  }\n\n  var warned = false;\n  function deprecated() {\n    if (!warned) {\n      if (process.throwDeprecation) {\n        throw new Error(msg);\n      } else if (process.traceDeprecation) {\n        console.trace(msg);\n      } else {\n        console.error(msg);\n      }\n      warned = true;\n    }\n    return fn.apply(this, arguments);\n  }\n\n  return deprecated;\n};\n\n\nvar debugs = {};\nvar debugEnviron;\nexports.debuglog = function(set) {\n  if (isUndefined(debugEnviron))\n    debugEnviron = process.env.NODE_DEBUG || '';\n  set = set.toUpperCase();\n  if (!debugs[set]) {\n    if (new RegExp('\\\\b' + set + '\\\\b', 'i').test(debugEnviron)) {\n      var pid = process.pid;\n      debugs[set] = function() {\n        var msg = exports.format.apply(exports, arguments);\n        console.error('%s %d: %s', set, pid, msg);\n      };\n    } else {\n      debugs[set] = function() {};\n    }\n  }\n  return debugs[set];\n};\n\n\n/**\n * Echos the value of a value. Trys to print the value out\n * in the best way possible given the different types.\n *\n * @param {Object} obj The object to print out.\n * @param {Object} opts Optional options object that alters the output.\n */\n/* legacy: obj, showHidden, depth, colors*/\nfunction inspect(obj, opts) {\n  // default options\n  var ctx = {\n    seen: [],\n    stylize: stylizeNoColor\n  };\n  // legacy...\n  if (arguments.length >= 3) ctx.depth = arguments[2];\n  if (arguments.length >= 4) ctx.colors = arguments[3];\n  if (isBoolean(opts)) {\n    // legacy...\n    ctx.showHidden = opts;\n  } else if (opts) {\n    // got an \"options\" object\n    exports._extend(ctx, opts);\n  }\n  // set default options\n  if (isUndefined(ctx.showHidden)) ctx.showHidden = false;\n  if (isUndefined(ctx.depth)) ctx.depth = 2;\n  if (isUndefined(ctx.colors)) ctx.colors = false;\n  if (isUndefined(ctx.customInspect)) ctx.customInspect = true;\n  if (ctx.colors) ctx.stylize = stylizeWithColor;\n  return formatValue(ctx, obj, ctx.depth);\n}\nexports.inspect = inspect;\n\n\n// http://en.wikipedia.org/wiki/ANSI_escape_code#graphics\ninspect.colors = {\n  'bold' : [1, 22],\n  'italic' : [3, 23],\n  'underline' : [4, 24],\n  'inverse' : [7, 27],\n  'white' : [37, 39],\n  'grey' : [90, 39],\n  'black' : [30, 39],\n  'blue' : [34, 39],\n  'cyan' : [36, 39],\n  'green' : [32, 39],\n  'magenta' : [35, 39],\n  'red' : [31, 39],\n  'yellow' : [33, 39]\n};\n\n// Don't use 'blue' not visible on cmd.exe\ninspect.styles = {\n  'special': 'cyan',\n  'number': 'yellow',\n  'boolean': 'yellow',\n  'undefined': 'grey',\n  'null': 'bold',\n  'string': 'green',\n  'date': 'magenta',\n  // \"name\": intentionally not styling\n  'regexp': 'red'\n};\n\n\nfunction stylizeWithColor(str, styleType) {\n  var style = inspect.styles[styleType];\n\n  if (style) {\n    return '\\u001b[' + inspect.colors[style][0] + 'm' + str +\n           '\\u001b[' + inspect.colors[style][1] + 'm';\n  } else {\n    return str;\n  }\n}\n\n\nfunction stylizeNoColor(str, styleType) {\n  return str;\n}\n\n\nfunction arrayToHash(array) {\n  var hash = {};\n\n  array.forEach(function(val, idx) {\n    hash[val] = true;\n  });\n\n  return hash;\n}\n\n\nfunction formatValue(ctx, value, recurseTimes) {\n  // Provide a hook for user-specified inspect functions.\n  // Check that value is an object with an inspect function on it\n  if (ctx.customInspect &&\n      value &&\n      isFunction(value.inspect) &&\n      // Filter out the util module, it's inspect function is special\n      value.inspect !== exports.inspect &&\n      // Also filter out any prototype objects using the circular check.\n      !(value.constructor && value.constructor.prototype === value)) {\n    var ret = value.inspect(recurseTimes, ctx);\n    if (!isString(ret)) {\n      ret = formatValue(ctx, ret, recurseTimes);\n    }\n    return ret;\n  }\n\n  // Primitive types cannot have properties\n  var primitive = formatPrimitive(ctx, value);\n  if (primitive) {\n    return primitive;\n  }\n\n  // Look up the keys of the object.\n  var keys = Object.keys(value);\n  var visibleKeys = arrayToHash(keys);\n\n  if (ctx.showHidden) {\n    keys = Object.getOwnPropertyNames(value);\n  }\n\n  // IE doesn't make error fields non-enumerable\n  // http://msdn.microsoft.com/en-us/library/ie/dww52sbt(v=vs.94).aspx\n  if (isError(value)\n      && (keys.indexOf('message') >= 0 || keys.indexOf('description') >= 0)) {\n    return formatError(value);\n  }\n\n  // Some type of object without properties can be shortcutted.\n  if (keys.length === 0) {\n    if (isFunction(value)) {\n      var name = value.name ? ': ' + value.name : '';\n      return ctx.stylize('[Function' + name + ']', 'special');\n    }\n    if (isRegExp(value)) {\n      return ctx.stylize(RegExp.prototype.toString.call(value), 'regexp');\n    }\n    if (isDate(value)) {\n      return ctx.stylize(Date.prototype.toString.call(value), 'date');\n    }\n    if (isError(value)) {\n      return formatError(value);\n    }\n  }\n\n  var base = '', array = false, braces = ['{', '}'];\n\n  // Make Array say that they are Array\n  if (isArray(value)) {\n    array = true;\n    braces = ['[', ']'];\n  }\n\n  // Make functions say that they are functions\n  if (isFunction(value)) {\n    var n = value.name ? ': ' + value.name : '';\n    base = ' [Function' + n + ']';\n  }\n\n  // Make RegExps say that they are RegExps\n  if (isRegExp(value)) {\n    base = ' ' + RegExp.prototype.toString.call(value);\n  }\n\n  // Make dates with properties first say the date\n  if (isDate(value)) {\n    base = ' ' + Date.prototype.toUTCString.call(value);\n  }\n\n  // Make error with message first say the error\n  if (isError(value)) {\n    base = ' ' + formatError(value);\n  }\n\n  if (keys.length === 0 && (!array || value.length == 0)) {\n    return braces[0] + base + braces[1];\n  }\n\n  if (recurseTimes < 0) {\n    if (isRegExp(value)) {\n      return ctx.stylize(RegExp.prototype.toString.call(value), 'regexp');\n    } else {\n      return ctx.stylize('[Object]', 'special');\n    }\n  }\n\n  ctx.seen.push(value);\n\n  var output;\n  if (array) {\n    output = formatArray(ctx, value, recurseTimes, visibleKeys, keys);\n  } else {\n    output = keys.map(function(key) {\n      return formatProperty(ctx, value, recurseTimes, visibleKeys, key, array);\n    });\n  }\n\n  ctx.seen.pop();\n\n  return reduceToSingleString(output, base, braces);\n}\n\n\nfunction formatPrimitive(ctx, value) {\n  if (isUndefined(value))\n    return ctx.stylize('undefined', 'undefined');\n  if (isString(value)) {\n    var simple = '\\'' + JSON.stringify(value).replace(/^\"|\"$/g, '')\n                                             .replace(/'/g, \"\\\\'\")\n                                             .replace(/\\\\\"/g, '\"') + '\\'';\n    return ctx.stylize(simple, 'string');\n  }\n  if (isNumber(value))\n    return ctx.stylize('' + value, 'number');\n  if (isBoolean(value))\n    return ctx.stylize('' + value, 'boolean');\n  // For some reason typeof null is \"object\", so special case here.\n  if (isNull(value))\n    return ctx.stylize('null', 'null');\n}\n\n\nfunction formatError(value) {\n  return '[' + Error.prototype.toString.call(value) + ']';\n}\n\n\nfunction formatArray(ctx, value, recurseTimes, visibleKeys, keys) {\n  var output = [];\n  for (var i = 0, l = value.length; i < l; ++i) {\n    if (hasOwnProperty(value, String(i))) {\n      output.push(formatProperty(ctx, value, recurseTimes, visibleKeys,\n          String(i), true));\n    } else {\n      output.push('');\n    }\n  }\n  keys.forEach(function(key) {\n    if (!key.match(/^\\d+$/)) {\n      output.push(formatProperty(ctx, value, recurseTimes, visibleKeys,\n          key, true));\n    }\n  });\n  return output;\n}\n\n\nfunction formatProperty(ctx, value, recurseTimes, visibleKeys, key, array) {\n  var name, str, desc;\n  desc = Object.getOwnPropertyDescriptor(value, key) || { value: value[key] };\n  if (desc.get) {\n    if (desc.set) {\n      str = ctx.stylize('[Getter/Setter]', 'special');\n    } else {\n      str = ctx.stylize('[Getter]', 'special');\n    }\n  } else {\n    if (desc.set) {\n      str = ctx.stylize('[Setter]', 'special');\n    }\n  }\n  if (!hasOwnProperty(visibleKeys, key)) {\n    name = '[' + key + ']';\n  }\n  if (!str) {\n    if (ctx.seen.indexOf(desc.value) < 0) {\n      if (isNull(recurseTimes)) {\n        str = formatValue(ctx, desc.value, null);\n      } else {\n        str = formatValue(ctx, desc.value, recurseTimes - 1);\n      }\n      if (str.indexOf('\\n') > -1) {\n        if (array) {\n          str = str.split('\\n').map(function(line) {\n            return '  ' + line;\n          }).join('\\n').substr(2);\n        } else {\n          str = '\\n' + str.split('\\n').map(function(line) {\n            return '   ' + line;\n          }).join('\\n');\n        }\n      }\n    } else {\n      str = ctx.stylize('[Circular]', 'special');\n    }\n  }\n  if (isUndefined(name)) {\n    if (array && key.match(/^\\d+$/)) {\n      return str;\n    }\n    name = JSON.stringify('' + key);\n    if (name.match(/^\"([a-zA-Z_][a-zA-Z_0-9]*)\"$/)) {\n      name = name.substr(1, name.length - 2);\n      name = ctx.stylize(name, 'name');\n    } else {\n      name = name.replace(/'/g, \"\\\\'\")\n                 .replace(/\\\\\"/g, '\"')\n                 .replace(/(^\"|\"$)/g, \"'\");\n      name = ctx.stylize(name, 'string');\n    }\n  }\n\n  return name + ': ' + str;\n}\n\n\nfunction reduceToSingleString(output, base, braces) {\n  var numLinesEst = 0;\n  var length = output.reduce(function(prev, cur) {\n    numLinesEst++;\n    if (cur.indexOf('\\n') >= 0) numLinesEst++;\n    return prev + cur.replace(/\\u001b\\[\\d\\d?m/g, '').length + 1;\n  }, 0);\n\n  if (length > 60) {\n    return braces[0] +\n           (base === '' ? '' : base + '\\n ') +\n           ' ' +\n           output.join(',\\n  ') +\n           ' ' +\n           braces[1];\n  }\n\n  return braces[0] + base + ' ' + output.join(', ') + ' ' + braces[1];\n}\n\n\n// NOTE: These type checking functions intentionally don't use `instanceof`\n// because it is fragile and can be easily faked with `Object.create()`.\nfunction isArray(ar) {\n  return Array.isArray(ar);\n}\nexports.isArray = isArray;\n\nfunction isBoolean(arg) {\n  return typeof arg === 'boolean';\n}\nexports.isBoolean = isBoolean;\n\nfunction isNull(arg) {\n  return arg === null;\n}\nexports.isNull = isNull;\n\nfunction isNullOrUndefined(arg) {\n  return arg == null;\n}\nexports.isNullOrUndefined = isNullOrUndefined;\n\nfunction isNumber(arg) {\n  return typeof arg === 'number';\n}\nexports.isNumber = isNumber;\n\nfunction isString(arg) {\n  return typeof arg === 'string';\n}\nexports.isString = isString;\n\nfunction isSymbol(arg) {\n  return typeof arg === 'symbol';\n}\nexports.isSymbol = isSymbol;\n\nfunction isUndefined(arg) {\n  return arg === void 0;\n}\nexports.isUndefined = isUndefined;\n\nfunction isRegExp(re) {\n  return isObject(re) && objectToString(re) === '[object RegExp]';\n}\nexports.isRegExp = isRegExp;\n\nfunction isObject(arg) {\n  return typeof arg === 'object' && arg !== null;\n}\nexports.isObject = isObject;\n\nfunction isDate(d) {\n  return isObject(d) && objectToString(d) === '[object Date]';\n}\nexports.isDate = isDate;\n\nfunction isError(e) {\n  return isObject(e) &&\n      (objectToString(e) === '[object Error]' || e instanceof Error);\n}\nexports.isError = isError;\n\nfunction isFunction(arg) {\n  return typeof arg === 'function';\n}\nexports.isFunction = isFunction;\n\nfunction isPrimitive(arg) {\n  return arg === null ||\n         typeof arg === 'boolean' ||\n         typeof arg === 'number' ||\n         typeof arg === 'string' ||\n         typeof arg === 'symbol' ||  // ES6 symbol\n         typeof arg === 'undefined';\n}\nexports.isPrimitive = isPrimitive;\n\nexports.isBuffer = require('./support/isBuffer');\n\nfunction objectToString(o) {\n  return Object.prototype.toString.call(o);\n}\n\n\nfunction pad(n) {\n  return n < 10 ? '0' + n.toString(10) : n.toString(10);\n}\n\n\nvar months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep',\n              'Oct', 'Nov', 'Dec'];\n\n// 26 Feb 16:19:34\nfunction timestamp() {\n  var d = new Date();\n  var time = [pad(d.getHours()),\n              pad(d.getMinutes()),\n              pad(d.getSeconds())].join(':');\n  return [d.getDate(), months[d.getMonth()], time].join(' ');\n}\n\n\n// log is just a thin wrapper to console.log that prepends a timestamp\nexports.log = function() {\n  console.log('%s - %s', timestamp(), exports.format.apply(exports, arguments));\n};\n\n\n/**\n * Inherit the prototype methods from one constructor into another.\n *\n * The Function.prototype.inherits from lang.js rewritten as a standalone\n * function (not on Function.prototype). NOTE: If this file is to be loaded\n * during bootstrapping this function needs to be rewritten using some native\n * functions as prototype setup using normal JavaScript does not work as\n * expected during bootstrapping (see mirror.js in r114903).\n *\n * @param {function} ctor Constructor function which needs to inherit the\n *     prototype.\n * @param {function} superCtor Constructor function to inherit prototype from.\n */\nexports.inherits = require('inherits');\n\nexports._extend = function(origin, add) {\n  // Don't do anything if add isn't an object\n  if (!add || !isObject(add)) return origin;\n\n  var keys = Object.keys(add);\n  var i = keys.length;\n  while (i--) {\n    origin[keys[i]] = add[keys[i]];\n  }\n  return origin;\n};\n\nfunction hasOwnProperty(obj, prop) {\n  return Object.prototype.hasOwnProperty.call(obj, prop);\n}\n\n}).call(this,require('_process'),typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n},{\"./support/isBuffer\":10,\"_process\":8,\"inherits\":9}]},{},[7])(7)\n});"]}