{"version":3,"sources":["scion.js"],"names":["f","exports","module","define","amd","g","window","global","self","scion","e","t","n","r","s","o","u","a","require","i","Error","code","l","call","length","ArraySet","Set","prototype","add","x","remove","delete","union","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_iterator","Symbol","iterator","_step","next","done","v","value","err","return","difference","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_iterator2","_step2","contains","has","iter","Array","from","isEmpty","size","equals","s2","_iteratorNormalCompletion3","_didIteratorError3","_iteratorError3","_iterator3","_step3","toString","join","STATE_TYPES","BASIC","COMPOSITE","PARALLEL","HISTORY","INITIAL","FINAL","SCXML_IOPROCESSOR_TYPE","HTTP_IOPROCESSOR_TYPE","RX_TRAILING_WILDCARD","_typeof","obj","constructor","constants","printTrace","extend","transitionWithTargets","transitionComparator","initializeModel","isEventPrefixMatch","isTransitionMatch","scxmlPrefixTransitionSelector","eventlessTransitionSelector","getTransitionWithHigherSourceChildPriority","sortInEntryOrder","getStateWithHigherSourceChildPriority","initializeModelGeneratorFn","deserializeSerializedConfiguration","deserializeHistory","to","Object","keys","forEach","k","targets","t1","t2","documentOrder","rootState","opts","transitions","idToStateMap","Map","idCount","generateId","type","count","id","wrapInFakeRootState","state","$deserializeDatamodel","$serializeDatamodel","$idToStateMap","docUrl","name","states","$type","target","statesWithInitialAttributes","transitionToString","sourceState","events","cond","stateToString","populateStateIdMap","set","j","len","traverse","ancestors","push","apply","depth","parent","transition","source","bind","ancs","concat","typeEnum","isAtomic","descendants","map","reduce","b","initialChildren","isArray","initial","filter","child","initialRef","checkInitialRef","historyChildren","historyRef","prop","every","handler","invokes","invoke","finalize","connectIntialAttributes","initialStates","initialState","get","RX_WHITESPACE","connectTransitionGraph","onTransition","event","trim","split","lcca","getLCCA","scope","getScope","transitionIsReallyInternal","indexOf","s1","commonAncestors","anc","legacySemantics","fakeRootState","prefix","fullName","replace","charAt","eventName","some","tEvent","evaluator","selectEventlessTransitions","_args","modelFn","interpreter","_x","_sessionid","_ioprocessors","isIn","serializedConfiguration","serializedHistory","sid","query","isDescendant","getAncestors","root","index","slice","isOrthogonalTo","isAncestrallyRelatedTo","getLCA","getAncestorsOrSelf","getDescendantsOrSelf","process","_slicedToArray","sliceIterator","arr","_arr","_n","_d","_e","_i","_s","TypeError","_createClass","defineProperties","props","descriptor","enumerable","configurable","writable","defineProperty","key","Constructor","protoProps","staticProps","_toConsumableArray","arr2","_classCallCheck","instance","_possibleConstructorReturn","ReferenceError","_inherits","subClass","superClass","create","setPrototypeOf","__proto__","EventEmitter","util","helpers","env","DEBUG","BaseInterpreter","_EventEmitter","modelOrModelFactory","_this","getPrototypeOf","InterpreterScriptingContext","_isStepping","_scriptingContext","interpreterScriptingContext","generateSessionid","sessionid","sessionRegistry","invokerExecutionContext","_executionContext","location","scxml","model","JSON","parse","stringify","_model","console","log","priorityComparisonFn","transitionSelector","String","arguments","_externalEventQueue","_internalEventQueue","params","snapshot","_configuration","_historyValue","_isInFinalState","EVENTS","on","_log","emit","cancel","parentSession","invokeid","_exitInterpreter","_this2","_cancelAllDelayedSends","statesToExit","_getFullConfiguration","sort","stateExited","onExit","exitIdx","exitLen","block","blockIdx","blockLen","actionRef","_handleError","cancelInvoke","send","data","donedata","start","_initStart","_performBigStep","getConfiguration","startAsync","cb","genAsync","_this3","nop","getFullConfiguration","stateName","isFinal","currentEvent","keepGoing","allStatesExited","allStatesEntered","_startBigStep2","_startBigStep","_startBigStep3","_selectTransitionsAnd","_selectTransitionsAndPerformSmallStep","_selectTransitionsAnd2","_finishBigStep","selectedTransitions","_selectTransitions","ev","shift","statesExited","statesEntered","_performSmallStep2","_performSmallStep","_performSmallStep3","_this4","autoforward","action","_evaluateAction","_this5","statesToInvoke","_timeouts","timeoutOptions","sendOptions","delay","clearTimeout","timeoutHandle","_timeoutMap","_performBigStepAsync","_startBigStep4","_startBigStep5","nextStep","_selectTransitionsAnd3","_selectTransitionsAnd4","setImmediate","selectedTransitionsWithTargets","_exitStates","_executeTransitions","_enterStates","basicStatesExited","_getStatesExited2","_getStatesExited","_getStatesExited3","isDeep","s0","transitionList","txIdx","txLen","desc","configList","cfgIdx","cfgLen","ancIdx","ancLen","sortedStatesExited","sortedTransitions","stxIdx","targetIds","_this6","statesForDefaultEntry","defaultHistoryContent","_computeEntrySet","enterIdx","enterLen","stateEntered","onEntry","entryIdx","entryLen","_actionRef","_transition","_actionRef2","grandparent","isInFinalState","_getEffectiveTargetStates","_iteratorNormalCompletion4","_didIteratorError4","_iteratorError4","_iterator4","_step4","statesToEnter","_iteratorNormalCompletion5","_didIteratorError5","_iteratorError5","_iterator5","_step5","_iteratorNormalCompletion6","_didIteratorError6","_iteratorError6","_iterator6","_step6","_addDescendantStatesToEnter","ancestor","_iteratorNormalCompletion7","_didIteratorError7","_iteratorError7","_iterator7","_step7","_addAncestorStatesToEnter","_computeExitSet","_iteratorNormalCompletion8","_didIteratorError8","_iteratorError8","_iterator8","_step8","_iteratorNormalCompletion9","_didIteratorError9","_iteratorError9","_iterator9","_step9","_this7","_iteratorNormalCompletion10","_didIteratorError10","_iteratorError10","_loop","_step10","_iterator10","_iteratorNormalCompletion11","_didIteratorError11","_iteratorError11","_iterator11","_step11","_this8","_iteratorNormalCompletion12","_didIteratorError12","_iteratorError12","_iterator12","_step12","_iteratorNormalCompletion13","_didIteratorError13","_iteratorError13","_iterator13","_step13","_s2","_iteratorNormalCompletion14","_didIteratorError14","_iteratorError14","_iterator14","_step14","_s3","_iteratorNormalCompletion15","_didIteratorError15","_iteratorError15","_iterator15","_step15","_s4","_iteratorNormalCompletion16","_didIteratorError16","_iteratorError16","_iterator16","_step16","_s5","_iteratorNormalCompletion18","_didIteratorError18","_iteratorError18","_iterator18","_step18","targetState","_iteratorNormalCompletion17","_didIteratorError17","_iteratorError17","_iterator17","_step17","_s6","_targets","_iteratorNormalCompletion19","_didIteratorError19","_iteratorError19","_iterator19","_step19","_targetState","_iteratorNormalCompletion20","_didIteratorError20","_iteratorError20","_loop2","_step20","_iterator20","_this9","match","tagname","line","column","reason","message","args","arg","inspect","registerListener","listener","unregisterListener","off","getAllTransitionEvents","getEvents","stateIdx","stateLen","getSnapshot","_serializeHistory","gen","evtObjOrName","optionalData","c","config","sessionIdCounter","_interpreter","_invokeMap","validateUriRegex","invokeSendTargetRegex","scxmlSendTargetRegex","raise","_installDefaultPropsOnEvent","parseXmlStringAsDOM","xmlString","xmlParser","invokeObj","_this10","Promise","resolve","reject","invokers","session","_this11","sessionPromise","then","isInternal","origin","origintype","options","sendType","validateSend","sendAction","targetIsValidUri","test","sendid","defaultSendAction","_this12","setTimeout","doSend","targetSessionId","invokeId","sendAsync","publish","sendFn","customSend","customCancel","_listeners","_on","once","_once","__once","_off","splice","_emit","__emit","base","Statechart","_base$BaseInterpreter","onlySelectFromBasicStates","statesAndParents","idx","basicState","enabledTransitions","priorityEnabledTransitions","_selectPriorityEnabledTransitions","tuple","_getInconsistentTransitions","consistentTransitions","inconsistentTransitionsPairs","allInconsistentTransitions","_conflicts","_isArenaOrthogonal","isOrthogonal","cachedSetTimeout","cachedClearTimeout","defaultSetTimout","defaultClearTimeout","runTimeout","fun","runClearTimeout","marker","queue","draining","currentQueue","queueIndex","cleanUpNextTick","drainQueue","timeout","run","nextTick","Item","array","title","browser","argv","version","versions","noop","addListener","removeListener","removeAllListeners","prependListener","prependOnceListener","listeners","binding","cwd","chdir","dir","umask","inherits","ctor","superCtor","super_","TempCtor","isBuffer","copy","fill","readUInt8","formatRegExp","format","isString","objects","str","Number","_","isNull","isObject","deprecate","fn","msg","isUndefined","noDeprecation","warned","deprecated","throwDeprecation","traceDeprecation","trace","error","debugs","debugEnviron","debuglog","NODE_DEBUG","toUpperCase","RegExp","pid","ctx","seen","stylize","stylizeNoColor","colors","isBoolean","showHidden","_extend","customInspect","stylizeWithColor","formatValue","styles","styleType","style","arrayToHash","hash","val","recurseTimes","isFunction","ret","primitive","formatPrimitive","visibleKeys","getOwnPropertyNames","isError","formatError","isRegExp","isDate","Date","braces","toUTCString","output","formatArray","formatProperty","pop","reduceToSingleString","simple","isNumber","hasOwnProperty","getOwnPropertyDescriptor","substr","numLinesEst","prev","cur","ar","isNullOrUndefined","isSymbol","re","objectToString","d","isPrimitive","pad","months","timestamp","time","getHours","getMinutes","getSeconds","getDate","getMonth"],"mappings":"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","file":"scion.js","sourcesContent":["(function(f){if(typeof exports===\"object\"&&typeof module!==\"undefined\"){module.exports=f()}else if(typeof define===\"function\"&&define.amd){define([],f)}else{var g;if(typeof window!==\"undefined\"){g=window}else if(typeof global!==\"undefined\"){g=global}else if(typeof self!==\"undefined\"){g=self}else{g=this}g.scion = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\n'use strict';\n\n/* begin ArraySet */\n\n/** @constructor */\nfunction ArraySet(l) {\n    l = l || [];\n    this.o = new Set(l);\n}\n\nArraySet.prototype = {\n\n    add: function add(x) {\n        this.o.add(x);\n    },\n\n    remove: function remove(x) {\n        return this.o.delete(x);\n    },\n\n    union: function union(l) {\n        var _iteratorNormalCompletion = true;\n        var _didIteratorError = false;\n        var _iteratorError = undefined;\n\n        try {\n            for (var _iterator = l.o[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n                var v = _step.value;\n\n                this.o.add(v);\n            }\n        } catch (err) {\n            _didIteratorError = true;\n            _iteratorError = err;\n        } finally {\n            try {\n                if (!_iteratorNormalCompletion && _iterator.return) {\n                    _iterator.return();\n                }\n            } finally {\n                if (_didIteratorError) {\n                    throw _iteratorError;\n                }\n            }\n        }\n\n        return this;\n    },\n\n    difference: function difference(l) {\n        var _iteratorNormalCompletion2 = true;\n        var _didIteratorError2 = false;\n        var _iteratorError2 = undefined;\n\n        try {\n            for (var _iterator2 = l.o[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {\n                var v = _step2.value;\n\n                this.o.delete(v);\n            }\n        } catch (err) {\n            _didIteratorError2 = true;\n            _iteratorError2 = err;\n        } finally {\n            try {\n                if (!_iteratorNormalCompletion2 && _iterator2.return) {\n                    _iterator2.return();\n                }\n            } finally {\n                if (_didIteratorError2) {\n                    throw _iteratorError2;\n                }\n            }\n        }\n\n        return this;\n    },\n\n    contains: function contains(x) {\n        return this.o.has(x);\n    },\n\n    iter: function iter() {\n        return Array.from(this.o);\n    },\n\n    isEmpty: function isEmpty() {\n        return !this.o.size;\n    },\n\n    size: function size() {\n        return this.o.size;\n    },\n\n    equals: function equals(s2) {\n        if (this.o.size !== s2.size()) {\n            return false;\n        }\n\n        var _iteratorNormalCompletion3 = true;\n        var _didIteratorError3 = false;\n        var _iteratorError3 = undefined;\n\n        try {\n            for (var _iterator3 = this.o[Symbol.iterator](), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {\n                var v = _step3.value;\n\n                if (!s2.contains(v)) {\n                    return false;\n                }\n            }\n        } catch (err) {\n            _didIteratorError3 = true;\n            _iteratorError3 = err;\n        } finally {\n            try {\n                if (!_iteratorNormalCompletion3 && _iterator3.return) {\n                    _iterator3.return();\n                }\n            } finally {\n                if (_didIteratorError3) {\n                    throw _iteratorError3;\n                }\n            }\n        }\n\n        return true;\n    },\n\n    toString: function toString() {\n        return this.o.size === 0 ? '<empty>' : Array.from(this.o).join(',\\n');\n    }\n};\n\nmodule.exports = ArraySet;\n\n},{}],2:[function(require,module,exports){\n'use strict';\n\nvar STATE_TYPES = {\n    BASIC: 0,\n    COMPOSITE: 1,\n    PARALLEL: 2,\n    HISTORY: 3,\n    INITIAL: 4,\n    FINAL: 5\n};\n\nvar SCXML_IOPROCESSOR_TYPE = 'http://www.w3.org/TR/scxml/#SCXMLEventProcessor';\nvar HTTP_IOPROCESSOR_TYPE = 'http://www.w3.org/TR/scxml/#BasicHTTPEventProcessor';\nvar RX_TRAILING_WILDCARD = /\\.\\*$/;\n\nmodule.exports = {\n    STATE_TYPES: STATE_TYPES,\n    SCXML_IOPROCESSOR_TYPE: SCXML_IOPROCESSOR_TYPE,\n    HTTP_IOPROCESSOR_TYPE: HTTP_IOPROCESSOR_TYPE,\n    RX_TRAILING_WILDCARD: RX_TRAILING_WILDCARD\n};\n\n},{}],3:[function(require,module,exports){\n'use strict';\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\nvar constants = require('./constants'),\n    STATE_TYPES = constants.STATE_TYPES,\n    RX_TRAILING_WILDCARD = constants.RX_TRAILING_WILDCARD;\n\nvar printTrace = false;\n\nmodule.exports = {\n    extend: extend,\n    transitionWithTargets: transitionWithTargets,\n    transitionComparator: transitionComparator,\n    initializeModel: initializeModel,\n    isEventPrefixMatch: isEventPrefixMatch,\n    isTransitionMatch: isTransitionMatch,\n    scxmlPrefixTransitionSelector: scxmlPrefixTransitionSelector,\n    eventlessTransitionSelector: eventlessTransitionSelector,\n    getTransitionWithHigherSourceChildPriority: getTransitionWithHigherSourceChildPriority,\n    sortInEntryOrder: sortInEntryOrder,\n    getStateWithHigherSourceChildPriority: getStateWithHigherSourceChildPriority,\n    initializeModelGeneratorFn: initializeModelGeneratorFn,\n    deserializeSerializedConfiguration: deserializeSerializedConfiguration,\n    deserializeHistory: deserializeHistory\n};\n\nfunction extend(to, from) {\n    Object.keys(from).forEach(function (k) {\n        to[k] = from[k];\n    });\n    return to;\n};\n\nfunction transitionWithTargets(t) {\n    return t.targets;\n}\n\nfunction transitionComparator(t1, t2) {\n    return t1.documentOrder - t2.documentOrder;\n}\n\nfunction initializeModel(rootState, opts) {\n    var transitions = [],\n        idToStateMap = new Map(),\n        documentOrder = 0;\n\n    //TODO: need to add fake ids to anyone that doesn't have them\n    //FIXME: make this safer - break into multiple passes\n    var idCount = {};\n\n    function generateId(type) {\n        if (idCount[type] === undefined) idCount[type] = 0;\n\n        do {\n            var count = idCount[type]++;\n            var id = '$generated-' + type + '-' + count;\n        } while (idToStateMap.has(id));\n\n        return id;\n    }\n\n    function wrapInFakeRootState(state) {\n        return {\n            $deserializeDatamodel: state.$deserializeDatamodel || function () {},\n            $serializeDatamodel: state.$serializeDatamodel || function () {\n                return null;\n            },\n            $idToStateMap: idToStateMap, //keep this for handy deserialization of serialized configuration\n            docUrl: state.docUrl,\n            name: state.name,\n            states: [{\n                $type: 'initial',\n                transitions: [{\n                    target: state\n                }]\n            }, state]\n        };\n    }\n\n    var statesWithInitialAttributes = [];\n\n    /**\n      @this {SCTransition}\n    */\n    function transitionToString(sourceState) {\n        return sourceState + ' -- ' + (this.events ? '(' + this.events.join(',') + ')' : null) + (this.cond ? '[' + this.cond.name + ']' : '') + ' --> ' + (this.targets ? this.targets.join(',') : null);\n    }\n\n    /**\n      @this {SCState}\n    */\n    function stateToString() {\n        return this.id;\n    }\n\n    function populateStateIdMap(state) {\n        //populate state id map\n        if (state.id) {\n            idToStateMap.set(state.id, state);\n        }\n\n        if (state.states) {\n            for (var j = 0, len = state.states.length; j < len; j++) {\n                populateStateIdMap(state.states[j]);\n            }\n        }\n    }\n\n    function traverse(ancestors, state) {\n\n        if (printTrace) state.toString = stateToString;\n\n        //add to global transition and state id caches\n        if (state.transitions) transitions.push.apply(transitions, state.transitions);\n\n        //create a default type, just to normalize things\n        //this way we can check for unsupported types below\n        state.$type = state.$type || 'state';\n\n        //add ancestors and depth properties\n        state.ancestors = ancestors;\n        state.depth = ancestors.length;\n        state.parent = ancestors[0];\n        state.documentOrder = documentOrder++;\n\n        //add some information to transitions\n        state.transitions = state.transitions || [];\n        for (var j = 0, len = state.transitions.length; j < len; j++) {\n            var transition = state.transitions[j];\n            transition.documentOrder = documentOrder++;\n            transition.source = state;\n            if (printTrace) transition.toString = transitionToString.bind(transition, state);\n        };\n\n        //recursive step\n        if (state.states) {\n            var ancs = [state].concat(ancestors);\n            for (var j = 0, len = state.states.length; j < len; j++) {\n                traverse(ancs, state.states[j]);\n            }\n        }\n\n        //setup fast state type\n        switch (state.$type) {\n            case 'parallel':\n                state.typeEnum = STATE_TYPES.PARALLEL;\n                state.isAtomic = false;\n                break;\n            case 'initial':\n                state.typeEnum = STATE_TYPES.INITIAL;\n                state.isAtomic = true;\n                break;\n            case 'history':\n                state.typeEnum = STATE_TYPES.HISTORY;\n                state.isAtomic = true;\n                break;\n            case 'final':\n                state.typeEnum = STATE_TYPES.FINAL;\n                state.isAtomic = true;\n                break;\n            case 'state':\n            case 'scxml':\n                if (state.states && state.states.length) {\n                    state.typeEnum = STATE_TYPES.COMPOSITE;\n                    state.isAtomic = false;\n                } else {\n                    state.typeEnum = STATE_TYPES.BASIC;\n                    state.isAtomic = true;\n                }\n                break;\n            default:\n                throw new Error('Unknown state type: ' + state.$type);\n        }\n\n        //descendants property on states will now be populated. add descendants to this state\n        if (state.states) {\n            state.descendants = state.states.concat(state.states.map(function (s) {\n                return s.descendants;\n            }).reduce(function (a, b) {\n                return a.concat(b);\n            }, []));\n        } else {\n            state.descendants = [];\n        }\n\n        var initialChildren;\n        if (state.typeEnum === STATE_TYPES.COMPOSITE) {\n            //set up initial state\n\n            if (Array.isArray(state.initial) || typeof state.initial === 'string') {\n                statesWithInitialAttributes.push(state);\n            } else {\n                //take the first child that has initial type, or first child\n                initialChildren = state.states.filter(function (child) {\n                    return child.$type === 'initial';\n                });\n\n                state.initialRef = [initialChildren.length ? initialChildren[0] : state.states[0]];\n                checkInitialRef(state);\n            }\n        }\n\n        //hook up history\n        if (state.typeEnum === STATE_TYPES.COMPOSITE || state.typeEnum === STATE_TYPES.PARALLEL) {\n\n            var historyChildren = state.states.filter(function (s) {\n                return s.$type === 'history';\n            });\n\n            state.historyRef = historyChildren;\n        }\n\n        //now it's safe to fill in fake state ids\n        if (!state.id) {\n            state.id = generateId(state.$type);\n            idToStateMap.set(state.id, state);\n        }\n\n        //normalize onEntry/onExit, which can be single fn or array, or array of arrays (blocks)\n        ['onEntry', 'onExit'].forEach(function (prop) {\n            if (state[prop]) {\n                if (!Array.isArray(state[prop])) {\n                    state[prop] = [state[prop]];\n                }\n                if (!state[prop].every(function (handler) {\n                    return Array.isArray(handler);\n                })) {\n                    state[prop] = [state[prop]];\n                }\n            }\n        });\n\n        if (state.invokes && !Array.isArray(state.invokes)) {\n            state.invokes = [state.invokes];\n            state.invokes.forEach(function (invoke) {\n                if (invoke.finalize && !Array.isArray(invoke.finalize)) {\n                    invoke.finalize = [invoke.finalize];\n                }\n            });\n        }\n    }\n\n    //TODO: convert events to regular expressions in advance\n\n    function checkInitialRef(state) {\n        if (!state.initialRef) throw new Error('Unable to locate initial state for composite state: ' + state.id);\n    }\n    function connectIntialAttributes() {\n        for (var j = 0, len = statesWithInitialAttributes.length; j < len; j++) {\n            var s = statesWithInitialAttributes[j];\n\n            var initialStates = Array.isArray(s.initial) ? s.initial : [s.initial];\n            s.initialRef = initialStates.map(function (initialState) {\n                return idToStateMap.get(initialState);\n            });\n            checkInitialRef(s);\n        }\n    }\n\n    var RX_WHITESPACE = /\\s+/;\n\n    function connectTransitionGraph() {\n        //normalize as with onEntry/onExit\n        for (var i = 0, len = transitions.length; i < len; i++) {\n            var t = transitions[i];\n            if (t.onTransition && !Array.isArray(t.onTransition)) {\n                t.onTransition = [t.onTransition];\n            }\n\n            //normalize \"event\" attribute into \"events\" attribute\n            if (typeof t.event === 'string') {\n                t.events = t.event.trim().split(RX_WHITESPACE);\n            }\n            delete t.event;\n\n            if (t.targets || typeof t.target === 'undefined') {\n                //targets have already been set up\n                continue;\n            }\n\n            if (typeof t.target === 'string') {\n                var target = idToStateMap.get(t.target);\n                if (!target) throw new Error('Unable to find target state with id ' + t.target);\n                t.target = target;\n                t.targets = [t.target];\n            } else if (Array.isArray(t.target)) {\n                t.targets = t.target.map(function (target) {\n                    if (typeof target === 'string') {\n                        target = idToStateMap.get(target);\n                        if (!target) throw new Error('Unable to find target state with id ' + t.target);\n                        return target;\n                    } else {\n                        return target;\n                    }\n                });\n            } else if (_typeof(t.target) === 'object') {\n                t.targets = [t.target];\n            } else {\n                throw new Error('Transition target has unknown type: ' + t.target);\n            }\n        }\n\n        //hook up LCA - optimization\n        for (var i = 0, len = transitions.length; i < len; i++) {\n            var t = transitions[i];\n            if (t.targets) t.lcca = getLCCA(t.source, t.targets[0]); //FIXME: we technically do not need to hang onto the lcca. only the scope is used by the algorithm\n\n            t.scope = getScope(t);\n        }\n    }\n\n    function getScope(transition) {\n        //Transition scope is normally the least common compound ancestor (lcca).\n        //Internal transitions have a scope equal to the source state.\n        var transitionIsReallyInternal = transition.type === 'internal' && transition.source.typeEnum === STATE_TYPES.COMPOSITE && //is transition source a composite state\n        transition.source.parent && //root state won't have parent\n        transition.targets && //does it target its descendants\n        transition.targets.every(function (target) {\n            return transition.source.descendants.indexOf(target) > -1;\n        });\n\n        if (!transition.targets) {\n            return null;\n        } else if (transitionIsReallyInternal) {\n            return transition.source;\n        } else {\n            return transition.lcca;\n        }\n    }\n\n    function getLCCA(s1, s2) {\n        var commonAncestors = [];\n        for (var j = 0, len = s1.ancestors.length; j < len; j++) {\n            var anc = s1.ancestors[j];\n            if ((opts && opts.legacySemantics ? anc.typeEnum === STATE_TYPES.COMPOSITE : anc.typeEnum === STATE_TYPES.COMPOSITE || anc.typeEnum === STATE_TYPES.PARALLEL) && anc.descendants.indexOf(s2) > -1) {\n\n                commonAncestors.push(anc);\n            }\n        };\n        if (!commonAncestors.length) throw new Error(\"Could not find LCA for states.\");\n        return commonAncestors[0];\n    }\n\n    //main execution starts here\n    //FIXME: only wrap in root state if it's not a compound state\n    populateStateIdMap(rootState);\n    var fakeRootState = wrapInFakeRootState(rootState); //I wish we had pointer semantics and could make this a C-style \"out argument\". Instead we return him\n    traverse([], fakeRootState);\n    connectTransitionGraph();\n    connectIntialAttributes();\n\n    return fakeRootState;\n}\n\nfunction isEventPrefixMatch(prefix, fullName) {\n    prefix = prefix.replace(RX_TRAILING_WILDCARD, '');\n\n    if (prefix === fullName) {\n        return true;\n    }\n\n    if (prefix.length > fullName.length) {\n        return false;\n    }\n\n    if (fullName.charAt(prefix.length) !== '.') {\n        return false;\n    }\n\n    return fullName.indexOf(prefix) === 0;\n}\n\nfunction isTransitionMatch(t, eventName) {\n    return t.events.some(function (tEvent) {\n        return tEvent === '*' || isEventPrefixMatch(tEvent, eventName);\n    });\n}\n\nfunction scxmlPrefixTransitionSelector(t, event, evaluator, selectEventlessTransitions) {\n    return (selectEventlessTransitions ? !t.events : t.events && event && event.name && isTransitionMatch(t, event.name)) && (!t.cond || evaluator(t.cond));\n}\n\nfunction eventlessTransitionSelector(state) {\n    return state.transitions.filter(function (transition) {\n        return !transition.events || transition.events && transition.events.length === 0;\n    });\n}\n\n//priority comparison functions\nfunction getTransitionWithHigherSourceChildPriority(_args) {\n    var t1 = _args[0],\n        t2 = _args[1];\n    var r = getStateWithHigherSourceChildPriority(t1.source, t2.source);\n    //compare transitions based first on depth, then based on document order\n    if (t1.source.depth < t2.source.depth) {\n        return t2;\n    } else if (t2.source.depth < t1.source.depth) {\n        return t1;\n    } else {\n        if (t1.documentOrder < t2.documentOrder) {\n            return t1;\n        } else {\n            return t2;\n        }\n    }\n}\n\nfunction sortInEntryOrder(s1, s2) {\n    return getStateWithHigherSourceChildPriority(s1, s2) * -1;\n}\n\nfunction getStateWithHigherSourceChildPriority(s1, s2) {\n    //compare states based first on depth, then based on document order\n    if (s1.depth > s2.depth) {\n        return -1;\n    } else if (s1.depth < s2.depth) {\n        return 1;\n    } else {\n        //Equality\n        if (s1.documentOrder < s2.documentOrder) {\n            return 1;\n        } else if (s1.documentOrder > s2.documentOrder) {\n            return -1;\n        } else {\n            return 0;\n        }\n    }\n}\n\nfunction initializeModelGeneratorFn(modelFn, opts, interpreter) {\n    return modelFn.call(interpreter, opts._x, opts._x._sessionid, opts._x._ioprocessors, interpreter.isIn.bind(interpreter));\n}\n\nfunction deserializeSerializedConfiguration(serializedConfiguration, idToStateMap) {\n    return serializedConfiguration.map(function (id) {\n        var state = idToStateMap.get(id);\n        if (!state) throw new Error('Error loading serialized configuration. Unable to locate state with id ' + id);\n        return state;\n    });\n}\n\nfunction deserializeHistory(serializedHistory, idToStateMap) {\n    var o = {};\n    Object.keys(serializedHistory).forEach(function (sid) {\n        o[sid] = serializedHistory[sid].map(function (id) {\n            var state = idToStateMap.get(id);\n            if (!state) throw new Error('Error loading serialized history. Unable to locate state with id ' + id);\n            return state;\n        });\n    });\n    return o;\n}\n\n},{\"./constants\":2}],4:[function(require,module,exports){\n'use strict';\n\nvar constants = require('./constants');\n\n//model accessor functions\nvar query = {\n    isDescendant: function isDescendant(s1, s2) {\n        //Returns 'true' if state1 is a descendant of state2 (a child, or a child of a child, or a child of a child of a child, etc.) Otherwise returns 'false'.\n        return s2.descendants.indexOf(s1) > -1;\n    },\n    getAncestors: function getAncestors(s, root) {\n        var ancestors, index, state;\n        index = s.ancestors.indexOf(root);\n        if (index > -1) {\n            return s.ancestors.slice(0, index);\n        } else {\n            return s.ancestors;\n        }\n    },\n    isOrthogonalTo: function isOrthogonalTo(s1, s2) {\n        //Two control states are orthogonal if they are not ancestrally\n        //related, and their smallest, mutual parent is a Concurrent-state.\n        return !this.isAncestrallyRelatedTo(s1, s2) && this.getLCA(s1, s2).typeEnum === constants.STATE_TYPES.PARALLEL;\n    },\n    isAncestrallyRelatedTo: function isAncestrallyRelatedTo(s1, s2) {\n        //Two control states are ancestrally related if one is child/grandchild of another.\n        return this.getAncestorsOrSelf(s2).indexOf(s1) > -1 || this.getAncestorsOrSelf(s1).indexOf(s2) > -1;\n    },\n    getAncestorsOrSelf: function getAncestorsOrSelf(s, root) {\n        return [s].concat(query.getAncestors(s, root));\n    },\n    getDescendantsOrSelf: function getDescendantsOrSelf(s) {\n        return [s].concat(s.descendants);\n    },\n    getLCA: function getLCA(s1, s2) {\n        var commonAncestors = this.getAncestors(s1).filter(function (a) {\n            return a.descendants.indexOf(s2) > -1;\n        }, this);\n        return commonAncestors[0];\n    }\n};\n\nmodule.exports = query;\n\n},{\"./constants\":2}],5:[function(require,module,exports){\n(function (process){\n//   Copyright 2012-2012 Jacob Beard, INFICON, and other SCION contributors\n//\n//   Licensed under the Apache License, Version 2.0 (the \"License\");\n//   you may not use this file except in compliance with the License.\n//   You may obtain a copy of the License at\n//\n//       http://www.apache.org/licenses/LICENSE-2.0\n//\n//   Unless required by applicable law or agreed to in writing, software\n//   distributed under the License is distributed on an \"AS IS\" BASIS,\n//   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n//   See the License for the specific language governing permissions and\n//   limitations under the License.\n\n/**\n * SCION-CORE global object\n * @namespace scion\n */\n\n/**\n * An Array of strings representing the ids all of the basic states the\n * interpreter is in after a big-step completes.\n * @typedef {Array<string>} Configuration\n */\n\n/**\n * A set of basic and composite state ids.\n * @typedef {Array<string>} FullConfiguration\n */\n\n/**\n * A set of basic and composite state ids.\n * @typedef {Array<string>} FullConfiguration\n */\n\n\"use strict\";\n\nvar _slicedToArray = function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"]) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError(\"Invalid attempt to destructure non-iterable instance\"); } }; }();\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar EventEmitter = require('tiny-events').EventEmitter,\n    util = require('util'),\n    ArraySet = require('./ArraySet'),\n    constants = require('./constants'),\n    helpers = require('./helpers'),\n    query = require('./query'),\n    extend = helpers.extend,\n    transitionWithTargets = helpers.transitionWithTargets,\n    transitionComparator = helpers.transitionComparator,\n    initializeModel = helpers.initializeModel,\n    isEventPrefixMatch = helpers.isEventPrefixMatch,\n    isTransitionMatch = helpers.isTransitionMatch,\n    scxmlPrefixTransitionSelector = helpers.scxmlPrefixTransitionSelector,\n    eventlessTransitionSelector = helpers.eventlessTransitionSelector,\n    getTransitionWithHigherSourceChildPriority = helpers.getTransitionWithHigherSourceChildPriority,\n    sortInEntryOrder = helpers.sortInEntryOrder,\n    getStateWithHigherSourceChildPriority = helpers.getStateWithHigherSourceChildPriority,\n    initializeModelGeneratorFn = helpers.initializeModelGeneratorFn,\n    deserializeSerializedConfiguration = helpers.deserializeSerializedConfiguration,\n    deserializeHistory = helpers.deserializeHistory,\n    BASIC = constants.STATE_TYPES.BASIC,\n    COMPOSITE = constants.STATE_TYPES.COMPOSITE,\n    PARALLEL = constants.STATE_TYPES.PARALLEL,\n    HISTORY = constants.STATE_TYPES.HISTORY,\n    INITIAL = constants.STATE_TYPES.INITIAL,\n    FINAL = constants.STATE_TYPES.FINAL,\n    SCXML_IOPROCESSOR_TYPE = constants.SCXML_IOPROCESSOR_TYPE;\n\nvar printTrace = typeof process !== 'undefined' && !!process.env.DEBUG;\n\n/**\n * @interface EventEmitter\n */\n\n/**\n* @event scion.BaseInterpreter#onError\n* @property {string} tagname The name of the element that produced the error. \n* @property {number} line The line in the source file in which the error occurred.\n* @property {number} column The column in the source file in which the error occurred.\n* @property {string} reason An informative error message. The text is platform-specific and subject to change.\n*/\n\n/**\n * @function\n * @name EventEmitter.prototype#on\n * @param {string} type\n * @param {callback} listener\n */\n\n/**\n * @function\n * @name EventEmitter.prototype#once\n * @param {string} type\n * @param {callback} listener\n */\n\n/**\n * @function\n * @name EventEmitter.prototype#off\n * @param {string} type\n * @param {callback} listener\n */\n\n/**\n * @function\n * @name EventEmitter.prototype#emit\n * @param {string} type\n * @param {any} args\n */\n/** \n * @description The SCXML constructor creates an interpreter instance from a model object.\n * @abstract\n * @class BaseInterpreter\n * @memberof scion\n * @extends EventEmitter\n * @param {SCJSON | scxml.ModelFactory} modelOrModelFactory Either an SCJSON root state; or an scxml.ModelFactory, which is a function which returns an SCJSON object. \n * @param opts\n * @param {string} [opts.sessionid] Used to populate SCXML _sessionid.\n * @param {function} [opts.generateSessionid] Factory used to generate sessionid if sessionid keyword is not specified\n * @param {Map<string, BaseInterpreter>} [opts.sessionRegistry] Map used to map sessionid strings to Statechart instances.\n * @param [opts.Set] Class to use as an ArraySet. Defaults to ES6 Set.\n * @param {object} [opts.params]  Used to pass params from invoke. Sets the datamodel when interpreter is instantiated.\n * @param {Snapshot} [opts.snapshot] State machine snapshot. Used to restore a serialized state machine.\n * @param {Statechart} [opts.parentSession]  Used to pass parent session during invoke.\n * @param {string }[opts.invokeid]  Support for id of invoke element at runtime.\n * @param {boolean} [opts.legacySemantics]\n * @param [opts.console]\n * @param [opts.transitionSelector]\n * @param [opts.customCancel]\n * @param [opts.customSend]\n * @param [opts.sendAsync]\n * @param [opts.doSend]\n * @param [opts.invokers]\n * @param [opts.xmlParser]\n * @param [opts.interpreterScriptingContext]\n * @param [opts.invokerExecutionContext]\n */\n\nvar BaseInterpreter = function (_EventEmitter) {\n  _inherits(BaseInterpreter, _EventEmitter);\n\n  function BaseInterpreter(modelOrModelFactory, opts) {\n    _classCallCheck(this, BaseInterpreter);\n\n    var _this = _possibleConstructorReturn(this, (BaseInterpreter.__proto__ || Object.getPrototypeOf(BaseInterpreter)).call(this));\n\n    _this.opts = opts;\n\n    _this.opts.InterpreterScriptingContext = _this.opts.InterpreterScriptingContext || InterpreterScriptingContext;\n\n    _this._isStepping = false;\n\n    _this._scriptingContext = _this.opts.interpreterScriptingContext || (_this.opts.InterpreterScriptingContext ? new _this.opts.InterpreterScriptingContext(_this) : {});\n\n    _this.opts.generateSessionid = _this.opts.generateSessionid || BaseInterpreter.generateSessionid;\n    _this.opts.sessionid = _this.opts.sessionid || _this.opts.generateSessionid();\n    _this.opts.sessionRegistry = _this.opts.sessionRegistry || BaseInterpreter.sessionRegistry; //TODO: define a better interface. For now, assume a Map<sessionid, session>\n    _this.opts.invokerExecutionContext = opts.invokerExecutionContext || modelOrModelFactory._executionContext;\n\n    var _ioprocessors = {};\n    _ioprocessors[SCXML_IOPROCESSOR_TYPE] = {\n      location: '#_scxml_' + _this.opts.sessionid\n    };\n    _ioprocessors.scxml = _ioprocessors[SCXML_IOPROCESSOR_TYPE]; //alias\n\n    //SCXML system variables:\n    _this.opts._x = {\n      _sessionid: _this.opts.sessionid,\n      _ioprocessors: _ioprocessors\n    };\n\n    var model;\n    if (typeof modelOrModelFactory === 'function') {\n      model = initializeModelGeneratorFn(modelOrModelFactory, _this.opts, _this);\n    } else if ((typeof modelOrModelFactory === 'undefined' ? 'undefined' : _typeof(modelOrModelFactory)) === 'object') {\n      model = JSON.parse(JSON.stringify(modelOrModelFactory)); //assume object\n    } else {\n      throw new Error('Unexpected model type. Expected model factory function, or scjson object.');\n    }\n\n    _this._model = initializeModel(model, _this.opts);\n\n    _this.opts.console = _this.opts.console || (typeof console === 'undefined' ? { log: function log() {} } : console); //rely on global console if this console is undefined\n    _this.opts.Set = _this.opts.Set || ArraySet;\n    _this.opts.priorityComparisonFn = _this.opts.priorityComparisonFn || getTransitionWithHigherSourceChildPriority;\n    _this.opts.transitionSelector = _this.opts.transitionSelector || scxmlPrefixTransitionSelector;\n\n    _this.opts.sessionRegistry.set(String(_this.opts.sessionid), _this);\n\n    _this._scriptingContext.log = _this._scriptingContext.log || function log() {\n      if (this.opts.console.log.apply) {\n        this.opts.console.log.apply(this.opts.console, arguments);\n      } else {\n        //console.log on older IE does not support Function.apply, so just pass him the first argument. Best we can do for now.\n        this.opts.console.log(Array.prototype.slice.apply(arguments).join(','));\n      }\n    }.bind(_this); //set up default scripting context log function\n\n    _this._externalEventQueue = [];\n    _this._internalEventQueue = [];\n\n    if (_this.opts.params) {\n      _this._model.$deserializeDatamodel(_this.opts.params); //load up the datamodel\n    }\n\n    //check if we're loading from a previous snapshot\n    if (_this.opts.snapshot) {\n      _this._configuration = new _this.opts.Set(deserializeSerializedConfiguration(_this.opts.snapshot[0], _this._model.$idToStateMap));\n      _this._historyValue = deserializeHistory(_this.opts.snapshot[1], _this._model.$idToStateMap);\n      _this._isInFinalState = _this.opts.snapshot[2];\n      _this._model.$deserializeDatamodel(_this.opts.snapshot[3]); //load up the datamodel\n      _this._internalEventQueue = _this.opts.snapshot[4];\n    } else {\n      _this._configuration = new _this.opts.Set();\n      _this._historyValue = {};\n      _this._isInFinalState = false;\n    }\n\n    //add debug logging\n    BaseInterpreter.EVENTS.forEach(function (event) {\n      this.on(event, this._log.bind(this, event));\n    }, _this);\n\n    module.exports.emit('new', _this);\n    return _this;\n  }\n\n  /** \n  * Cancels the session. This clears all timers; puts the interpreter in a\n  * final state; and runs all exit actions on current states.\n  * @memberof BaseInterpreter.prototype\n  */\n\n\n  _createClass(BaseInterpreter, [{\n    key: 'cancel',\n    value: function cancel() {\n      delete this.opts.parentSession;\n      if (this._isInFinalState) return;\n      this._isInFinalState = true;\n      this._log('session cancelled ' + this.opts.invokeid);\n      this._exitInterpreter(null);\n    }\n  }, {\n    key: '_exitInterpreter',\n    value: function _exitInterpreter(event) {\n      var _this2 = this;\n\n      //TODO: cancel invoked sessions\n      //cancel all delayed sends when we enter into a final state.\n      this._cancelAllDelayedSends();\n\n      var statesToExit = this._getFullConfiguration().sort(getStateWithHigherSourceChildPriority);\n\n      for (var j = 0, len = statesToExit.length; j < len; j++) {\n        var stateExited = statesToExit[j];\n\n        if (stateExited.onExit !== undefined) {\n          for (var exitIdx = 0, exitLen = stateExited.onExit.length; exitIdx < exitLen; exitIdx++) {\n            var block = stateExited.onExit[exitIdx];\n            for (var blockIdx = 0, blockLen = block.length; blockIdx < blockLen; blockIdx++) {\n              var actionRef = block[blockIdx];\n              try {\n                actionRef.call(this._scriptingContext, null);\n              } catch (e) {\n                this._handleError(e, actionRef);\n                break;\n              }\n            }\n          }\n        }\n\n        //cancel invoked session\n        if (stateExited.invokes) stateExited.invokes.forEach(function (invoke) {\n          _this2._scriptingContext.cancelInvoke(invoke.id);\n        });\n\n        //if he is a top-level <final> state, then return the done event\n        if (stateExited.$type === 'final' && stateExited.parent.$type === 'scxml') {\n\n          if (this.opts.parentSession) {\n            this._scriptingContext.send({\n              target: '#_parent',\n              name: 'done.invoke.' + this.opts.invokeid,\n              data: stateExited.donedata && stateExited.donedata.call(this._scriptingContext, event)\n            });\n          }\n\n          this.opts.sessionRegistry.delete(this.opts.sessionid);\n          this.emit('onExitInterpreter', event);\n        }\n      }\n    }\n\n    /** \n     * Starts the interpreter. Should only be called once, and should be called\n     * before BaseInterpreter.prototype#gen is called for the first time.  Returns a\n     * Configuration.\n     * @return {Configuration}\n     * @memberof BaseInterpreter.prototype\n     * @emits scion.BaseInterpreter#onEntry\n     * @emits scion.BaseInterpreter#onExit\n     * @emits scion.BaseInterpreter#onTransition\n     * @emits scion.BaseInterpreter#onDefaultEntry\n     * @emits scion.BaseInterpreter#onError\n     * @emits scion.BaseInterpreter#onBigStepBegin\n     * @emits scion.BaseInterpreter#onBigStepEnd\n     * @emits scion.BaseInterpreter#onBigStepSuspend\n     * @emits scion.BaseInterpreter#onBigStepResume\n     * @emits scion.BaseInterpreter#onSmallStepBegin\n     * @emits scion.BaseInterpreter#onSmallStepEnd\n     * @emits scion.BaseInterpreter#onBigStepEnd\n     * @emits scion.BaseInterpreter#onExitInterpreter\n     */\n\n  }, {\n    key: 'start',\n    value: function start() {\n      this._initStart();\n      this._performBigStep();\n      return this.getConfiguration();\n    }\n\n    /**\n     * This callback is displayed as a global member.\n     * @callback genCallback\n     * @param {Error} err\n     * @param {Configuration} configuration\n     */\n\n    /**\n     * Starts the interpreter asynchronously\n     * @param  {genCallback} cb Callback invoked with an error or the interpreter's stable configuration\n     * @memberof BaseInterpreter.prototype \n     * @emits scion.BaseInterpreter#onEntry\n     * @emits scion.BaseInterpreter#onExit\n     * @emits scion.BaseInterpreter#onTransition\n     * @emits scion.BaseInterpreter#onDefaultEntry\n     * @emits scion.BaseInterpreter#onError\n     * @emits scion.BaseInterpreter#onBigStepBegin\n     * @emits scion.BaseInterpreter#onBigStepEnd\n     * @emits scion.BaseInterpreter#onBigStepSuspend\n     * @emits scion.BaseInterpreter#onBigStepResume\n     * @emits scion.BaseInterpreter#onSmallStepBegin\n     * @emits scion.BaseInterpreter#onSmallStepEnd\n     * @emits scion.BaseInterpreter#onBigStepEnd\n     * @emits scion.BaseInterpreter#onExitInterpreter\n     */\n\n  }, {\n    key: 'startAsync',\n    value: function startAsync(cb) {\n      cb = this._initStart(cb);\n      this.genAsync(null, cb);\n    }\n  }, {\n    key: '_initStart',\n    value: function _initStart(cb) {\n      var _this3 = this;\n\n      if (typeof cb !== 'function') {\n        cb = nop;\n      }\n\n      this._log(\"performing initial big step\");\n\n      //We effectively need to figure out states to enter here to populate initial config. assuming root is compound state makes this simple.\n      //but if we want it to be parallel, then this becomes more complex. so when initializing the model, we add a 'fake' root state, which\n      //makes the following operation safe.\n      this._model.initialRef.forEach(function (s) {\n        return _this3._configuration.add(s);\n      });\n\n      return cb;\n    }\n\n    /** \n    * Returns state machine {@link Configuration}.\n    * @return {Configuration}\n    * @memberof BaseInterpreter.prototype \n    */\n\n  }, {\n    key: 'getConfiguration',\n    value: function getConfiguration() {\n      return this._configuration.iter().map(function (s) {\n        return s.id;\n      });\n    }\n  }, {\n    key: '_getFullConfiguration',\n    value: function _getFullConfiguration() {\n      return this._configuration.iter().map(function (s) {\n        return [s].concat(query.getAncestors(s));\n      }, this).reduce(function (a, b) {\n        return a.concat(b);\n      }, []). //flatten\n      reduce(function (a, b) {\n        return a.indexOf(b) > -1 ? a : a.concat(b);\n      }, []); //uniq\n    }\n\n    /** \n    * @return {FullConfiguration}\n    * @memberof BaseInterpreter.prototype \n    */\n\n  }, {\n    key: 'getFullConfiguration',\n    value: function getFullConfiguration() {\n      return this._getFullConfiguration().map(function (s) {\n        return s.id;\n      });\n    }\n\n    /** \n    * @return {boolean}\n    * @memberof BaseInterpreter.prototype \n    * @param {string} stateName\n    */\n\n  }, {\n    key: 'isIn',\n    value: function isIn(stateName) {\n      return this.getFullConfiguration().indexOf(stateName) > -1;\n    }\n\n    /** \n    * Is the state machine in a final state?\n    * @return {boolean}\n    * @memberof BaseInterpreter.prototype \n    */\n\n  }, {\n    key: 'isFinal',\n    value: function isFinal() {\n      return this._isInFinalState;\n    }\n\n    /** @private */\n\n  }, {\n    key: '_performBigStep',\n    value: function _performBigStep(e) {\n      var currentEvent = void 0,\n          keepGoing = void 0,\n          allStatesExited = void 0,\n          allStatesEntered = void 0;\n\n      var _startBigStep2 = this._startBigStep(e);\n\n      var _startBigStep3 = _slicedToArray(_startBigStep2, 4);\n\n      allStatesExited = _startBigStep3[0];\n      allStatesEntered = _startBigStep3[1];\n      keepGoing = _startBigStep3[2];\n      currentEvent = _startBigStep3[3];\n\n\n      while (keepGoing) {\n        var _selectTransitionsAnd = this._selectTransitionsAndPerformSmallStep(currentEvent, allStatesEntered, allStatesExited);\n\n        var _selectTransitionsAnd2 = _slicedToArray(_selectTransitionsAnd, 2);\n\n        currentEvent = _selectTransitionsAnd2[0];\n        keepGoing = _selectTransitionsAnd2[1];\n      }\n\n      this._finishBigStep(currentEvent, allStatesEntered, allStatesExited);\n    }\n  }, {\n    key: '_selectTransitionsAndPerformSmallStep',\n    value: function _selectTransitionsAndPerformSmallStep(currentEvent, allStatesEntered, allStatesExited) {\n      //first select with null event\n      var selectedTransitions = this._selectTransitions(currentEvent, true);\n      if (selectedTransitions.isEmpty()) {\n        var ev = this._internalEventQueue.shift();\n        if (ev) {\n          currentEvent = ev;\n          selectedTransitions = this._selectTransitions(currentEvent, false);\n        }\n      }\n\n      if (!selectedTransitions.isEmpty()) {\n        this.emit('onSmallStepBegin', currentEvent);\n        var statesExited = void 0,\n            statesEntered = void 0;\n\n        var _performSmallStep2 = this._performSmallStep(currentEvent, selectedTransitions);\n\n        var _performSmallStep3 = _slicedToArray(_performSmallStep2, 2);\n\n        statesExited = _performSmallStep3[0];\n        statesEntered = _performSmallStep3[1];\n\n        if (statesExited) statesExited.forEach(function (s) {\n          return allStatesExited.add(s);\n        });\n        if (statesEntered) statesEntered.forEach(function (s) {\n          return allStatesEntered.add(s);\n        });\n        this.emit('onSmallStepEnd', currentEvent);\n      }\n      var keepGoing = !selectedTransitions.isEmpty() || this._internalEventQueue.length;\n      return [currentEvent, keepGoing];\n    }\n  }, {\n    key: '_startBigStep',\n    value: function _startBigStep(e) {\n      var _this4 = this;\n\n      this.emit('onBigStepBegin', e);\n\n      //do applyFinalize and autoforward\n      this._configuration.iter().forEach(function (state) {\n        if (state.invokes) state.invokes.forEach(function (invoke) {\n          if (invoke.autoforward) {\n            //autoforward\n            _this4._scriptingContext.send({\n              target: '#_' + invoke.id,\n              name: e.name,\n              data: e.data\n            });\n          }\n          if (invoke.id === e.invokeid) {\n            //applyFinalize\n            if (invoke.finalize) invoke.finalize.forEach(function (action) {\n              return _this4._evaluateAction(e, action);\n            });\n          }\n        });\n      });\n\n      if (e) this._internalEventQueue.push(e);\n\n      var allStatesExited = new Set(),\n          allStatesEntered = new Set();\n      var keepGoing = true;\n      var currentEvent = e;\n      return [allStatesEntered, allStatesExited, keepGoing, currentEvent];\n    }\n  }, {\n    key: '_finishBigStep',\n    value: function _finishBigStep(e, allStatesEntered, allStatesExited, cb) {\n      var _this5 = this;\n\n      var statesToInvoke = Array.from(new Set([].concat(_toConsumableArray(allStatesEntered)).filter(function (s) {\n        return s.invokes && !allStatesExited.has(s);\n      }))).sort(sortInEntryOrder);\n\n      // Here we invoke whatever needs to be invoked. The implementation of 'invoke' is platform-specific\n      statesToInvoke.forEach(function (s) {\n        s.invokes.forEach(function (f) {\n          return _this5._evaluateAction(e, f);\n        });\n      });\n\n      // cancel invoke for allStatesExited\n      allStatesExited.forEach(function (s) {\n        if (s.invokes) s.invokes.forEach(function (invoke) {\n          _this5._scriptingContext.cancelInvoke(invoke.id);\n        });\n      });\n\n      // TODO: Invoking may have raised internal error events and we iterate to handle them        \n      //if not internalQueue.isEmpty():\n      //    continue\n\n      this._isInFinalState = this._configuration.iter().every(function (s) {\n        return s.typeEnum === FINAL;\n      });\n      if (this._isInFinalState) {\n        this._exitInterpreter(e);\n      }\n      this.emit('onBigStepEnd', e);\n      if (cb) cb(undefined, this.getConfiguration());\n    }\n  }, {\n    key: '_cancelAllDelayedSends',\n    value: function _cancelAllDelayedSends() {\n      var _iteratorNormalCompletion = true;\n      var _didIteratorError = false;\n      var _iteratorError = undefined;\n\n      try {\n        for (var _iterator = this._scriptingContext._timeouts[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n          var timeoutOptions = _step.value;\n\n          if (!timeoutOptions.sendOptions.delay) continue;\n          this._log('cancelling delayed send', timeoutOptions);\n          clearTimeout(timeoutOptions.timeoutHandle);\n          this._scriptingContext._timeouts.delete(timeoutOptions);\n        }\n      } catch (err) {\n        _didIteratorError = true;\n        _iteratorError = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion && _iterator.return) {\n            _iterator.return();\n          }\n        } finally {\n          if (_didIteratorError) {\n            throw _iteratorError;\n          }\n        }\n      }\n\n      Object.keys(this._scriptingContext._timeoutMap).forEach(function (key) {\n        delete this._scriptingContext._timeoutMap[key];\n      }, this);\n    }\n  }, {\n    key: '_performBigStepAsync',\n    value: function _performBigStepAsync(e, cb) {\n      var currentEvent = void 0,\n          keepGoing = void 0,\n          allStatesExited = void 0,\n          allStatesEntered = void 0;\n\n      var _startBigStep4 = this._startBigStep(e);\n\n      var _startBigStep5 = _slicedToArray(_startBigStep4, 4);\n\n      allStatesExited = _startBigStep5[0];\n      allStatesEntered = _startBigStep5[1];\n      keepGoing = _startBigStep5[2];\n      currentEvent = _startBigStep5[3];\n\n\n      function nextStep(emit) {\n        this.emit(emit);\n\n        var _selectTransitionsAnd3 = this._selectTransitionsAndPerformSmallStep(currentEvent, allStatesEntered, allStatesExited);\n\n        var _selectTransitionsAnd4 = _slicedToArray(_selectTransitionsAnd3, 2);\n\n        currentEvent = _selectTransitionsAnd4[0];\n        keepGoing = _selectTransitionsAnd4[1];\n\n\n        if (keepGoing) {\n          this.emit('onBigStepSuspend');\n          setImmediate(nextStep.bind(this, 'onBigStepResume'));\n        } else {\n          this._finishBigStep(currentEvent, allStatesEntered, allStatesExited, cb);\n        }\n      }\n      nextStep.call(this, 'onBigStepBegin');\n    }\n\n    /** @private */\n\n  }, {\n    key: '_performSmallStep',\n    value: function _performSmallStep(currentEvent, selectedTransitions) {\n\n      this._log(\"selecting transitions with currentEvent\", currentEvent);\n\n      this._log(\"selected transitions\", selectedTransitions);\n\n      var statesExited = void 0,\n          statesEntered = void 0;\n\n      if (!selectedTransitions.isEmpty()) {\n\n        //we only want to enter and exit states from transitions with targets\n        //filter out targetless transitions here - we will only use these to execute transition actions\n        var selectedTransitionsWithTargets = new this.opts.Set(selectedTransitions.iter().filter(transitionWithTargets));\n\n        statesExited = this._exitStates(currentEvent, selectedTransitionsWithTargets);\n        this._executeTransitions(currentEvent, selectedTransitions);\n        statesEntered = this._enterStates(currentEvent, selectedTransitionsWithTargets);\n\n        this._log(\"new configuration \", this._configuration);\n      }\n\n      return [statesExited, statesEntered];\n    }\n  }, {\n    key: '_exitStates',\n    value: function _exitStates(currentEvent, selectedTransitionsWithTargets) {\n      var basicStatesExited = void 0,\n          statesExited = void 0;\n\n      var _getStatesExited2 = this._getStatesExited(selectedTransitionsWithTargets);\n\n      var _getStatesExited3 = _slicedToArray(_getStatesExited2, 2);\n\n      basicStatesExited = _getStatesExited3[0];\n      statesExited = _getStatesExited3[1];\n\n\n      this._log('exiting states');\n      for (var j = 0, len = statesExited.length; j < len; j++) {\n        var stateExited = statesExited[j];\n\n        if (stateExited.isAtomic) this._configuration.remove(stateExited);\n\n        this._log(\"exiting \", stateExited.id);\n\n        //invoke listeners\n        this.emit('onExit', stateExited.id);\n\n        if (stateExited.onExit !== undefined) {\n          for (var exitIdx = 0, exitLen = stateExited.onExit.length; exitIdx < exitLen; exitIdx++) {\n            var block = stateExited.onExit[exitIdx];\n            for (var blockIdx = 0, blockLen = block.length; blockIdx < blockLen; blockIdx++) {\n              var actionRef = block[blockIdx];\n              try {\n                actionRef.call(this._scriptingContext, currentEvent);\n              } catch (e) {\n                this._handleError(e, actionRef);\n                break;\n              }\n            }\n          }\n        }\n\n        var f;\n        if (stateExited.historyRef) {\n          var _iteratorNormalCompletion2 = true;\n          var _didIteratorError2 = false;\n          var _iteratorError2 = undefined;\n\n          try {\n            for (var _iterator2 = stateExited.historyRef[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {\n              var historyRef = _step2.value;\n\n              if (historyRef.isDeep) {\n                f = function f(s0) {\n                  return s0.typeEnum === BASIC && stateExited.descendants.indexOf(s0) > -1;\n                };\n              } else {\n                f = function f(s0) {\n                  return s0.parent === stateExited;\n                };\n              }\n              //update history\n              this._historyValue[historyRef.id] = statesExited.filter(f);\n            }\n          } catch (err) {\n            _didIteratorError2 = true;\n            _iteratorError2 = err;\n          } finally {\n            try {\n              if (!_iteratorNormalCompletion2 && _iterator2.return) {\n                _iterator2.return();\n              }\n            } finally {\n              if (_didIteratorError2) {\n                throw _iteratorError2;\n              }\n            }\n          }\n        }\n      }\n\n      return statesExited;\n    }\n\n    /** @private */\n\n  }, {\n    key: '_getStatesExited',\n    value: function _getStatesExited(transitions) {\n      var statesExited = new this.opts.Set();\n      var basicStatesExited = new this.opts.Set();\n\n      //States exited are defined to be active states that are\n      //descendants of the scope of each priority-enabled transition.\n      //Here, we iterate through the transitions, and collect states\n      //that match this condition. \n      var transitionList = transitions.iter();\n      for (var txIdx = 0, txLen = transitionList.length; txIdx < txLen; txIdx++) {\n        var transition = transitionList[txIdx];\n        var scope = transition.scope,\n            desc = scope.descendants;\n\n        //For each state in the configuration\n        //is that state a descendant of the transition scope?\n        //Store ancestors of that state up to but not including the scope.\n        var configList = this._configuration.iter();\n        for (var cfgIdx = 0, cfgLen = configList.length; cfgIdx < cfgLen; cfgIdx++) {\n          var state = configList[cfgIdx];\n          if (desc.indexOf(state) > -1) {\n            basicStatesExited.add(state);\n            statesExited.add(state);\n            var ancestors = query.getAncestors(state, scope);\n            for (var ancIdx = 0, ancLen = ancestors.length; ancIdx < ancLen; ancIdx++) {\n              statesExited.add(ancestors[ancIdx]);\n            }\n          }\n        }\n      }\n\n      var sortedStatesExited = statesExited.iter().sort(getStateWithHigherSourceChildPriority);\n      return [basicStatesExited, sortedStatesExited];\n    }\n  }, {\n    key: '_executeTransitions',\n    value: function _executeTransitions(currentEvent, selectedTransitions) {\n      var sortedTransitions = selectedTransitions.iter().sort(transitionComparator);\n\n      this._log(\"executing transitition actions\");\n      for (var stxIdx = 0, len = sortedTransitions.length; stxIdx < len; stxIdx++) {\n        var transition = sortedTransitions[stxIdx];\n\n        var targetIds = transition.targets && transition.targets.map(function (target) {\n          return target.id;\n        });\n\n        this.emit('onTransition', transition.source.id, targetIds, transition.source.transitions.indexOf(transition));\n\n        if (transition.onTransition !== undefined) {\n          for (var txIdx = 0, txLen = transition.onTransition.length; txIdx < txLen; txIdx++) {\n            var actionRef = transition.onTransition[txIdx];\n            try {\n              actionRef.call(this._scriptingContext, currentEvent);\n            } catch (e) {\n              this._handleError(e, actionRef);\n              break;\n            }\n          }\n        }\n      }\n    }\n  }, {\n    key: '_enterStates',\n    value: function _enterStates(currentEvent, selectedTransitionsWithTargets) {\n      var _this6 = this;\n\n      this._log(\"entering states\");\n\n      var statesEntered = new Set();\n      var statesForDefaultEntry = new Set();\n      // initialize the temporary table for default content in history states\n      var defaultHistoryContent = {};\n      this._computeEntrySet(selectedTransitionsWithTargets, statesEntered, statesForDefaultEntry, defaultHistoryContent);\n      statesEntered = Array.from(statesEntered).sort(sortInEntryOrder);\n\n      this._log(\"statesEntered \", statesEntered);\n\n      for (var enterIdx = 0, enterLen = statesEntered.length; enterIdx < enterLen; enterIdx++) {\n        var stateEntered = statesEntered[enterIdx];\n\n        if (stateEntered.isAtomic) this._configuration.add(stateEntered);\n\n        this._log(\"entering\", stateEntered.id);\n\n        this.emit('onEntry', stateEntered.id);\n\n        if (stateEntered.onEntry !== undefined) {\n          for (var entryIdx = 0, entryLen = stateEntered.onEntry.length; entryIdx < entryLen; entryIdx++) {\n            var block = stateEntered.onEntry[entryIdx];\n            for (var blockIdx = 0, blockLen = block.length; blockIdx < blockLen; blockIdx++) {\n              var actionRef = block[blockIdx];\n              try {\n                actionRef.call(this._scriptingContext, currentEvent);\n              } catch (e) {\n                this._handleError(e, actionRef);\n                break;\n              }\n            }\n          }\n        }\n\n        if (statesForDefaultEntry.has(stateEntered)) {\n          var _iteratorNormalCompletion3 = true;\n          var _didIteratorError3 = false;\n          var _iteratorError3 = undefined;\n\n          try {\n            for (var _iterator3 = stateEntered.initialRef[Symbol.iterator](), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {\n              var initialState = _step3.value;\n\n              this.emit('onDefaultEntry', initialState.id);\n              if (initialState.typeEnum === INITIAL) {\n                var transition = initialState.transitions[0];\n                if (transition.onTransition !== undefined) {\n                  this._log('executing initial transition content for initial state of parent state', stateEntered.id);\n                  for (var txIdx = 0, txLen = transition.onTransition.length; txIdx < txLen; txIdx++) {\n                    var _actionRef = transition.onTransition[txIdx];\n                    try {\n                      _actionRef.call(this._scriptingContext, currentEvent);\n                    } catch (e) {\n                      this._handleError(e, _actionRef);\n                      break;\n                    }\n                  }\n                }\n              }\n            }\n          } catch (err) {\n            _didIteratorError3 = true;\n            _iteratorError3 = err;\n          } finally {\n            try {\n              if (!_iteratorNormalCompletion3 && _iterator3.return) {\n                _iterator3.return();\n              }\n            } finally {\n              if (_didIteratorError3) {\n                throw _iteratorError3;\n              }\n            }\n          }\n        }\n\n        if (defaultHistoryContent[stateEntered.id]) {\n          var _transition = defaultHistoryContent[stateEntered.id];\n          if (_transition.onTransition !== undefined) {\n            this._log('executing history transition content for history state of parent state', stateEntered.id);\n            for (var txIdx = 0, txLen = _transition.onTransition.length; txIdx < txLen; txIdx++) {\n              var _actionRef2 = _transition.onTransition[txIdx];\n              try {\n                _actionRef2.call(this._scriptingContext, currentEvent);\n              } catch (e) {\n                this._handleError(e, _actionRef2);\n                break;\n              }\n            }\n          }\n        }\n      }\n\n      for (var enterIdx = 0, enterLen = statesEntered.length; enterIdx < enterLen; enterIdx++) {\n        var stateEntered = statesEntered[enterIdx];\n        if (stateEntered.typeEnum === FINAL) {\n          var parent = stateEntered.parent;\n          var grandparent = parent.parent;\n          this._internalEventQueue.push({ name: \"done.state.\" + parent.id, data: stateEntered.donedata && stateEntered.donedata.call(this._scriptingContext, currentEvent) });\n          if (grandparent && grandparent.typeEnum === PARALLEL) {\n            if (grandparent.states.every(function (s) {\n              return _this6.isInFinalState(s);\n            })) {\n              this._internalEventQueue.push({ name: \"done.state.\" + grandparent.id });\n            }\n          }\n        }\n      }\n\n      return statesEntered;\n    }\n  }, {\n    key: '_getEffectiveTargetStates',\n    value: function _getEffectiveTargetStates(transition) {\n      var targets = new Set();\n      var _iteratorNormalCompletion4 = true;\n      var _didIteratorError4 = false;\n      var _iteratorError4 = undefined;\n\n      try {\n        for (var _iterator4 = transition.targets[Symbol.iterator](), _step4; !(_iteratorNormalCompletion4 = (_step4 = _iterator4.next()).done); _iteratorNormalCompletion4 = true) {\n          var s = _step4.value;\n\n          if (s.typeEnum === HISTORY) {\n            if (s.id in this._historyValue) this._historyValue[s.id].forEach(function (state) {\n              return targets.add(state);\n            });else [].concat(_toConsumableArray(this._getEffectiveTargetStates(s.transitions[0]))).forEach(function (state) {\n              return targets.add(state);\n            });\n          } else {\n            targets.add(s);\n          }\n        }\n      } catch (err) {\n        _didIteratorError4 = true;\n        _iteratorError4 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion4 && _iterator4.return) {\n            _iterator4.return();\n          }\n        } finally {\n          if (_didIteratorError4) {\n            throw _iteratorError4;\n          }\n        }\n      }\n\n      return targets;\n    }\n  }, {\n    key: '_computeEntrySet',\n    value: function _computeEntrySet(transitions, statesToEnter, statesForDefaultEntry, defaultHistoryContent) {\n      var _iteratorNormalCompletion5 = true;\n      var _didIteratorError5 = false;\n      var _iteratorError5 = undefined;\n\n      try {\n        for (var _iterator5 = transitions.iter()[Symbol.iterator](), _step5; !(_iteratorNormalCompletion5 = (_step5 = _iterator5.next()).done); _iteratorNormalCompletion5 = true) {\n          var t = _step5.value;\n          var _iteratorNormalCompletion6 = true;\n          var _didIteratorError6 = false;\n          var _iteratorError6 = undefined;\n\n          try {\n            for (var _iterator6 = t.targets[Symbol.iterator](), _step6; !(_iteratorNormalCompletion6 = (_step6 = _iterator6.next()).done); _iteratorNormalCompletion6 = true) {\n              var s = _step6.value;\n\n              this._addDescendantStatesToEnter(s, statesToEnter, statesForDefaultEntry, defaultHistoryContent);\n            }\n          } catch (err) {\n            _didIteratorError6 = true;\n            _iteratorError6 = err;\n          } finally {\n            try {\n              if (!_iteratorNormalCompletion6 && _iterator6.return) {\n                _iterator6.return();\n              }\n            } finally {\n              if (_didIteratorError6) {\n                throw _iteratorError6;\n              }\n            }\n          }\n\n          var ancestor = t.scope;\n          var _iteratorNormalCompletion7 = true;\n          var _didIteratorError7 = false;\n          var _iteratorError7 = undefined;\n\n          try {\n            for (var _iterator7 = this._getEffectiveTargetStates(t)[Symbol.iterator](), _step7; !(_iteratorNormalCompletion7 = (_step7 = _iterator7.next()).done); _iteratorNormalCompletion7 = true) {\n              var _s = _step7.value;\n\n              this._addAncestorStatesToEnter(_s, ancestor, statesToEnter, statesForDefaultEntry, defaultHistoryContent);\n            }\n          } catch (err) {\n            _didIteratorError7 = true;\n            _iteratorError7 = err;\n          } finally {\n            try {\n              if (!_iteratorNormalCompletion7 && _iterator7.return) {\n                _iterator7.return();\n              }\n            } finally {\n              if (_didIteratorError7) {\n                throw _iteratorError7;\n              }\n            }\n          }\n        }\n      } catch (err) {\n        _didIteratorError5 = true;\n        _iteratorError5 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion5 && _iterator5.return) {\n            _iterator5.return();\n          }\n        } finally {\n          if (_didIteratorError5) {\n            throw _iteratorError5;\n          }\n        }\n      }\n    }\n  }, {\n    key: '_computeExitSet',\n    value: function _computeExitSet(transitions) {\n      var statesToExit = new Set();\n      var _iteratorNormalCompletion8 = true;\n      var _didIteratorError8 = false;\n      var _iteratorError8 = undefined;\n\n      try {\n        for (var _iterator8 = transitions[Symbol.iterator](), _step8; !(_iteratorNormalCompletion8 = (_step8 = _iterator8.next()).done); _iteratorNormalCompletion8 = true) {\n          var t = _step8.value;\n\n          if (t.targets) {\n            var scope = t.scope;\n            var _iteratorNormalCompletion9 = true;\n            var _didIteratorError9 = false;\n            var _iteratorError9 = undefined;\n\n            try {\n              for (var _iterator9 = this._getFullConfiguration()[Symbol.iterator](), _step9; !(_iteratorNormalCompletion9 = (_step9 = _iterator9.next()).done); _iteratorNormalCompletion9 = true) {\n                var s = _step9.value;\n\n                if (query.isDescendant(s, scope)) statesToExit.add(s);\n              }\n            } catch (err) {\n              _didIteratorError9 = true;\n              _iteratorError9 = err;\n            } finally {\n              try {\n                if (!_iteratorNormalCompletion9 && _iterator9.return) {\n                  _iterator9.return();\n                }\n              } finally {\n                if (_didIteratorError9) {\n                  throw _iteratorError9;\n                }\n              }\n            }\n          }\n        }\n      } catch (err) {\n        _didIteratorError8 = true;\n        _iteratorError8 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion8 && _iterator8.return) {\n            _iterator8.return();\n          }\n        } finally {\n          if (_didIteratorError8) {\n            throw _iteratorError8;\n          }\n        }\n      }\n\n      return statesToExit;\n    }\n  }, {\n    key: '_addAncestorStatesToEnter',\n    value: function _addAncestorStatesToEnter(state, ancestor, statesToEnter, statesForDefaultEntry, defaultHistoryContent) {\n      var _this7 = this;\n\n      var traverse = function traverse(anc) {\n        if (anc.typeEnum === PARALLEL) {\n          var _iteratorNormalCompletion10 = true;\n          var _didIteratorError10 = false;\n          var _iteratorError10 = undefined;\n\n          try {\n            var _loop = function _loop() {\n              var child = _step10.value;\n\n              if (child.typeEnum !== HISTORY && ![].concat(_toConsumableArray(statesToEnter)).some(function (s) {\n                return query.isDescendant(s, child);\n              })) {\n                _this7._addDescendantStatesToEnter(child, statesToEnter, statesForDefaultEntry, defaultHistoryContent);\n              }\n            };\n\n            for (var _iterator10 = anc.states[Symbol.iterator](), _step10; !(_iteratorNormalCompletion10 = (_step10 = _iterator10.next()).done); _iteratorNormalCompletion10 = true) {\n              _loop();\n            }\n          } catch (err) {\n            _didIteratorError10 = true;\n            _iteratorError10 = err;\n          } finally {\n            try {\n              if (!_iteratorNormalCompletion10 && _iterator10.return) {\n                _iterator10.return();\n              }\n            } finally {\n              if (_didIteratorError10) {\n                throw _iteratorError10;\n              }\n            }\n          }\n        }\n      };\n      var _iteratorNormalCompletion11 = true;\n      var _didIteratorError11 = false;\n      var _iteratorError11 = undefined;\n\n      try {\n        for (var _iterator11 = query.getAncestors(state, ancestor)[Symbol.iterator](), _step11; !(_iteratorNormalCompletion11 = (_step11 = _iterator11.next()).done); _iteratorNormalCompletion11 = true) {\n          var anc = _step11.value;\n\n          statesToEnter.add(anc);\n          traverse(anc);\n        }\n      } catch (err) {\n        _didIteratorError11 = true;\n        _iteratorError11 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion11 && _iterator11.return) {\n            _iterator11.return();\n          }\n        } finally {\n          if (_didIteratorError11) {\n            throw _iteratorError11;\n          }\n        }\n      }\n\n      traverse(ancestor);\n    }\n  }, {\n    key: '_addDescendantStatesToEnter',\n    value: function _addDescendantStatesToEnter(state, statesToEnter, statesForDefaultEntry, defaultHistoryContent) {\n      var _this8 = this;\n\n      if (state.typeEnum === HISTORY) {\n        if (this._historyValue[state.id]) {\n          var _iteratorNormalCompletion12 = true;\n          var _didIteratorError12 = false;\n          var _iteratorError12 = undefined;\n\n          try {\n            for (var _iterator12 = this._historyValue[state.id][Symbol.iterator](), _step12; !(_iteratorNormalCompletion12 = (_step12 = _iterator12.next()).done); _iteratorNormalCompletion12 = true) {\n              var s = _step12.value;\n\n              this._addDescendantStatesToEnter(s, statesToEnter, statesForDefaultEntry, defaultHistoryContent);\n            }\n          } catch (err) {\n            _didIteratorError12 = true;\n            _iteratorError12 = err;\n          } finally {\n            try {\n              if (!_iteratorNormalCompletion12 && _iterator12.return) {\n                _iterator12.return();\n              }\n            } finally {\n              if (_didIteratorError12) {\n                throw _iteratorError12;\n              }\n            }\n          }\n\n          var _iteratorNormalCompletion13 = true;\n          var _didIteratorError13 = false;\n          var _iteratorError13 = undefined;\n\n          try {\n            for (var _iterator13 = this._historyValue[state.id][Symbol.iterator](), _step13; !(_iteratorNormalCompletion13 = (_step13 = _iterator13.next()).done); _iteratorNormalCompletion13 = true) {\n              var _s2 = _step13.value;\n\n              this._addAncestorStatesToEnter(_s2, state.parent, statesToEnter, statesForDefaultEntry, defaultHistoryContent);\n            }\n          } catch (err) {\n            _didIteratorError13 = true;\n            _iteratorError13 = err;\n          } finally {\n            try {\n              if (!_iteratorNormalCompletion13 && _iterator13.return) {\n                _iterator13.return();\n              }\n            } finally {\n              if (_didIteratorError13) {\n                throw _iteratorError13;\n              }\n            }\n          }\n        } else {\n          defaultHistoryContent[state.parent.id] = state.transitions[0];\n          var _iteratorNormalCompletion14 = true;\n          var _didIteratorError14 = false;\n          var _iteratorError14 = undefined;\n\n          try {\n            for (var _iterator14 = state.transitions[0].targets[Symbol.iterator](), _step14; !(_iteratorNormalCompletion14 = (_step14 = _iterator14.next()).done); _iteratorNormalCompletion14 = true) {\n              var _s3 = _step14.value;\n\n              this._addDescendantStatesToEnter(_s3, statesToEnter, statesForDefaultEntry, defaultHistoryContent);\n            }\n          } catch (err) {\n            _didIteratorError14 = true;\n            _iteratorError14 = err;\n          } finally {\n            try {\n              if (!_iteratorNormalCompletion14 && _iterator14.return) {\n                _iterator14.return();\n              }\n            } finally {\n              if (_didIteratorError14) {\n                throw _iteratorError14;\n              }\n            }\n          }\n\n          var _iteratorNormalCompletion15 = true;\n          var _didIteratorError15 = false;\n          var _iteratorError15 = undefined;\n\n          try {\n            for (var _iterator15 = state.transitions[0].targets[Symbol.iterator](), _step15; !(_iteratorNormalCompletion15 = (_step15 = _iterator15.next()).done); _iteratorNormalCompletion15 = true) {\n              var _s4 = _step15.value;\n\n              this._addAncestorStatesToEnter(_s4, state.parent, statesToEnter, statesForDefaultEntry, defaultHistoryContent);\n            }\n          } catch (err) {\n            _didIteratorError15 = true;\n            _iteratorError15 = err;\n          } finally {\n            try {\n              if (!_iteratorNormalCompletion15 && _iterator15.return) {\n                _iterator15.return();\n              }\n            } finally {\n              if (_didIteratorError15) {\n                throw _iteratorError15;\n              }\n            }\n          }\n        }\n      } else {\n        statesToEnter.add(state);\n        if (state.typeEnum === COMPOSITE) {\n          statesForDefaultEntry.add(state);\n          //for each state in initialRef, if it is an initial state, then add ancestors and descendants.\n          var _iteratorNormalCompletion16 = true;\n          var _didIteratorError16 = false;\n          var _iteratorError16 = undefined;\n\n          try {\n            for (var _iterator16 = state.initialRef[Symbol.iterator](), _step16; !(_iteratorNormalCompletion16 = (_step16 = _iterator16.next()).done); _iteratorNormalCompletion16 = true) {\n              var _s5 = _step16.value;\n\n              var targets = _s5.typeEnum === INITIAL ? _s5.transitions[0].targets : [_s5];\n              var _iteratorNormalCompletion18 = true;\n              var _didIteratorError18 = false;\n              var _iteratorError18 = undefined;\n\n              try {\n                for (var _iterator18 = targets[Symbol.iterator](), _step18; !(_iteratorNormalCompletion18 = (_step18 = _iterator18.next()).done); _iteratorNormalCompletion18 = true) {\n                  var targetState = _step18.value;\n\n                  this._addDescendantStatesToEnter(targetState, statesToEnter, statesForDefaultEntry, defaultHistoryContent);\n                }\n              } catch (err) {\n                _didIteratorError18 = true;\n                _iteratorError18 = err;\n              } finally {\n                try {\n                  if (!_iteratorNormalCompletion18 && _iterator18.return) {\n                    _iterator18.return();\n                  }\n                } finally {\n                  if (_didIteratorError18) {\n                    throw _iteratorError18;\n                  }\n                }\n              }\n            }\n          } catch (err) {\n            _didIteratorError16 = true;\n            _iteratorError16 = err;\n          } finally {\n            try {\n              if (!_iteratorNormalCompletion16 && _iterator16.return) {\n                _iterator16.return();\n              }\n            } finally {\n              if (_didIteratorError16) {\n                throw _iteratorError16;\n              }\n            }\n          }\n\n          var _iteratorNormalCompletion17 = true;\n          var _didIteratorError17 = false;\n          var _iteratorError17 = undefined;\n\n          try {\n            for (var _iterator17 = state.initialRef[Symbol.iterator](), _step17; !(_iteratorNormalCompletion17 = (_step17 = _iterator17.next()).done); _iteratorNormalCompletion17 = true) {\n              var _s6 = _step17.value;\n\n              var _targets = _s6.typeEnum === INITIAL ? _s6.transitions[0].targets : [_s6];\n              var _iteratorNormalCompletion19 = true;\n              var _didIteratorError19 = false;\n              var _iteratorError19 = undefined;\n\n              try {\n                for (var _iterator19 = _targets[Symbol.iterator](), _step19; !(_iteratorNormalCompletion19 = (_step19 = _iterator19.next()).done); _iteratorNormalCompletion19 = true) {\n                  var _targetState = _step19.value;\n\n                  this._addAncestorStatesToEnter(_targetState, state, statesToEnter, statesForDefaultEntry, defaultHistoryContent);\n                }\n              } catch (err) {\n                _didIteratorError19 = true;\n                _iteratorError19 = err;\n              } finally {\n                try {\n                  if (!_iteratorNormalCompletion19 && _iterator19.return) {\n                    _iterator19.return();\n                  }\n                } finally {\n                  if (_didIteratorError19) {\n                    throw _iteratorError19;\n                  }\n                }\n              }\n            }\n          } catch (err) {\n            _didIteratorError17 = true;\n            _iteratorError17 = err;\n          } finally {\n            try {\n              if (!_iteratorNormalCompletion17 && _iterator17.return) {\n                _iterator17.return();\n              }\n            } finally {\n              if (_didIteratorError17) {\n                throw _iteratorError17;\n              }\n            }\n          }\n        } else {\n          if (state.typeEnum === PARALLEL) {\n            var _iteratorNormalCompletion20 = true;\n            var _didIteratorError20 = false;\n            var _iteratorError20 = undefined;\n\n            try {\n              var _loop2 = function _loop2() {\n                var child = _step20.value;\n\n                if (child.typeEnum !== HISTORY && ![].concat(_toConsumableArray(statesToEnter)).some(function (s) {\n                  return query.isDescendant(s, child);\n                })) {\n                  _this8._addDescendantStatesToEnter(child, statesToEnter, statesForDefaultEntry, defaultHistoryContent);\n                }\n              };\n\n              for (var _iterator20 = state.states[Symbol.iterator](), _step20; !(_iteratorNormalCompletion20 = (_step20 = _iterator20.next()).done); _iteratorNormalCompletion20 = true) {\n                _loop2();\n              }\n            } catch (err) {\n              _didIteratorError20 = true;\n              _iteratorError20 = err;\n            } finally {\n              try {\n                if (!_iteratorNormalCompletion20 && _iterator20.return) {\n                  _iterator20.return();\n                }\n              } finally {\n                if (_didIteratorError20) {\n                  throw _iteratorError20;\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  }, {\n    key: 'isInFinalState',\n    value: function isInFinalState(s) {\n      var _this9 = this;\n\n      if (s.typeEnum === COMPOSITE) {\n        return s.states.some(function (s) {\n          return s.typeEnum === FINAL && _this9._configuration.contains(s);\n        });\n      } else if (s.typeEnum === PARALLEL) {\n        return s.states.every(this.isInFinalState.bind(this));\n      } else {\n        return false;\n      }\n    }\n\n    /** @private */\n\n  }, {\n    key: '_evaluateAction',\n    value: function _evaluateAction(currentEvent, actionRef) {\n      try {\n        return actionRef.call(this._scriptingContext, currentEvent); //SCXML system variables\n      } catch (e) {\n        this._handleError(e, actionRef);\n      }\n    }\n  }, {\n    key: '_handleError',\n    value: function _handleError(e, actionRef) {\n      var event = e instanceof Error || typeof e.__proto__.name === 'string' && e.__proto__.name.match(/^.*Error$/) ? //we can't just do 'e instanceof Error', because the Error object in the sandbox is from a different context, and instanceof will return false\n      {\n        name: 'error.execution',\n        data: {\n          tagname: actionRef.tagname,\n          line: actionRef.line,\n          column: actionRef.column,\n          reason: e.message\n        },\n        type: 'platform'\n      } : e.name ? e : {\n        name: 'error.execution',\n        data: e,\n        type: 'platform'\n      };\n      this._internalEventQueue.push(event);\n      this.emit('onError', event);\n    }\n  }, {\n    key: '_log',\n    value: function _log() {\n      if (printTrace) {\n        var args = Array.from(arguments);\n        this.opts.console.log(args[0] + ': ' + args.slice(1).map(function (arg) {\n          return arg === null ? 'null' : arg === undefined ? 'undefined' : typeof arg === 'string' ? arg : arg.toString() === '[object Object]' ? util.inspect(arg) : arg.toString();\n        }).join(', ') + '\\n');\n      }\n    }\n\n    /**\n    * @interface Listener\n    */\n\n    /**\n    * @function\n    * @name Listener#onEntry \n    * @param {string} stateId\n    */\n\n    /**\n    * @function\n    * @name Listener#onExit \n    * @param {string} stateId\n    */\n\n    /**\n    * @function\n    * @name Listener#onTransition \n    * @param {string} sourceStateId Id of the source state\n    * @param {Array<string>} targetStatesIds Ids of the target states\n    * @param {number} transitionIndex Index of the transition relative to other transitions originating from source state.\n    */\n\n    /**\n    * @function\n    * @name Listener#onError\n    * @param {Error} errorInfo\n    */\n\n    /**\n    * @function\n    * @name Listener#onBigStepBegin\n    */\n\n    /**\n    * @function\n    * @name Listener#onBigStepResume\n    */\n\n    /**\n    * @function\n    * @name Listener#onBigStepSuspend\n    */\n\n    /**\n    * @function\n    * @name Listener#onBigStepEnd\n    */\n\n    /**\n    * @function\n    * @name Listener#onSmallStepBegin\n    * @param {string} event\n    */\n\n    /**\n    * @function\n    * @name Listener#onSmallStepEnd\n    */\n\n    /** \n    * Provides a generic mechanism to subscribe to state change and runtime\n    * error notifications.  Can be used for logging and debugging. For example,\n    * can attach a logger that simply logs the state changes.  Or can attach a\n    * network debugging client that sends state change notifications to a\n    * debugging server.\n    * This is an alternative interface to {@link EventEmitter.prototype#on}.\n    * @memberof BaseInterpreter.prototype \n    * @param {Listener} listener\n    */\n\n  }, {\n    key: 'registerListener',\n    value: function registerListener(listener) {\n      BaseInterpreter.EVENTS.forEach(function (event) {\n        if (listener[event]) this.on(event, listener[event]);\n      }, this);\n    }\n\n    /** \n    * Unregister a Listener\n    * @memberof BaseInterpreter.prototype \n    * @param {Listener} listener\n    */\n\n  }, {\n    key: 'unregisterListener',\n    value: function unregisterListener(listener) {\n      BaseInterpreter.EVENTS.forEach(function (event) {\n        if (listener[event]) this.off(event, listener[event]);\n      }, this);\n    }\n\n    /** \n    * Query the model to get all transition events.\n    * @return {Array<string>} Transition events.\n    * @memberof BaseInterpreter.prototype \n    */\n\n  }, {\n    key: 'getAllTransitionEvents',\n    value: function getAllTransitionEvents() {\n      var events = {};\n      function getEvents(state) {\n\n        if (state.transitions) {\n          for (var txIdx = 0, txLen = state.transitions.length; txIdx < txLen; txIdx++) {\n            events[state.transitions[txIdx].event] = true;\n          }\n        }\n\n        if (state.states) {\n          for (var stateIdx = 0, stateLen = state.states.length; stateIdx < stateLen; stateIdx++) {\n            getEvents(state.states[stateIdx]);\n          }\n        }\n      }\n\n      getEvents(this._model);\n\n      return Object.keys(events);\n    }\n\n    /**\n    * Three things capture the current snapshot of a running SCION interpreter:\n    *\n    *      <ul>\n    *      <li> basic configuration (the set of basic states the state machine is in)</li>\n    *      <li> history state values (the states the state machine was in last time it was in the parent of a history state)</li>\n    *      <li> the datamodel</li>\n    *      </ul>\n    *      \n    * The snapshot object can be serialized as JSON and saved to a database. It can\n    * later be passed to the SCXML constructor to restore the state machine\n    * using the snapshot argument.\n    *\n    * @return {Snapshot} \n    * @memberof BaseInterpreter.prototype \n    */\n\n  }, {\n    key: 'getSnapshot',\n    value: function getSnapshot() {\n      return [this.getConfiguration(), this._serializeHistory(), this._isInFinalState, this._model.$serializeDatamodel(), this._internalEventQueue.slice()];\n    }\n  }, {\n    key: '_serializeHistory',\n    value: function _serializeHistory() {\n      var o = {};\n      Object.keys(this._historyValue).forEach(function (sid) {\n        o[sid] = this._historyValue[sid].map(function (state) {\n          return state.id;\n        });\n      }, this);\n      return o;\n    }\n\n    /**\n     * @interface Event\n     */\n\n    /** \n    * @member name\n    * @memberof Event.prototype \n    * @type string\n    * @description The name of the event\n    */\n\n    /** \n    * @member data\n    * @memberof Event.prototype \n    * @type any\n    * @description The event data\n    */\n\n    /** \n    * An SCXML interpreter takes SCXML events as input, where an SCXML event is an\n    * object with \"name\" and \"data\" properties. These can be passed to method `gen`\n    * as two positional arguments, or as a single object.\n    * @param {string|Event} evtObjOrName\n    * @param {any=} optionalData\n    * @emits scion.BaseInterpreter#onEntry\n    * @emits scion.BaseInterpreter#onExit\n    * @emits scion.BaseInterpreter#onTransition\n    * @emits scion.BaseInterpreter#onDefaultEntry\n    * @emits scion.BaseInterpreter#onError\n    * @emits scion.BaseInterpreter#onBigStepBegin\n    * @emits scion.BaseInterpreter#onBigStepEnd\n    * @emits scion.BaseInterpreter#onBigStepSuspend\n    * @emits scion.BaseInterpreter#onBigStepResume\n    * @emits scion.BaseInterpreter#onSmallStepBegin\n    * @emits scion.BaseInterpreter#onSmallStepEnd\n    * @emits scion.BaseInterpreter#onBigStepEnd\n    * @emits scion.BaseInterpreter#onExitInterpreter\n    */\n\n  }, {\n    key: 'gen',\n    value: function gen(evtObjOrName, optionalData) {\n      var currentEvent;\n      switch (typeof evtObjOrName === 'undefined' ? 'undefined' : _typeof(evtObjOrName)) {\n        case 'string':\n          currentEvent = { name: evtObjOrName, data: optionalData };\n          break;\n        case 'object':\n          if (typeof evtObjOrName.name === 'string') {\n            currentEvent = evtObjOrName;\n          } else {\n            throw new Error('Event object must have \"name\" property of type string.');\n          }\n          break;\n        default:\n          throw new Error('First argument to gen must be a string or object.');\n      }\n\n      if (this._isStepping) throw new Error('Cannot call gen during a big-step');\n\n      //otherwise, kick him off\n      this._isStepping = true;\n\n      this._performBigStep(currentEvent);\n\n      this._isStepping = false;\n      return this.getConfiguration();\n    }\n\n    /**\n    * Injects an external event into the interpreter asynchronously\n    * @param {Event}  currentEvent The event to inject\n    * @param {genCallback} cb Callback invoked with an error or the interpreter's stable configuration\n    * @emits scion.BaseInterpreter#onEntry\n    * @emits scion.BaseInterpreter#onExit\n    * @emits scion.BaseInterpreter#onTransition\n    * @emits scion.BaseInterpreter#onDefaultEntry\n    * @emits scion.BaseInterpreter#onError\n    * @emits scion.BaseInterpreter#onBigStepBegin\n    * @emits scion.BaseInterpreter#onBigStepEnd\n    * @emits scion.BaseInterpreter#onBigStepSuspend\n    * @emits scion.BaseInterpreter#onBigStepResume\n    * @emits scion.BaseInterpreter#onSmallStepBegin\n    * @emits scion.BaseInterpreter#onSmallStepEnd\n    * @emits scion.BaseInterpreter#onBigStepEnd\n    * @emits scion.BaseInterpreter#onExitInterpreter\n    */\n\n  }, {\n    key: 'genAsync',\n    value: function genAsync(currentEvent, cb) {\n      if (currentEvent !== null && ((typeof currentEvent === 'undefined' ? 'undefined' : _typeof(currentEvent)) !== 'object' || !currentEvent || typeof currentEvent.name !== 'string')) {\n        throw new Error('Expected currentEvent to be null or an Object with a name');\n      }\n\n      if (typeof cb !== 'function') {\n        cb = nop;\n      }\n\n      this._externalEventQueue.push([currentEvent, cb]);\n\n      //the semantics we want are to return to the cb the results of processing that particular event.\n      function nextStep(e, c) {\n        this._performBigStepAsync(e, function (err, config) {\n          c(err, config);\n\n          if (this._externalEventQueue.length) {\n            nextStep.apply(this, this._externalEventQueue.shift());\n          } else {\n            this._isStepping = false;\n          }\n        }.bind(this));\n      }\n      if (!this._isStepping) {\n        this._isStepping = true;\n        nextStep.apply(this, this._externalEventQueue.shift());\n      }\n    }\n  }]);\n\n  return BaseInterpreter;\n}(EventEmitter);\n\nBaseInterpreter.EVENTS = ['onEntry', 'onExit', 'onTransition', 'onDefaultEntry', 'onError', 'onBigStepBegin', 'onBigStepSuspend', 'onBigStepResume', 'onSmallStepBegin', 'onSmallStepEnd', 'onBigStepEnd', 'onExitInterpreter'];\n\n//some global singletons to use to generate in-memory session ids, in case the user does not specify these data structures\nBaseInterpreter.sessionIdCounter = 1;\nBaseInterpreter.generateSessionid = function () {\n  return BaseInterpreter.sessionIdCounter++;\n};\nBaseInterpreter.sessionRegistry = new Map();\n\n// Do nothing\n\nfunction nop() {}\n\nvar InterpreterScriptingContext = function () {\n  function InterpreterScriptingContext(interpreter) {\n    _classCallCheck(this, InterpreterScriptingContext);\n\n    this._interpreter = interpreter;\n    this._timeoutMap = {};\n    this._invokeMap = {};\n    this._timeouts = new Set();\n\n    //Regex from:\n    //  http://daringfireball.net/2010/07/improved_regex_for_matching_urls\n    //  http://stackoverflow.com/a/6927878\n    this.validateUriRegex = /(#_.*)|\\b((?:[a-z][\\w-]+:(?:\\/{1,3}|[a-z0-9%])|www\\d{0,3}[.]|[a-z0-9.\\-]+[.][a-z]{2,4}\\/)(?:[^\\s()<>]+|\\(([^\\s()<>]+|(\\([^\\s()<>]+\\)))*\\))+(?:\\(([^\\s()<>]+|(\\([^\\s()<>]+\\)))*\\)|[^\\s`!()\\[\\]{};:'\".,<>?«»“”‘’]))/i;\n\n    this.invokeSendTargetRegex = /^#_(.*)$/;\n    this.scxmlSendTargetRegex = /^#_scxml_(.*)$/;\n  }\n\n  _createClass(InterpreterScriptingContext, [{\n    key: 'raise',\n    value: function raise(event) {\n      this._installDefaultPropsOnEvent(event, true);\n      this._interpreter._internalEventQueue.push(event);\n    }\n  }, {\n    key: 'parseXmlStringAsDOM',\n    value: function parseXmlStringAsDOM(xmlString) {\n      return (this._interpreter.opts.xmlParser || InterpreterScriptingContext.xmlParser).parse(xmlString);\n    }\n  }, {\n    key: 'invoke',\n    value: function invoke(invokeObj) {\n      var _this10 = this;\n\n      //look up invoker by type. assume invokers are passed in as an option to constructor\n      this._invokeMap[invokeObj.id] = new Promise(function (resolve, reject) {\n        (_this10._interpreter.opts.invokers || InterpreterScriptingContext.invokers)[invokeObj.type](_this10._interpreter, invokeObj, _this10._interpreter.opts.invokerExecutionContext, function (err, session) {\n          if (err) return reject(err);\n\n          _this10._interpreter.emit('onInvokedSessionInitialized', session);\n          resolve(session);\n        });\n      });\n    }\n  }, {\n    key: 'cancelInvoke',\n    value: function cancelInvoke(invokeid) {\n      var _this11 = this;\n\n      //TODO: on cancel invoke clean up this._invokeMap\n      var sessionPromise = this._invokeMap[invokeid];\n      this._interpreter._log('cancelling session with invokeid ' + invokeid);\n      if (sessionPromise) {\n        this._interpreter._log('sessionPromise found');\n        sessionPromise.then(function (session) {\n          _this11._interpreter._log('resolved session ' + invokeid + '. cancelling... ');\n          session.cancel();\n          //clean up\n          delete _this11._invokeMap[invokeid];\n        }, function (err) {\n          //TODO: dispatch error back into the state machine as error.communication\n        });\n      }\n    }\n  }, {\n    key: '_installDefaultPropsOnEvent',\n    value: function _installDefaultPropsOnEvent(event, isInternal) {\n      if (!isInternal) {\n        event.origin = this._interpreter.opts._x._ioprocessors.scxml.location; //TODO: preserve original origin when we autoforward? \n        event.origintype = event.type || SCXML_IOPROCESSOR_TYPE;\n      }\n      if (typeof event.type === 'undefined') {\n        event.type = isInternal ? 'internal' : 'external';\n      }\n      ['name', 'sendid', 'invokeid', 'data', 'origin', 'origintype'].forEach(function (prop) {\n        if (typeof event[prop] === 'undefined') {\n          event[prop] = undefined;\n        }\n      });\n    }\n  }, {\n    key: 'send',\n    value: function send(event, options) {\n      this._interpreter._log('send event', event, options);\n      options = options || {};\n      var sendType = options.type || SCXML_IOPROCESSOR_TYPE;\n      //TODO: move these out\n      function validateSend(event, options, sendAction) {\n        if (event.target) {\n          var targetIsValidUri = this.validateUriRegex.test(event.target);\n          if (!targetIsValidUri) {\n            throw { name: \"error.execution\", data: 'Target is not valid URI', sendid: event.sendid, type: 'platform' };\n          }\n        }\n        if (sendType !== SCXML_IOPROCESSOR_TYPE) {\n          //TODO: extend this to support HTTP, and other IO processors\n          throw { name: \"error.execution\", data: 'Unsupported event processor type', sendid: event.sendid, type: 'platform' };\n        }\n\n        sendAction.call(this, event, options);\n      }\n\n      function defaultSendAction(event, options) {\n        var _this12 = this;\n\n        if (typeof setTimeout === 'undefined') throw new Error('Default implementation of BaseInterpreter.prototype.send will not work unless setTimeout is defined globally.');\n\n        var match;\n        if (event.target === '#_internal') {\n          this.raise(event);\n        } else {\n          this._installDefaultPropsOnEvent(event, false);\n          event.origintype = SCXML_IOPROCESSOR_TYPE; //TODO: extend this to support HTTP, and other IO processors\n          //TODO : paramterize this based on send/@type?\n          if (!event.target) {\n            doSend.call(this, this._interpreter);\n          } else if (event.target === '#_parent') {\n            if (this._interpreter.opts.parentSession) {\n              event.invokeid = this._interpreter.opts.invokeid;\n              doSend.call(this, this._interpreter.opts.parentSession);\n            } else {\n              throw { name: \"error.communication\", data: 'Parent session not specified', sendid: event.sendid, type: 'platform' };\n            }\n          } else if (match = event.target.match(this.scxmlSendTargetRegex)) {\n            var targetSessionId = match[1];\n            var session = this._interpreter.opts.sessionRegistry.get(targetSessionId);\n            if (session) {\n              doSend.call(this, session);\n            } else {\n              throw { name: 'error.communication', sendid: event.sendid, type: 'platform' };\n            }\n          } else if (match = event.target.match(this.invokeSendTargetRegex)) {\n            //TODO: test this code path.\n            var invokeId = match[1];\n            this._invokeMap[invokeId].then(function (session) {\n              doSend.call(_this12, session);\n            });\n          } else {\n            throw new Error('Unrecognized send target.'); //TODO: dispatch error back into the state machine\n          }\n        }\n\n        function doSend(session) {\n          //TODO: we probably now need to refactor data structures:\n          //    this._timeouts\n          //    this._timeoutMap\n          var timeoutHandle = setTimeout(function () {\n            if (event.sendid) delete this._timeoutMap[event.sendid];\n            this._timeouts.delete(timeoutOptions);\n            if (this._interpreter.opts.doSend) {\n              this._interpreter.opts.doSend(session, event);\n            } else {\n              session[this._interpreter.opts.sendAsync ? 'genAsync' : 'gen'](event);\n            }\n          }.bind(this), options.delay || 0);\n\n          var timeoutOptions = {\n            sendOptions: options,\n            timeoutHandle: timeoutHandle\n          };\n          if (event.sendid) this._timeoutMap[event.sendid] = timeoutHandle;\n          this._timeouts.add(timeoutOptions);\n        }\n      }\n\n      function publish() {\n        this._interpreter.emit(event.name, event.data);\n      }\n\n      //choose send function\n      //TODO: rethink how this custom send works\n      var sendFn;\n      if (event.type === 'https://github.com/jbeard4/SCION#publish') {\n        sendFn = publish;\n      } else if (this._interpreter.opts.customSend) {\n        sendFn = this._interpreter.opts.customSend;\n      } else {\n        sendFn = defaultSendAction;\n      }\n\n      options = options || {};\n\n      this._interpreter._log(\"sending event\", event.name, \"with content\", event.data, \"after delay\", options.delay);\n\n      validateSend.call(this, event, options, sendFn);\n    }\n  }, {\n    key: 'cancel',\n    value: function cancel(sendid) {\n      if (this._interpreter.opts.customCancel) {\n        return this._interpreter.opts.customCancel.apply(this, [sendid]);\n      }\n\n      if (typeof clearTimeout === 'undefined') throw new Error('Default implementation of BaseInterpreter.prototype.cancel will not work unless setTimeout is defined globally.');\n\n      if (sendid in this._timeoutMap) {\n        this._interpreter._log(\"cancelling \", sendid, \" with timeout id \", this._timeoutMap[sendid]);\n        clearTimeout(this._timeoutMap[sendid]);\n      }\n    }\n  }]);\n\n  return InterpreterScriptingContext;\n}();\n\nmodule.exports = extend(new EventEmitter(), {\n  BaseInterpreter: BaseInterpreter,\n  ArraySet: ArraySet,\n  STATE_TYPES: constants.STATE_TYPES,\n  initializeModel: initializeModel,\n  InterpreterScriptingContext: InterpreterScriptingContext,\n  helpers: helpers,\n  query: query\n});\n\n}).call(this,require('_process'))\n},{\"./ArraySet\":1,\"./constants\":2,\"./helpers\":3,\"./query\":4,\"_process\":8,\"tiny-events\":6,\"util\":11}],6:[function(require,module,exports){\nfunction EventEmitter() {\n    this._listeners = {};\n}\n\nEventEmitter.prototype.on = function _on(type, listener) {\n    if (!Array.isArray(this._listeners[type])) {\n        this._listeners[type] = [];\n    }\n\n    if (this._listeners[type].indexOf(listener) === -1) {\n        this._listeners[type].push(listener);\n    }\n\n    return this;\n};\n\nEventEmitter.prototype.once = function _once(type, listener) {\n    var self = this;\n\n    function __once() {\n        for (var args = [], i = 0; i < arguments.length; i += 1) {\n            args[i] = arguments[i];\n        }\n\n        self.off(type, __once);\n        listener.apply(self, args);\n    }\n\n    __once.listener = listener;\n\n    return this.on(type, __once);\n};\n\nEventEmitter.prototype.off = function _off(type, listener) {\n    if (!Array.isArray(this._listeners[type])) {\n        return this;\n    }\n\n    if (typeof listener === 'undefined') {\n        this._listeners[type] = [];\n        return this;\n    }\n\n    var index = this._listeners[type].indexOf(listener);\n\n    if (index === -1) {\n        for (var i = 0; i < this._listeners[type].length; i += 1) {\n            if (this._listeners[type][i].listener === listener) {\n                index = i;\n                break;\n            }\n        }\n    }\n\n    this._listeners[type].splice(index, 1);\n    return this;\n};\n\nEventEmitter.prototype.emit = function _emit(type) {\n    if (!Array.isArray(this._listeners[type])) {\n        return this;\n    }\n\n    for (var args = [], i = 1; i < arguments.length; i += 1) {\n        args[i - 1] = arguments[i];\n    }\n\n    this._listeners[type].forEach(function __emit(listener) {\n        listener.apply(this, args);\n    }, this);\n\n    return this;\n};\n\nmodule.exports.EventEmitter = EventEmitter;\n\n},{}],7:[function(require,module,exports){\n\"use strict\";\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar base = require('@scion-scxml/core-base'),\n    helpers = base.helpers,\n    query = base.query,\n    transitionComparator = base.helpers.transitionComparator;\n\n/** \n * @description Implements SCION legacy semantics. See {@link scion.BaseInterpreter} for information on the constructor arguments.\n * @class Statechart\n * @extends BaseInterpreter\n */\n\nvar Statechart = function (_base$BaseInterpreter) {\n  _inherits(Statechart, _base$BaseInterpreter);\n\n  function Statechart(modelOrModelFactory, opts) {\n    _classCallCheck(this, Statechart);\n\n    opts = opts || {};\n    opts.legacySemantics = true;\n\n    return _possibleConstructorReturn(this, (Statechart.__proto__ || Object.getPrototypeOf(Statechart)).call(this, modelOrModelFactory, opts));\n  }\n\n  /** @private */\n\n\n  _createClass(Statechart, [{\n    key: \"_selectTransitions\",\n    value: function _selectTransitions(currentEvent, selectEventlessTransitions) {\n      if (this.opts.onlySelectFromBasicStates) {\n        var states = this._configuration.iter();\n      } else {\n        var statesAndParents = new this.opts.Set();\n\n        //get full configuration, unordered\n        //this means we may select transitions from parents before states\n        var configList = this._configuration.iter();\n        for (var idx = 0, len = configList.length; idx < len; idx++) {\n          var basicState = configList[idx];\n          statesAndParents.add(basicState);\n          var ancestors = query.getAncestors(basicState);\n          for (var ancIdx = 0, ancLen = ancestors.length; ancIdx < ancLen; ancIdx++) {\n            statesAndParents.add(ancestors[ancIdx]);\n          }\n        }\n\n        states = statesAndParents.iter();\n      }\n\n      var transitionSelector = this.opts.transitionSelector;\n      var enabledTransitions = new this.opts.Set();\n\n      var e = this._evaluateAction.bind(this, currentEvent);\n\n      for (var stateIdx = 0, stateLen = states.length; stateIdx < stateLen; stateIdx++) {\n        var transitions = states[stateIdx].transitions;\n        for (var txIdx = 0, len = transitions.length; txIdx < len; txIdx++) {\n          var t = transitions[txIdx];\n          if (transitionSelector(t, currentEvent, e, selectEventlessTransitions)) {\n            enabledTransitions.add(t);\n          }\n        }\n      }\n\n      var priorityEnabledTransitions = this._selectPriorityEnabledTransitions(enabledTransitions);\n\n      this._log(\"priorityEnabledTransitions\", priorityEnabledTransitions);\n\n      return priorityEnabledTransitions;\n    }\n\n    /** @private */\n\n  }, {\n    key: \"_selectPriorityEnabledTransitions\",\n    value: function _selectPriorityEnabledTransitions(enabledTransitions) {\n      var priorityEnabledTransitions = new this.opts.Set();\n\n      var tuple = this._getInconsistentTransitions(enabledTransitions),\n          consistentTransitions = tuple[0],\n          inconsistentTransitionsPairs = tuple[1];\n\n      priorityEnabledTransitions.union(consistentTransitions);\n\n      this._log(\"enabledTransitions\", enabledTransitions);\n      this._log(\"consistentTransitions\", consistentTransitions);\n      this._log(\"inconsistentTransitionsPairs\", inconsistentTransitionsPairs);\n      this._log(\"priorityEnabledTransitions\", priorityEnabledTransitions);\n\n      while (!inconsistentTransitionsPairs.isEmpty()) {\n        enabledTransitions = new this.opts.Set(inconsistentTransitionsPairs.iter().map(function (t) {\n          return this.opts.priorityComparisonFn(t);\n        }, this));\n\n        tuple = this._getInconsistentTransitions(enabledTransitions);\n        consistentTransitions = tuple[0];\n        inconsistentTransitionsPairs = tuple[1];\n\n        priorityEnabledTransitions.union(consistentTransitions);\n\n        this._log(\"enabledTransitions\", enabledTransitions);\n        this._log(\"consistentTransitions\", consistentTransitions);\n        this._log(\"inconsistentTransitionsPairs\", inconsistentTransitionsPairs);\n        this._log(\"priorityEnabledTransitions\", priorityEnabledTransitions);\n      }\n      return priorityEnabledTransitions;\n    }\n\n    /** @private */\n\n  }, {\n    key: \"_getInconsistentTransitions\",\n    value: function _getInconsistentTransitions(transitions) {\n      var allInconsistentTransitions = new this.opts.Set();\n      var inconsistentTransitionsPairs = new this.opts.Set();\n      var transitionList = transitions.iter();\n\n      this._log(\"transitions\", transitions);\n\n      for (var i = 0; i < transitionList.length; i++) {\n        for (var j = i + 1; j < transitionList.length; j++) {\n          var t1 = transitionList[i];\n          var t2 = transitionList[j];\n          if (this._conflicts(t1, t2)) {\n            allInconsistentTransitions.add(t1);\n            allInconsistentTransitions.add(t2);\n            inconsistentTransitionsPairs.add([t1, t2]);\n          }\n        }\n      }\n\n      var consistentTransitions = transitions.difference(allInconsistentTransitions);\n      return [consistentTransitions, inconsistentTransitionsPairs];\n    }\n  }, {\n    key: \"_conflicts\",\n    value: function _conflicts(t1, t2) {\n      return !this._isArenaOrthogonal(t1, t2);\n    }\n\n    /** @private */\n\n  }, {\n    key: \"_isArenaOrthogonal\",\n    value: function _isArenaOrthogonal(t1, t2) {\n\n      this._log(\"transition scopes\", t1.scope, t2.scope);\n\n      var isOrthogonal;\n      isOrthogonal = query.isOrthogonalTo(t1.scope || t1.source, t2.scope || t2.source);\n\n      this._log(\"transition scopes are orthogonal?\", isOrthogonal);\n\n      return isOrthogonal;\n    }\n  }]);\n\n  return Statechart;\n}(base.BaseInterpreter);\n\nbase.Statechart = Statechart;\nmodule.exports = base;\n\n},{\"@scion-scxml/core-base\":5}],8:[function(require,module,exports){\n// shim for using process in browser\nvar process = module.exports = {};\n\n// cached from whatever global is present so that test runners that stub it\n// don't break things.  But we need to wrap it in a try catch in case it is\n// wrapped in strict mode code which doesn't define any globals.  It's inside a\n// function because try/catches deoptimize in certain engines.\n\nvar cachedSetTimeout;\nvar cachedClearTimeout;\n\nfunction defaultSetTimout() {\n    throw new Error('setTimeout has not been defined');\n}\nfunction defaultClearTimeout () {\n    throw new Error('clearTimeout has not been defined');\n}\n(function () {\n    try {\n        if (typeof setTimeout === 'function') {\n            cachedSetTimeout = setTimeout;\n        } else {\n            cachedSetTimeout = defaultSetTimout;\n        }\n    } catch (e) {\n        cachedSetTimeout = defaultSetTimout;\n    }\n    try {\n        if (typeof clearTimeout === 'function') {\n            cachedClearTimeout = clearTimeout;\n        } else {\n            cachedClearTimeout = defaultClearTimeout;\n        }\n    } catch (e) {\n        cachedClearTimeout = defaultClearTimeout;\n    }\n} ())\nfunction runTimeout(fun) {\n    if (cachedSetTimeout === setTimeout) {\n        //normal enviroments in sane situations\n        return setTimeout(fun, 0);\n    }\n    // if setTimeout wasn't available but was latter defined\n    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n        cachedSetTimeout = setTimeout;\n        return setTimeout(fun, 0);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedSetTimeout(fun, 0);\n    } catch(e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\n            return cachedSetTimeout.call(null, fun, 0);\n        } catch(e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\n            return cachedSetTimeout.call(this, fun, 0);\n        }\n    }\n\n\n}\nfunction runClearTimeout(marker) {\n    if (cachedClearTimeout === clearTimeout) {\n        //normal enviroments in sane situations\n        return clearTimeout(marker);\n    }\n    // if clearTimeout wasn't available but was latter defined\n    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n        cachedClearTimeout = clearTimeout;\n        return clearTimeout(marker);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedClearTimeout(marker);\n    } catch (e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\n            return cachedClearTimeout.call(null, marker);\n        } catch (e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\n            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\n            return cachedClearTimeout.call(this, marker);\n        }\n    }\n\n\n\n}\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    if (!draining || !currentQueue) {\n        return;\n    }\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = runTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    runClearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        runTimeout(drainQueue);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\nprocess.prependListener = noop;\nprocess.prependOnceListener = noop;\n\nprocess.listeners = function (name) { return [] }\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n\n},{}],9:[function(require,module,exports){\nif (typeof Object.create === 'function') {\n  // implementation from standard node.js 'util' module\n  module.exports = function inherits(ctor, superCtor) {\n    ctor.super_ = superCtor\n    ctor.prototype = Object.create(superCtor.prototype, {\n      constructor: {\n        value: ctor,\n        enumerable: false,\n        writable: true,\n        configurable: true\n      }\n    });\n  };\n} else {\n  // old school shim for old browsers\n  module.exports = function inherits(ctor, superCtor) {\n    ctor.super_ = superCtor\n    var TempCtor = function () {}\n    TempCtor.prototype = superCtor.prototype\n    ctor.prototype = new TempCtor()\n    ctor.prototype.constructor = ctor\n  }\n}\n\n},{}],10:[function(require,module,exports){\nmodule.exports = function isBuffer(arg) {\n  return arg && typeof arg === 'object'\n    && typeof arg.copy === 'function'\n    && typeof arg.fill === 'function'\n    && typeof arg.readUInt8 === 'function';\n}\n},{}],11:[function(require,module,exports){\n(function (process,global){\n// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nvar formatRegExp = /%[sdj%]/g;\nexports.format = function(f) {\n  if (!isString(f)) {\n    var objects = [];\n    for (var i = 0; i < arguments.length; i++) {\n      objects.push(inspect(arguments[i]));\n    }\n    return objects.join(' ');\n  }\n\n  var i = 1;\n  var args = arguments;\n  var len = args.length;\n  var str = String(f).replace(formatRegExp, function(x) {\n    if (x === '%%') return '%';\n    if (i >= len) return x;\n    switch (x) {\n      case '%s': return String(args[i++]);\n      case '%d': return Number(args[i++]);\n      case '%j':\n        try {\n          return JSON.stringify(args[i++]);\n        } catch (_) {\n          return '[Circular]';\n        }\n      default:\n        return x;\n    }\n  });\n  for (var x = args[i]; i < len; x = args[++i]) {\n    if (isNull(x) || !isObject(x)) {\n      str += ' ' + x;\n    } else {\n      str += ' ' + inspect(x);\n    }\n  }\n  return str;\n};\n\n\n// Mark that a method should not be used.\n// Returns a modified function which warns once by default.\n// If --no-deprecation is set, then it is a no-op.\nexports.deprecate = function(fn, msg) {\n  // Allow for deprecating things in the process of starting up.\n  if (isUndefined(global.process)) {\n    return function() {\n      return exports.deprecate(fn, msg).apply(this, arguments);\n    };\n  }\n\n  if (process.noDeprecation === true) {\n    return fn;\n  }\n\n  var warned = false;\n  function deprecated() {\n    if (!warned) {\n      if (process.throwDeprecation) {\n        throw new Error(msg);\n      } else if (process.traceDeprecation) {\n        console.trace(msg);\n      } else {\n        console.error(msg);\n      }\n      warned = true;\n    }\n    return fn.apply(this, arguments);\n  }\n\n  return deprecated;\n};\n\n\nvar debugs = {};\nvar debugEnviron;\nexports.debuglog = function(set) {\n  if (isUndefined(debugEnviron))\n    debugEnviron = process.env.NODE_DEBUG || '';\n  set = set.toUpperCase();\n  if (!debugs[set]) {\n    if (new RegExp('\\\\b' + set + '\\\\b', 'i').test(debugEnviron)) {\n      var pid = process.pid;\n      debugs[set] = function() {\n        var msg = exports.format.apply(exports, arguments);\n        console.error('%s %d: %s', set, pid, msg);\n      };\n    } else {\n      debugs[set] = function() {};\n    }\n  }\n  return debugs[set];\n};\n\n\n/**\n * Echos the value of a value. Trys to print the value out\n * in the best way possible given the different types.\n *\n * @param {Object} obj The object to print out.\n * @param {Object} opts Optional options object that alters the output.\n */\n/* legacy: obj, showHidden, depth, colors*/\nfunction inspect(obj, opts) {\n  // default options\n  var ctx = {\n    seen: [],\n    stylize: stylizeNoColor\n  };\n  // legacy...\n  if (arguments.length >= 3) ctx.depth = arguments[2];\n  if (arguments.length >= 4) ctx.colors = arguments[3];\n  if (isBoolean(opts)) {\n    // legacy...\n    ctx.showHidden = opts;\n  } else if (opts) {\n    // got an \"options\" object\n    exports._extend(ctx, opts);\n  }\n  // set default options\n  if (isUndefined(ctx.showHidden)) ctx.showHidden = false;\n  if (isUndefined(ctx.depth)) ctx.depth = 2;\n  if (isUndefined(ctx.colors)) ctx.colors = false;\n  if (isUndefined(ctx.customInspect)) ctx.customInspect = true;\n  if (ctx.colors) ctx.stylize = stylizeWithColor;\n  return formatValue(ctx, obj, ctx.depth);\n}\nexports.inspect = inspect;\n\n\n// http://en.wikipedia.org/wiki/ANSI_escape_code#graphics\ninspect.colors = {\n  'bold' : [1, 22],\n  'italic' : [3, 23],\n  'underline' : [4, 24],\n  'inverse' : [7, 27],\n  'white' : [37, 39],\n  'grey' : [90, 39],\n  'black' : [30, 39],\n  'blue' : [34, 39],\n  'cyan' : [36, 39],\n  'green' : [32, 39],\n  'magenta' : [35, 39],\n  'red' : [31, 39],\n  'yellow' : [33, 39]\n};\n\n// Don't use 'blue' not visible on cmd.exe\ninspect.styles = {\n  'special': 'cyan',\n  'number': 'yellow',\n  'boolean': 'yellow',\n  'undefined': 'grey',\n  'null': 'bold',\n  'string': 'green',\n  'date': 'magenta',\n  // \"name\": intentionally not styling\n  'regexp': 'red'\n};\n\n\nfunction stylizeWithColor(str, styleType) {\n  var style = inspect.styles[styleType];\n\n  if (style) {\n    return '\\u001b[' + inspect.colors[style][0] + 'm' + str +\n           '\\u001b[' + inspect.colors[style][1] + 'm';\n  } else {\n    return str;\n  }\n}\n\n\nfunction stylizeNoColor(str, styleType) {\n  return str;\n}\n\n\nfunction arrayToHash(array) {\n  var hash = {};\n\n  array.forEach(function(val, idx) {\n    hash[val] = true;\n  });\n\n  return hash;\n}\n\n\nfunction formatValue(ctx, value, recurseTimes) {\n  // Provide a hook for user-specified inspect functions.\n  // Check that value is an object with an inspect function on it\n  if (ctx.customInspect &&\n      value &&\n      isFunction(value.inspect) &&\n      // Filter out the util module, it's inspect function is special\n      value.inspect !== exports.inspect &&\n      // Also filter out any prototype objects using the circular check.\n      !(value.constructor && value.constructor.prototype === value)) {\n    var ret = value.inspect(recurseTimes, ctx);\n    if (!isString(ret)) {\n      ret = formatValue(ctx, ret, recurseTimes);\n    }\n    return ret;\n  }\n\n  // Primitive types cannot have properties\n  var primitive = formatPrimitive(ctx, value);\n  if (primitive) {\n    return primitive;\n  }\n\n  // Look up the keys of the object.\n  var keys = Object.keys(value);\n  var visibleKeys = arrayToHash(keys);\n\n  if (ctx.showHidden) {\n    keys = Object.getOwnPropertyNames(value);\n  }\n\n  // IE doesn't make error fields non-enumerable\n  // http://msdn.microsoft.com/en-us/library/ie/dww52sbt(v=vs.94).aspx\n  if (isError(value)\n      && (keys.indexOf('message') >= 0 || keys.indexOf('description') >= 0)) {\n    return formatError(value);\n  }\n\n  // Some type of object without properties can be shortcutted.\n  if (keys.length === 0) {\n    if (isFunction(value)) {\n      var name = value.name ? ': ' + value.name : '';\n      return ctx.stylize('[Function' + name + ']', 'special');\n    }\n    if (isRegExp(value)) {\n      return ctx.stylize(RegExp.prototype.toString.call(value), 'regexp');\n    }\n    if (isDate(value)) {\n      return ctx.stylize(Date.prototype.toString.call(value), 'date');\n    }\n    if (isError(value)) {\n      return formatError(value);\n    }\n  }\n\n  var base = '', array = false, braces = ['{', '}'];\n\n  // Make Array say that they are Array\n  if (isArray(value)) {\n    array = true;\n    braces = ['[', ']'];\n  }\n\n  // Make functions say that they are functions\n  if (isFunction(value)) {\n    var n = value.name ? ': ' + value.name : '';\n    base = ' [Function' + n + ']';\n  }\n\n  // Make RegExps say that they are RegExps\n  if (isRegExp(value)) {\n    base = ' ' + RegExp.prototype.toString.call(value);\n  }\n\n  // Make dates with properties first say the date\n  if (isDate(value)) {\n    base = ' ' + Date.prototype.toUTCString.call(value);\n  }\n\n  // Make error with message first say the error\n  if (isError(value)) {\n    base = ' ' + formatError(value);\n  }\n\n  if (keys.length === 0 && (!array || value.length == 0)) {\n    return braces[0] + base + braces[1];\n  }\n\n  if (recurseTimes < 0) {\n    if (isRegExp(value)) {\n      return ctx.stylize(RegExp.prototype.toString.call(value), 'regexp');\n    } else {\n      return ctx.stylize('[Object]', 'special');\n    }\n  }\n\n  ctx.seen.push(value);\n\n  var output;\n  if (array) {\n    output = formatArray(ctx, value, recurseTimes, visibleKeys, keys);\n  } else {\n    output = keys.map(function(key) {\n      return formatProperty(ctx, value, recurseTimes, visibleKeys, key, array);\n    });\n  }\n\n  ctx.seen.pop();\n\n  return reduceToSingleString(output, base, braces);\n}\n\n\nfunction formatPrimitive(ctx, value) {\n  if (isUndefined(value))\n    return ctx.stylize('undefined', 'undefined');\n  if (isString(value)) {\n    var simple = '\\'' + JSON.stringify(value).replace(/^\"|\"$/g, '')\n                                             .replace(/'/g, \"\\\\'\")\n                                             .replace(/\\\\\"/g, '\"') + '\\'';\n    return ctx.stylize(simple, 'string');\n  }\n  if (isNumber(value))\n    return ctx.stylize('' + value, 'number');\n  if (isBoolean(value))\n    return ctx.stylize('' + value, 'boolean');\n  // For some reason typeof null is \"object\", so special case here.\n  if (isNull(value))\n    return ctx.stylize('null', 'null');\n}\n\n\nfunction formatError(value) {\n  return '[' + Error.prototype.toString.call(value) + ']';\n}\n\n\nfunction formatArray(ctx, value, recurseTimes, visibleKeys, keys) {\n  var output = [];\n  for (var i = 0, l = value.length; i < l; ++i) {\n    if (hasOwnProperty(value, String(i))) {\n      output.push(formatProperty(ctx, value, recurseTimes, visibleKeys,\n          String(i), true));\n    } else {\n      output.push('');\n    }\n  }\n  keys.forEach(function(key) {\n    if (!key.match(/^\\d+$/)) {\n      output.push(formatProperty(ctx, value, recurseTimes, visibleKeys,\n          key, true));\n    }\n  });\n  return output;\n}\n\n\nfunction formatProperty(ctx, value, recurseTimes, visibleKeys, key, array) {\n  var name, str, desc;\n  desc = Object.getOwnPropertyDescriptor(value, key) || { value: value[key] };\n  if (desc.get) {\n    if (desc.set) {\n      str = ctx.stylize('[Getter/Setter]', 'special');\n    } else {\n      str = ctx.stylize('[Getter]', 'special');\n    }\n  } else {\n    if (desc.set) {\n      str = ctx.stylize('[Setter]', 'special');\n    }\n  }\n  if (!hasOwnProperty(visibleKeys, key)) {\n    name = '[' + key + ']';\n  }\n  if (!str) {\n    if (ctx.seen.indexOf(desc.value) < 0) {\n      if (isNull(recurseTimes)) {\n        str = formatValue(ctx, desc.value, null);\n      } else {\n        str = formatValue(ctx, desc.value, recurseTimes - 1);\n      }\n      if (str.indexOf('\\n') > -1) {\n        if (array) {\n          str = str.split('\\n').map(function(line) {\n            return '  ' + line;\n          }).join('\\n').substr(2);\n        } else {\n          str = '\\n' + str.split('\\n').map(function(line) {\n            return '   ' + line;\n          }).join('\\n');\n        }\n      }\n    } else {\n      str = ctx.stylize('[Circular]', 'special');\n    }\n  }\n  if (isUndefined(name)) {\n    if (array && key.match(/^\\d+$/)) {\n      return str;\n    }\n    name = JSON.stringify('' + key);\n    if (name.match(/^\"([a-zA-Z_][a-zA-Z_0-9]*)\"$/)) {\n      name = name.substr(1, name.length - 2);\n      name = ctx.stylize(name, 'name');\n    } else {\n      name = name.replace(/'/g, \"\\\\'\")\n                 .replace(/\\\\\"/g, '\"')\n                 .replace(/(^\"|\"$)/g, \"'\");\n      name = ctx.stylize(name, 'string');\n    }\n  }\n\n  return name + ': ' + str;\n}\n\n\nfunction reduceToSingleString(output, base, braces) {\n  var numLinesEst = 0;\n  var length = output.reduce(function(prev, cur) {\n    numLinesEst++;\n    if (cur.indexOf('\\n') >= 0) numLinesEst++;\n    return prev + cur.replace(/\\u001b\\[\\d\\d?m/g, '').length + 1;\n  }, 0);\n\n  if (length > 60) {\n    return braces[0] +\n           (base === '' ? '' : base + '\\n ') +\n           ' ' +\n           output.join(',\\n  ') +\n           ' ' +\n           braces[1];\n  }\n\n  return braces[0] + base + ' ' + output.join(', ') + ' ' + braces[1];\n}\n\n\n// NOTE: These type checking functions intentionally don't use `instanceof`\n// because it is fragile and can be easily faked with `Object.create()`.\nfunction isArray(ar) {\n  return Array.isArray(ar);\n}\nexports.isArray = isArray;\n\nfunction isBoolean(arg) {\n  return typeof arg === 'boolean';\n}\nexports.isBoolean = isBoolean;\n\nfunction isNull(arg) {\n  return arg === null;\n}\nexports.isNull = isNull;\n\nfunction isNullOrUndefined(arg) {\n  return arg == null;\n}\nexports.isNullOrUndefined = isNullOrUndefined;\n\nfunction isNumber(arg) {\n  return typeof arg === 'number';\n}\nexports.isNumber = isNumber;\n\nfunction isString(arg) {\n  return typeof arg === 'string';\n}\nexports.isString = isString;\n\nfunction isSymbol(arg) {\n  return typeof arg === 'symbol';\n}\nexports.isSymbol = isSymbol;\n\nfunction isUndefined(arg) {\n  return arg === void 0;\n}\nexports.isUndefined = isUndefined;\n\nfunction isRegExp(re) {\n  return isObject(re) && objectToString(re) === '[object RegExp]';\n}\nexports.isRegExp = isRegExp;\n\nfunction isObject(arg) {\n  return typeof arg === 'object' && arg !== null;\n}\nexports.isObject = isObject;\n\nfunction isDate(d) {\n  return isObject(d) && objectToString(d) === '[object Date]';\n}\nexports.isDate = isDate;\n\nfunction isError(e) {\n  return isObject(e) &&\n      (objectToString(e) === '[object Error]' || e instanceof Error);\n}\nexports.isError = isError;\n\nfunction isFunction(arg) {\n  return typeof arg === 'function';\n}\nexports.isFunction = isFunction;\n\nfunction isPrimitive(arg) {\n  return arg === null ||\n         typeof arg === 'boolean' ||\n         typeof arg === 'number' ||\n         typeof arg === 'string' ||\n         typeof arg === 'symbol' ||  // ES6 symbol\n         typeof arg === 'undefined';\n}\nexports.isPrimitive = isPrimitive;\n\nexports.isBuffer = require('./support/isBuffer');\n\nfunction objectToString(o) {\n  return Object.prototype.toString.call(o);\n}\n\n\nfunction pad(n) {\n  return n < 10 ? '0' + n.toString(10) : n.toString(10);\n}\n\n\nvar months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep',\n              'Oct', 'Nov', 'Dec'];\n\n// 26 Feb 16:19:34\nfunction timestamp() {\n  var d = new Date();\n  var time = [pad(d.getHours()),\n              pad(d.getMinutes()),\n              pad(d.getSeconds())].join(':');\n  return [d.getDate(), months[d.getMonth()], time].join(' ');\n}\n\n\n// log is just a thin wrapper to console.log that prepends a timestamp\nexports.log = function() {\n  console.log('%s - %s', timestamp(), exports.format.apply(exports, arguments));\n};\n\n\n/**\n * Inherit the prototype methods from one constructor into another.\n *\n * The Function.prototype.inherits from lang.js rewritten as a standalone\n * function (not on Function.prototype). NOTE: If this file is to be loaded\n * during bootstrapping this function needs to be rewritten using some native\n * functions as prototype setup using normal JavaScript does not work as\n * expected during bootstrapping (see mirror.js in r114903).\n *\n * @param {function} ctor Constructor function which needs to inherit the\n *     prototype.\n * @param {function} superCtor Constructor function to inherit prototype from.\n */\nexports.inherits = require('inherits');\n\nexports._extend = function(origin, add) {\n  // Don't do anything if add isn't an object\n  if (!add || !isObject(add)) return origin;\n\n  var keys = Object.keys(add);\n  var i = keys.length;\n  while (i--) {\n    origin[keys[i]] = add[keys[i]];\n  }\n  return origin;\n};\n\nfunction hasOwnProperty(obj, prop) {\n  return Object.prototype.hasOwnProperty.call(obj, prop);\n}\n\n}).call(this,require('_process'),typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n},{\"./support/isBuffer\":10,\"_process\":8,\"inherits\":9}]},{},[7])(7)\n});"]}